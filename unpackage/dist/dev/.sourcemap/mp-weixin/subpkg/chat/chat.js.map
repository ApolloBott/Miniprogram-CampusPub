{"version":3,"sources":["uni-app:///main.js","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?daf1","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?4216","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?dd27","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?f505","uni-app:///subpkg/chat/chat.vue","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?56c2","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/chat/chat.vue?2fd2"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","memberCode","messages","inputText","scrollIntoView","goods_info","pollingTimer","pollingInterval","isRequesting","lastMessageId","otherOpenid","other_nickname","other_avatarUrl","showPurchasePopup","addressInput","currentOrder","showEmojiPanel","emojiList","id","url","name","uploading","transactionStatus","isTransactionInitiator","TRANSACTION_EXPIRE_TIME","showNewMessageTip","newMessageCount","scrollTop","scrollThreshold","isNearBottom","lastMessagesLength","scrollViewHeight","onLoad","queryObj","code","uni","res1","console","options","chatData","queryObj1","onHide","onReady","select","boundingClientRect","exec","onShow","onUnload","methods","handleScroll","scrollHeight","deltaY","distanceToBottom","viewHeight","handleScrollToLower","scrollToBottomWithTip","checkTransactionExpiration","lastTransactionMsg","reverse","find","hasAgreeMsg","hasFinishMsg","hasSystemCloseMsg","msg","transactionTime","now","timePassed","sendSystemCloseMessage","systemMessage","reqObj","openid1","openid2","goods_id","senderid","content","message_type","res","newMessages","finish","title","confirmText","cancelText","err","mask","finishData","goods_name","goods_price","timestamp","res2","icon","duration","previewEmoji","current","urls","selectEmoji","loadCurrentOrder","user_openid","_hideLoading","confirmReceipt","order_number","openid","result","loadMessages","silent","req","newLastMessageId","hadMessages","oldLength","newMessagesCount","lastMessage","isFromOther","startPolling","stopPolling","clearInterval","goBack","showMoreOptions","itemList","success","reportUser","editable","placeholderText","reason","reportData","reporter_openid","reported_openid","post_id","apiRes","buyNow","closePurchasePopup","loadLocalAddress","saveAddress","fullAddress","sendPaymentMessage","is_payment","handleWechatPay","finalAddress","transactionData","location","sendMessage","newMessage","requyObj","showEmojiPicker","showAddMenu","chooseImageFromAlbum","count","sizeType","sourceType","chooseImageFromCamera","uploadAndSendImage","filePath","fileType","tokenRes","encoding","fail","fileContent","method","header","resolve","reject","imageUrl","sub_type","previewImage","filter","map","scrollToBottom","formatTime","processMessages","message","type","processed","agreeTransaction","agreeData","gotoDetail","computed","displayGoodsName","savedAddressText"],"mappings":"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A;cAAA;gBACAC;gBAAA;gBAGApG;kBACA4C;kBACAI;gBACA;;gBAEA;gBACAqD;kBACAhE;kBACAa;kBACAC;kBACAmD;kBACAlD;gBACA,GAEA;gBACAlB;kBACAC;kBACAC,uEACA,kCACA;kBACAC;kBACAC;kBACAC;kBAAA;kBACAC;kBAAA;kBACA8D;gBACA;gBAAA;gBAAA,OAEAtG;cAAA;gBAAA;gBAAAyC;gBAEAzC;gBAEA;kBACA;kBACA0C;kBACA;kBAEA;oBACA,kEACAA;kBACA;;kBAEA;kBACA;kBACA;;kBAEA;kBACA;;kBAEA;kBACA1C;oBACA4C;oBACAU;oBACAC;kBACA;;kBAEA;kBACA;oBACA;kBACA;gBACA;kBACAvD;oBACA4C;oBACAU;oBACAC;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAvD;gBACAE;gBACAF;kBACA4C;kBACAU;kBACAC;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IAEA;IACA;IACA;IACA;IAEA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IAEA;IAEA;IACA;IAEA;IACA;IACA;IACA;IAEA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IAEA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IAEA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACAgD;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAIAC;gBACA;gBAAA;gBAGA;gBACAC;kBACAtE;kBACAC,uEACA,kCACA;kBACAC;kBACAC;kBACAC;kBACAC;gBACA;gBAAA;gBAAA,OAEAxC;cAAA;gBAAA;gBAAAyC;gBAEA;kBACA;kBACAC;kBACA;;kBAEA;kBACA;oBACA,kEACAA;kBACA;;kBAEA;kBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAxC;gBACAF;kBACA4C;kBACAU;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAoD;MACA;IACA;IAEA;AACA;AACA;IACAC;MAAA;MACA3G;QACAiF;QACAC;UACA;YACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA;AACA;AACA;IACA0B;MAAA;MACA5G;QACA6G;QACAC;QACAC;QACA7B;UACA;QACA;MACA;IACA;IAEA;AACA;AACA;IACA8B;MAAA;MACAhH;QACA6G;QACAC;QACAC;QACA7B;UACA;QACA;MACA;IACA;IAEA;AACA;AACA;IACA+B;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAIA;gBACAjH;kBACA4C;kBACAI;gBACA;gBAAA;gBAGAkE,yBAEA;gBAAA;gBAAA,OACAlH;kBACAiE;kBACAkD;gBACA;cAAA;gBAAA;gBAHAC;gBAAA,MAKAA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAAA;gBAAA,OAIA;kBACApH;oBACAkH;oBACAG;oBACAnC;sBAAA;oBAAA;oBACAoC;kBACA;gBACA;cAAA;gBAPAC;gBAAA;gBAAA,OAUA;kBACAvH;oBACAhB;oBACAwI;oBACAC;sBACA;oBACA;oBACA5J;oBACAqH;sBACA;wBACAwC;sBACA;wBACAC;sBACA;oBACA;oBACAL;kBACA;gBACA;cAAA;gBAEAM;gBAEA5H;;gBAEA;gBACAkC;kBACAC;kBACAC,uEACA,kCACA;kBACAC;kBACAC;kBACAC;kBACAC;kBAAA;kBACAqF;gBACA;gBAAA;gBAAA,OAEA7H;cAAA;gBAAA;gBAAAyC;gBAEA;kBACAC;kBACA;kBAEA;oBACA,kEACAA;kBACA;kBAEA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAxC;gBACAF;gBACAA;kBACA4C;kBACAU;kBACAC;gBACA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;AACA;AACA;IACAuE;MACA;MACA,8BACAC;QAAA;MAAA,GACAC;QAAA;MAAA;MAEAhI;QACAyD;QACAC;MACA;IACA;IAIA;IACAuE;MACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;AACA;AACA;IACAC;MAAA;MACA;QACAjI;QACA;MACA;;MAEA;MACA;QAAA,OACA0B,iCACAA,eACAA;MAAA,EACA;;MAEA;MACA;QACA;QACA;MACA;QACA;QACA;UAAA;QAAA;QACA;UAAA;QAAA;QACA;UAAA;QAAA;QAEA;UACA;QACA;UACA;QACA;UACA,mEACAL,UACAC;YAAA;UAAA;UAEA;YACA;cACA;cACA;YACA;cACA;cACA;YACA;UACA;QACA;MACA;MAEA;QACA,gDACA4G;UACAC,mDACAD;UAAA;UACAlC;UACA1D;UACAqF;QAAA,EACA;;QAEA;QACA;UACA;YACA;YACAS;YACAA;UACA;YACApI;YACAoI;UACA;QACA;;QAEA;QACA;UACA;YACA;YACAA;UACA;YACApI;UACA;QACA;;QAEA;QACA;UACA;YACA;YACAoI;UACA;YACApI;UACA;QACA;QAEA;MACA;IACA;IAEA;IACAqI;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAvI;kBACA4C;kBACAI;gBACA;;gBAEA;gBACAwF;kBACAnG;kBACAa;kBACAC;kBACAC;gBACA,GAEA;gBACAlB;kBACAC;kBACAC,uEACA,kCACA;kBACAC;kBACAC;kBACAC;kBACAC;gBACA;gBAAA;gBAAA,OAEAxC;cAAA;gBAAA;gBAAAyC;gBAEAzC;gBAEA;kBACA;kBACA;;kBAEA;kBACA0C;kBACA;kBAEA;oBACA,kEACAA;kBACA;kBAEA1C;oBACA4C;oBACAU;kBACA;;kBAEA;kBACA;oBACA;kBACA;gBACA;kBACAtD;oBACA4C;oBACAU;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAtD;gBACAE;gBACAF;kBACA4C;kBACAU;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAGA;IACAmF;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEA;gBACAvI;gBAAA;gBAAA,OACAF;kBACAqC;kBACA;kBACAwB;gBACA;cAAA;gBAAA;gBAJApB;gBAMA;kBACAvC;gBACA;kBACAA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACA;cAAA;gBAEAF;kBACAhB;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EAAA,EACA;EACA0J,0CACA;IACA;IACAC;MACA;QACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA;MACA;MACA;IACA;EAAA;AAEA;AAAA,2B;;;;;;;;;;;;;AC9yDA;AAAA;AAAA;AAAA;AAAkjC,CAAgB,mgCAAG,EAAC,C;;;;;;;;;;;ACAtkC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"subpkg/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpkg/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=19940a7a&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpkg/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=19940a7a&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.addressInput.trim()\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.showEmojiPanel = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"chat-container\">\n\t\t<!-- È°∂ÈÉ®ÂØºËà™Ê†è - Âõ∫ÂÆö‰ΩçÁΩÆ -->\n\t\t<view class=\"header\">\n\t\t\t<view class=\"seller-info\">\n\t\t\t\t<text class=\"seller-name\" v-if=\"goods_info.publisher_id !== userBase.openid\">{{ goods_info.publisher_nickname }}</text>\n\t\t\t\t<text class=\"seller-name\" v-else>{{ other_nickname }}</text>\n\t\t\t</view>\n\t\t\t<view class=\"more-btn\" @click=\"showMoreOptions\">\n\t\t\t\t<image class=\"more_icons\" src=\"/static/icons/more.png\"></image>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- ÂïÜÂìÅÁÆÄ‰ªãÊ†è - Âõ∫ÂÆö‰ΩçÁΩÆ -->\n\t\t<view class=\"goods-bar\">\n\t\t\t<image class=\"goods-image\" :src=\"goods_info.goods_big_logo\" mode=\"aspectFill\" @click=\"gotoDetail(goods_info)\"></image>\n\t\t\t<view class=\"goods-info\">\n\t\t\t\t<text class=\"goods-name\">{{ displayGoodsName }}</text>\n\t\t\t\t<text class=\"goods-price\">¬•{{ goods_info.goods_price }}</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- ‰π∞ÂÆ∂ËßÜËßí -->\r\n\t\t\t    <view v-if=\"goods_info.publisher_id !== userBase.openid\">\r\n\t\t\t        <!-- Êó†‰∫§ÊòìÁä∂ÊÄÅ - ÊòæÁ§∫Á∫ø‰∏ã‰∫§ÊòìÊåâÈíÆ -->\r\n\t\t\t        <view class=\"buy-btn\" @click=\"buyNow\" v-if=\"transactionStatus === 0\">\r\n\t\t\t            Á∫ø‰∏ã‰∫§Êòì\r\n\t\t\t        </view>\r\n\t\t\t        \r\n\t\t\t        <!-- ‰π∞ÂÆ∂ÂèëËµ∑‰∫§ÊòìÂæÖÁ°ÆËÆ§ - ÊòæÁ§∫Á≠âÂæÖÁä∂ÊÄÅ -->\r\n\t\t\t        <view class=\"waiting-btn\" v-else-if=\"transactionStatus === 1\">\r\n\t\t\t            Á≠âÂæÖÂçñÂÆ∂Á°ÆËÆ§\r\n\t\t\t        </view>\r\n\t\t\t        \r\n\t\t\t        <!-- ÂçñÂÆ∂ÂêåÊÑèÔºå‰∫§ÊòìËøõË°å‰∏≠ -->\r\n\t\t\t        <view class=\"in-progress-btn\" @click=\"finish\" v-else-if=\"transactionStatus === 2\">\r\n\t\t\t            Á°ÆËÆ§‰∫§ÊòìÂÆåÊàê\r\n\t\t\t        </view>\r\n\t\t\t        \r\n\t\t\t        <!-- ‰∫§ÊòìÂÆåÊàê -->\r\n\t\t\t        <view class=\"completed-btn\" v-else-if=\"transactionStatus === 3\">\r\n\t\t\t            ‰∫§ÊòìÂ∑≤ÂÆåÊàê\r\n\t\t\t        </view>\r\n\t\t\t    </view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- ÂçñÂÆ∂ËßÜËßí -->\r\n\t\t\t\t    <view v-else>\r\n\t\t\t\t        <!-- ‰π∞ÂÆ∂ÂèëËµ∑‰∫§Êòì - ÊòæÁ§∫ÂêåÊÑèÊåâÈíÆ -->\r\n\t\t\t\t        <view class=\"agree-btn\" @click=\"agreeTransaction\" v-if=\"transactionStatus === 1\">\r\n\t\t\t\t            ÂêåÊÑèÁ∫ø‰∏ã‰∫§Êòì\r\n\t\t\t\t        </view>\r\n\t\t\t\t        \r\n\t\t\t\t        <!-- ‰∫§ÊòìËøõË°å‰∏≠ -->\r\n\t\t\t\t        <view class=\"in-progress-btn\" v-else-if=\"transactionStatus === 2\">\r\n\t\t\t\t            Á∫ø‰∏ã‰∫§ÊòìËøõË°å‰∏≠\r\n\t\t\t\t        </view>\r\n\t\t\t\t        \r\n\t\t\t\t        <!-- ‰∫§ÊòìÂÆåÊàê -->\r\n\t\t\t\t        <view class=\"completed-btn\" v-else-if=\"transactionStatus === 3\">\r\n\t\t\t\t            ‰∫§ÊòìÂ∑≤ÂÆåÊàê\r\n\t\t\t\t        </view>\r\n\t\t\t\t        \r\n\t\t\t\t        <!-- Êó†‰∫§ÊòìÁä∂ÊÄÅ -->\r\n\t\t\t\t        <view class=\"no-transaction-btn\" v-else>\r\n\t\t\t\t            Á≠âÂæÖ‰π∞ÂÆ∂ÂèëËµ∑\r\n\t\t\t\t        </view>\r\n\t\t\t\t    </view>\n\t\t</view>\n\n\t\t<!-- ËÅäÂ§©ÂÜÖÂÆπÂå∫Âüü -->\r\n\t\t<scroll-view \r\n\t\t  class=\"chat-content\" \r\n\t\t  scroll-y \r\n\t\t  :scroll-into-view=\"scrollIntoView\" \r\n\t\t  scroll-with-animation\r\n\t\t  @scroll=\"handleScroll\"\r\n\t\t  :lower-threshold=\"scrollThreshold\"\r\n\t\t  @scrolltolower=\"handleScrollToLower\"\r\n\t\t>\r\n\t\t    <view v-for=\"(msg, index) in messages\" :key=\"index\" :id=\"'msg-' + index\" class=\"message-item\">\r\n\t\t        <!-- Êó∂Èó¥Êà≥ -->\r\n\t\t        <view v-if=\"msg.showTime\" class=\"message-time\">\r\n\t\t            {{ msg.time }}\r\n\t\t        </view>\r\n\t\t        \r\n\t\t\t\t<!-- üî• Êñ∞Â¢ûÔºöÁ≥ªÁªüÊ∂àÊÅØ -->\r\n\t\t\t\t<view v-if=\"msg.type === 'system'\" class=\"system-message\">\r\n\t\t\t\t\t<text class=\"system-text\">{{ msg.content }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\t\t\r\n\t\t        <!-- ÂØπÊñπÊ∂àÊÅØ(Â∑¶‰æß) -->\r\n\t\t        <view v-if=\"msg.type === 'received'\" class=\"message-wrapper left\">\r\n\t\t            <image class=\"avatar\" :src=\"goods_info.publisher_avatarUrl\" mode=\"aspectFill\" v-if=\"goods_info.publisher_id !== openid\"></image>\r\n\t\t\t\t\t<image class=\"avatar\" :src=\"other_avatarUrl\" mode=\"aspectFill\" v-else></image>\r\n\t\t            <view class=\"message-content\">\r\n\t\t                <!-- ÊñáÊú¨Ê∂àÊÅØ -->\r\n\t\t                <view v-if=\"msg.message_type === 'text' || !msg.message_type\" \r\n\t\t                      class=\"message-bubble left-bubble\" \r\n\t\t                      :class=\"{ 'payment-message': msg.is_payment }\">\r\n\t\t                    <text>{{ msg.content }}</text>\r\n\t\t                </view>\r\n\t\t                \r\n\t\t                <!-- ÂõæÁâáÊ∂àÊÅØ -->\r\n\t\t                <image v-else-if=\"msg.message_type === 'image'\" \r\n\t\t                       class=\"message-image\"\r\n\t\t                       :src=\"msg.content\" \r\n\t\t                       mode=\"aspectFill\"\r\n\t\t                       @click=\"previewImage(msg.content)\"></image>\r\n\t\t                \r\n\t\t                <!-- Ë°®ÊÉÖÂåÖÊ∂àÊÅØ -->\r\n\t\t                <image v-else-if=\"msg.message_type === 'emoji'\" \r\n\t\t                       class=\"message-emoji\"\r\n\t\t                       :src=\"msg.content\" \r\n\t\t                       mode=\"aspectFit\"\r\n\t\t                       @click=\"previewEmoji(msg.content)\"></image>\r\n\t\t                \r\n\t\t                <!-- ‰∫§ÊòìÊ∂àÊÅØ - Êñ∞Â¢û -->\r\n\t\t                <view v-else-if=\"msg.message_type === 'transaction'\" \r\n\t\t                      class=\"transaction-message left-transaction\">\r\n\t\t                    <view class=\"transaction-header\">\r\n\t\t                        <text class=\"transaction-icon\">ü§ù</text>\r\n\t\t                        <text class=\"transaction-title\">ÂèëËµ∑Á∫ø‰∏ã‰∫§Êòì</text>\r\n\t\t                    </view>\r\n\t\t                    <view class=\"transaction-body\">\r\n\r\n\t\t                        <view class=\"transaction-item\" v-if=\"msg.location\">\r\n\t\t                            <text class=\"label\">ËßÅÈù¢Âú∞ÁÇπ:</text>\r\n\t\t                            <text class=\"value location\">{{ msg.location }}</text>\r\n\t\t                        </view>\r\n\t\t                        <view class=\"transaction-item\" v-else>\r\n\t\t                            <text class=\"label\">ËßÅÈù¢Âú∞ÁÇπ:</text>\r\n\t\t                            <text class=\"value tips\">ÂæÖÂçèÂïÜ</text>\r\n\t\t                        </view>\r\n\t\t                    </view>\r\n\t\t                    <view class=\"transaction-footer\">\r\n\t\t                        <text class=\"status-text\">Á≠âÂæÖÂØπÊñπÁ°ÆËÆ§</text>\r\n\t\t                    </view>\r\n\t\t                </view>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<!-- ÂêåÊÑè‰∫§ÊòìÊ∂àÊÅØ - üî• Êñ∞Â¢û -->\r\n\t\t\t\t\t\t<view v-else-if=\"msg.message_type === 'agree'\" \r\n\t\t\t\t\t\t      :class=\"['agree-message', msg.type === 'sent' ? 'right-agree' : 'left-agree']\">\r\n\t\t\t\t\t\t    <view class=\"agree-header\">\r\n\t\t\t\t\t\t        <text class=\"agree-icon\">‚úÖ</text>\r\n\t\t\t\t\t\t        <text class=\"agree-title\">Â∑≤ÂêåÊÑèÁ∫ø‰∏ã‰∫§Êòì</text>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t    <view class=\"agree-body\">\r\n\t\t\t\t\t\t        <view class=\"agree-item\">\r\n\t\t\t\t\t\t            <text class=\"tips-text\">üí¨ ËØ∑ÂèåÊñπÂçèÂïÜÂÖ∑‰Ωì‰∫§Êòì‰∫ãÂÆú</text>\r\n\t\t\t\t\t\t        </view>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t    <view class=\"agree-footer\">\r\n\t\t\t\t\t\t        <text class=\"status-text\">‰∫§ÊòìËøõË°å‰∏≠</text>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<!-- ÂÆåÊàê‰∫§ÊòìÊ∂àÊÅØ - üî• Êñ∞Â¢û -->\r\n\t\t\t\t\t\t<view v-else-if=\"msg.message_type === 'finish'\" \r\n\t\t\t\t\t\t      class=\"finish-message left-finish\">\r\n\t\t\t\t\t\t    <view class=\"finish-header\">\r\n\t\t\t\t\t\t        <text class=\"finish-icon\">üéâ</text>\r\n\t\t\t\t\t\t        <text class=\"finish-title\">‰∫§ÊòìÂ∑≤ÂÆåÊàê</text>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t    <view class=\"finish-body\">\r\n\t\t\t\t\t\t        <view class=\"finish-item\">\r\n\t\t\t\t\t\t            <text class=\"tips-text\">‚úÖ ÊÑüË∞¢ÊÇ®ÁöÑ‰∫§ÊòìÔºåÊúüÂæÖ‰∏ãÊ¨°Âêà‰Ωú</text>\r\n\t\t\t\t\t\t        </view>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t    <view class=\"finish-footer\">\r\n\t\t\t\t\t\t        <text class=\"status-text\">‰∫§ÊòìÊàêÂäü</text>\r\n\t\t\t\t\t\t    </view>\r\n\t\t\t\t\t\t</view>\r\n\t\t            </view>\r\n\t\t        </view>\r\n\t\t\r\n\t\t       <!-- Ëá™Â∑±Ê∂àÊÅØ(Âè≥‰æß) -->\r\n\t\t       <view v-if=\"msg.type === 'sent'\" class=\"message-wrapper right\">\r\n\t\t           <view class=\"message-content\">\r\n\t\t               <!-- ÊñáÊú¨Ê∂àÊÅØ -->\r\n\t\t               <view v-if=\"msg.message_type === 'text' || !msg.message_type\" \r\n\t\t                     class=\"message-bubble right-bubble\" \r\n\t\t                     :class=\"{ 'payment-message': msg.is_payment }\">\r\n\t\t                   <text>{{ msg.content }}</text>\r\n\t\t               </view>\r\n\t\t               \r\n\t\t               <!-- ÂõæÁâáÊ∂àÊÅØ -->\r\n\t\t               <image v-else-if=\"msg.message_type === 'image'\" \r\n\t\t                      class=\"message-image\"\r\n\t\t                      :src=\"msg.content\" \r\n\t\t                      mode=\"aspectFill\"\r\n\t\t                      @click=\"previewImage(msg.content)\"></image>\r\n\t\t               \r\n\t\t               <!-- Ë°®ÊÉÖÂåÖÊ∂àÊÅØ -->\r\n\t\t               <image v-else-if=\"msg.message_type === 'emoji'\" \r\n\t\t                      class=\"message-emoji\"\r\n\t\t                      :src=\"msg.content\" \r\n\t\t                      mode=\"aspectFit\"\r\n\t\t\t\t\t\t\t   @click=\"previewEmoji(msg.content)\"></image>\r\n\t\t               \r\n\t\t               <!-- ‰∫§ÊòìÊ∂àÊÅØ -->\r\n\t\t               <view v-else-if=\"msg.message_type === 'transaction'\" \r\n\t\t                     class=\"transaction-message right-transaction\">\r\n\t\t                   <view class=\"transaction-header\">\r\n\t\t                       <text class=\"transaction-icon\">ü§ù</text>\r\n\t\t                       <text class=\"transaction-title\">ÂèëËµ∑Á∫ø‰∏ã‰∫§Êòì</text>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"transaction-body\">\r\n\t\t                       <view class=\"transaction-item\" v-if=\"msg.location\">\r\n\t\t                           <text class=\"label\">ËßÅÈù¢Âú∞ÁÇπ:</text>\r\n\t\t                           <text class=\"value location\">{{ msg.location }}</text>\r\n\t\t                       </view>\r\n\t\t                       <view class=\"transaction-item\" v-else>\r\n\t\t                           <text class=\"label\">ËßÅÈù¢Âú∞ÁÇπ:</text>\r\n\t\t                           <text class=\"value tips\">ÂæÖÂçèÂïÜ</text>\r\n\t\t                       </view>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"transaction-footer\">\r\n\t\t                       <text class=\"status-text\">Â∑≤ÂèëÈÄÅ‰∫§ÊòìËØ∑Ê±Ç</text>\r\n\t\t                   </view>\r\n\t\t               </view>\r\n\t\t               \r\n\t\t               <!-- ÂêåÊÑè‰∫§ÊòìÊ∂àÊÅØ -->\r\n\t\t               <view v-else-if=\"msg.message_type === 'agree'\" \r\n\t\t                     class=\"agree-message right-agree\">\r\n\t\t                   <view class=\"agree-header\">\r\n\t\t                       <text class=\"agree-icon\">‚úÖ</text>\r\n\t\t                       <text class=\"agree-title\">Â∑≤ÂêåÊÑèÁ∫ø‰∏ã‰∫§Êòì</text>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"agree-body\">\r\n\t\r\n\t\t\r\n\t\t                       <view class=\"agree-item\">\r\n\t\t                           <text class=\"tips-text\">üí¨ ËØ∑ÂèåÊñπÂçèÂïÜÂÖ∑‰Ωì‰∫§Êòì‰∫ãÂÆú</text>\r\n\t\t                       </view>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"agree-footer\">\r\n\t\t                       <text class=\"status-text\">‰∫§ÊòìËøõË°å‰∏≠</text>\r\n\t\t                   </view>\r\n\t\t               </view>\r\n\t\t               \r\n\t\t               <!-- ÂÆåÊàê‰∫§ÊòìÊ∂àÊÅØ - üî• ‰øÆÂ§çclassÂíåÂà†Èô§ÂÜÖÈÉ®Â§¥ÂÉè -->\r\n\t\t               <view v-else-if=\"msg.message_type === 'finish'\" \r\n\t\t                     class=\"finish-message right-finish\">\r\n\t\t                   <view class=\"finish-header\">\r\n\t\t                       <text class=\"finish-icon\">üéâ</text>\r\n\t\t                       <text class=\"finish-title\">‰∫§ÊòìÂ∑≤ÂÆåÊàê</text>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"finish-body\">\r\n\t\r\n\t\t                       <view class=\"finish-item\">\r\n\t\t                           <text class=\"tips-text\">‚úÖ ÊÑüË∞¢ÊÇ®ÁöÑ‰∫§ÊòìÔºåÊúüÂæÖ‰∏ãÊ¨°Âêà‰Ωú</text>\r\n\t\t                       </view>\r\n\t\t                   </view>\r\n\t\t                   <view class=\"finish-footer\">\r\n\t\t                       <text class=\"status-text\">‰∫§ÊòìÊàêÂäü</text>\r\n\t\t                   </view>\r\n\t\t               </view>\r\n\t\t           </view>\r\n\t\t           \r\n\t\t           <!-- üî• Âè™‰øùÁïôËøô‰∏Ä‰∏™Â§¥ÂÉè -->\r\n\t\t           <image class=\"avatar\" :src=\"userBase.avatarUrl\" mode=\"aspectFill\"></image>\r\n\t\t       </view>\r\n\t\t    </view>\r\n\t\t</scroll-view>\r\n\n\n\t\t<!-- Ë°®ÊÉÖÈù¢Êùø -->\n\t\t<view class=\"emoji-panel\" :class=\"{ 'show': showEmojiPanel }\">\n\t\t\t<scroll-view class=\"emoji-scroll\" scroll-y>\n\t\t\t\t<view class=\"emoji-grid\">\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"emoji-item\" \n\t\t\t\t\t\tv-for=\"(emoji, index) in emojiList\" \n\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t@click=\"selectEmoji(emoji)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<image class=\"emoji-image\" :src=\"emoji.url\" mode=\"aspectFit\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\n\t\t<!-- Â∫ïÈÉ®ËæìÂÖ•Ê†è - ‰øÆÊîπ -->\r\n\t\t<view class=\"input-bar\" :style=\"{ bottom: showEmojiPanel ? '250px' : '0' }\">\r\n\t\t    <input \r\n\t\t        class=\"input-field\" \r\n\t\t        v-model=\"inputText\" \r\n\t\t        placeholder=\"ÊÉ≥Ë∑üTAËØ¥ÁÇπ‰ªÄ‰πà...\" \r\n\t\t        confirm-type=\"send\"\r\n\t\t        @confirm=\"sendMessage\"\r\n\t\t        @focus=\"showEmojiPanel = false\"\r\n\t\t    />\r\n\t\t    <view class=\"emoji-btn\" @click=\"showEmojiPicker\">\r\n\t\t        <text class=\"iconfont\">üòä</text>\r\n\t\t    </view>\r\n\t\t    <view class=\"add-btn\" @click=\"showAddMenu\">\r\n\t\t        <text class=\"iconfont\">üìé</text>\r\n\t\t    </view>\r\n\t\t</view>\n\t\t\r\n\t\t<!-- üî• Êñ∞Â¢ûÔºöÊñ∞Ê∂àÊÅØÊèêÁ§∫ÊåâÈíÆ -->\r\n\t\t<view \r\n\t\t  class=\"new-message-tip\" \r\n\t\t  :class=\"{ 'show': showNewMessageTip }\"\r\n\t\t  @click=\"scrollToBottomWithTip\"\r\n\t\t>\r\n\t\t  <view class=\"tip-content\">\r\n\t\t    <text class=\"tip-icon\">üí¨</text>\r\n\t\t    <text class=\"tip-text\">{{ newMessageCount }}Êù°Êñ∞Ê∂àÊÅØ</text>\r\n\t\t    <text class=\"tip-arrow\">üëá</text>\r\n\t\t  </view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- Ë°®ÊÉÖÈù¢Êùø -->\r\n\t\t<view class=\"emoji-panel\" :class=\"{ 'show': showEmojiPanel }\">\r\n\t\t    <scroll-view scroll-y class=\"emoji-scroll\">\r\n\t\t        <view class=\"emoji-grid\">\r\n\t\t            <view class=\"emoji-item\" \r\n\t\t                  v-for=\"(emoji, index) in emojiList\" \r\n\t\t                  :key=\"index\"\r\n\t\t                  @click=\"selectEmoji(emoji)\">\r\n\t\t                <image class=\"emoji-image\" :src=\"emoji.url\" mode=\"aspectFit\"></image>\r\n\t\t            </view>\r\n\t\t        </view>\r\n\t\t    </scroll-view>\r\n\t\t</view>\r\n\t\t\n\t\t<!-- Ë¥≠‰π∞ÂºπÁ™ó -->\n\t\t<view class=\"purchase-popup\" :class=\"{ 'show': showPurchasePopup }\" @click=\"closePurchasePopup\">\n\t\t\t<view class=\"popup-content\" @click.stop>\n\t\t\t\t<view class=\"close-btn\" @click=\"closePurchasePopup\">\n\t\t\t\t\t<text class=\"iconfont\">‚úï</text>\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"popup-goods-info\">\n\t\t\t\t\t<image class=\"popup-goods-image\" :src=\"goods_info.goods_big_logo\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"popup-goods-detail\">\n\t\t\t\t\t\t<text class=\"popup-goods-name\">{{ goods_info.goods_name }}</text>\n\t\t\t\t\t\t<text class=\"popup-goods-price\">¬•{{ goods_info.goods_price }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"address-section\">\r\n\t\t\t\t    <view class=\"address-header\">\r\n\t\t\t\t        <text class=\"iconfont location-icon\">üìç</text>\r\n\t\t\t\t        <text class=\"address-title\">ÊúüÂæÖÁ∫ø‰∏ã‰∫§ÊòìÂú∞ÁÇπ</text>\r\n\t\t\t\t        <text class=\"address-tip\">(ÈÄâÂ°´)</text>\r\n\t\t\t\t    </view>\r\n\t\t\t\t    \r\n\t\t\t\t    <!-- ‰øÆÊîπËøôÈÉ®ÂàÜ -->\r\n\t\t\t\t    <view class=\"address-input-container\">\r\n\t\t\t\t        <textarea \r\n\t\t\t\t            class=\"address-input\"\r\n\t\t\t\t            v-model=\"addressInput\"\r\n\t\t\t\t            placeholder=\"ËØ∑ËæìÂÖ•Êî∂Ë¥ßÂú∞ÂùÄ(ÂèØ‰∏çÂ°´,‰ªòÊ¨æÂêéÂçèÂïÜ)\"\r\n\t\t\t\t            placeholder-class=\"address-placeholder\"\r\n\t\t\t\t            maxlength=\"200\"\r\n\t\t\t\t            :auto-height=\"true\"\r\n\t\t\t\t            :show-confirm-bar=\"false\"\r\n\t\t\t\t        />\r\n\t\t\t\t    </view>\r\n\t\t\t\t    \r\n\t\t\t\t    <!-- Â∞Ü‰øùÂ≠òÊåâÈíÆÁßªÂà∞Â§ñÈù¢ -->\r\n\t\t\t\t    <view class=\"save-address-btn\" \r\n\t\t\t\t          v-if=\"addressInput.trim()\"\r\n\t\t\t\t          @click.stop=\"saveAddress\">\r\n\t\t\t\t        <text>üíæ ‰øùÂ≠òÂú∞ÂùÄ</text>\r\n\t\t\t\t    </view>\r\n\t\t\t\t    \r\n\t\t\t\t    <view class=\"saved-address\" v-if=\"savedAddressText\">\r\n\t\t\t\t        <text class=\"saved-label\">Â∑≤‰øùÂ≠ò:</text>\r\n\t\t\t\t        <text class=\"saved-text\">{{ savedAddressText }}</text>\r\n\t\t\t\t    </view>\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"payment-section\">\r\n\t\t\t\t    <view class=\"payment-button\" @click=\"handleWechatPay\">\r\n\t\t\t\t        <text class=\"transaction-icon\">ü§ù</text>\r\n\t\t\t\t        <text class=\"payment-text\">Á°ÆËÆ§ÂèëËµ∑‰∫§Êòì</text>\r\n\t\t\t\t    </view>\r\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState, mapMutations } from 'vuex'\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmemberCode: 'x***3',\n\t\t\t\t// ËÅäÂ§©Ê∂àÊÅØÂàóË°®\n\t\t\t\tmessages: [],\n\t\t\t\t// ËæìÂÖ•Ê°ÜÂÜÖÂÆπ\n\t\t\t\tinputText: '',\n\t\t\t\t// ÊªöÂä®Âà∞ÁöÑÊ∂àÊÅØID\n\t\t\t\tscrollIntoView: '',\n\t\t\t\t// ÂïÜÂìÅ‰ø°ÊÅØ\n\t\t\t\tgoods_info: [],\n\t\t\t\t// ËΩÆËØ¢ÂÆöÊó∂Âô®\n\t\t\t\tpollingTimer: null,\n\t\t\t\t// ËΩÆËØ¢Èó¥Èöî(ÊØ´Áßí) - Âª∫ËÆÆ2-5Áßí\n\t\t\t\tpollingInterval: 3000,\n\t\t\t\t// ÊòØÂê¶Ê≠£Âú®ËØ∑Ê±Ç‰∏≠(Èò≤Ê≠¢ÈáçÂ§çËØ∑Ê±Ç)\n\t\t\t\tisRequesting: false,\n\t\t\t\t// ÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØÁöÑID(Áî®‰∫éÂà§Êñ≠ÊòØÂê¶ÊúâÊñ∞Ê∂àÊÅØ)\n\t\t\t\tlastMessageId: null,\n\t\t\t\totherOpenid: '',\n\t\t\t\tother_nickname: '',\r\n\t\t\t\tother_avatarUrl: '',\n\t\t\t\t// Ë¥≠‰π∞ÂºπÁ™óÁõ∏ÂÖ≥\n\t\t\t\tshowPurchasePopup: false,\n\t\t\t\t// Êî∂Ë¥ßÂú∞ÂùÄËæìÂÖ•Ê°Ü\n\t\t\t\taddressInput: '',\n\t\t\t\t// ÂΩìÂâçËÆ¢Âçï‰ø°ÊÅØ\n\t\t\t\tcurrentOrder: null,\r\n\t\t\t\t // Êñ∞Â¢ûÔºöË°®ÊÉÖÂåÖÁõ∏ÂÖ≥\r\n\t\t\t\t        showEmojiPanel: false,  // ÊéßÂà∂Ë°®ÊÉÖÈù¢ÊùøÊòæÁ§∫\r\n\t\t\t\t\t\temojiList: [\r\n\t\t\t\t\t\t\t{ id: 1, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-1.png', name: '[ÂæÆÁ¨ë]' },\r\n\t\t\t\t\t\t\t{ id: 2, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-2.png', name: '[Â§ßÁ¨ë]' },\r\n\t\t\t\t\t\t\t{ id: 3, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-3.png', name: '[Á¨ëÂì≠]' },\r\n\t\t\t\t\t\t\t{ id: 4, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-4.png', name: '[ÈöæËøá]' },\r\n\t\t\t\t\t\t\t{ id: 5, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-5.png', name: '[Â§ßÂì≠]' },\r\n\t\t\t\t\t\t\t{ id: 6, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-6.png', name: '[ÁñëÈóÆ]' },\r\n\t\t\t\t\t\t\t{ id: 7, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-7.png', name: '[Áà±ÂøÉ]' },\r\n\t\t\t\t\t\t\t{ id: 8, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-8.png', name: '[ÂæóÊÑè]' },\r\n\t\t\t\t\t\t\t{ id: 9, url: 'https://wait00.oss-cn-shanghai.aliyuncs.com/emoji/emoji-9.png', name: '[ÊÉäÊÅê]' },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t// Êñ∞Â¢ûÔºöÂõæÁâá‰∏ä‰º†Áõ∏ÂÖ≥\r\n\t\t\t\t\t\tuploading: false,\r\n\t\t\t\t\t\ttransactionStatus: 0, // 0=Êó†‰∫§Êòì, 1=‰π∞ÂÆ∂ÂèëËµ∑ÂæÖÁ°ÆËÆ§, 2=ÂçñÂÆ∂ÂêåÊÑè‰∫§Êòì‰∏≠, 3=‰∫§ÊòìÂÆåÊàê\r\n\t\t\t\t\t\tisTransactionInitiator: false, // ÊòØÂê¶ÊòØ‰∫§ÊòìÂèëËµ∑Êñπ(‰π∞ÂÆ∂)\r\n\t\t\t\t\t\t\t\t// üî• Êñ∞Â¢ûÔºö‰∫§ÊòìËøáÊúüÊó∂Èó¥(7Â§©ÔºåÂçï‰ΩçÊØ´Áßí)\r\n\t\t\t\t\t\tTRANSACTION_EXPIRE_TIME: 7 * 24 * 60 * 60 * 1000,\r\n\t\t\t\t\t\t // üî• Êñ∞Â¢ûÔºöÊñ∞Ê∂àÊÅØÊèêÁ§∫Áõ∏ÂÖ≥\r\n\t\t\t\t\t\t      showNewMessageTip: false,      // ÊòØÂê¶ÊòæÁ§∫Êñ∞Ê∂àÊÅØÊèêÁ§∫\r\n\t\t\t\t\t\t      newMessageCount: 0,             // Êñ∞Ê∂àÊÅØÊï∞Èáè\r\n\t\t\t\t\t\t      scrollTop: 0,                   // ÂΩìÂâçÊªöÂä®‰ΩçÁΩÆ\r\n\t\t\t\t\t\t      scrollThreshold: 100,           // ÈòàÂÄº(rpx)ÔºåË∑ùÁ¶ªÂ∫ïÈÉ®Â§öÂ∞ëÊó∂ÊòæÁ§∫ÊèêÁ§∫\r\n\t\t\t\t\t\t      isNearBottom: true,             // ÊòØÂê¶Êé•ËøëÂ∫ïÈÉ®\r\n\t\t\t\t\t\t      lastMessagesLength: 0,          // ‰∏ä‰∏ÄÊ¨°ÁöÑÊ∂àÊÅØÊï∞Èáè\r\n\t\t\t\t\t\t\t  scrollViewHeight: 0,\r\n\t\t\t\t\t\t\t\n\t\t\t};\n\t\t},\n\t\tasync onLoad(options) {\n\t\t\tconst queryObj = {code: this.openid};\n\t\t\tconst { data: res1 } = await uni.$http.get('/users/userinfo', queryObj);\n\t\t\tif (res1.meta.status === 200) {\n\t\t\t\tconsole.log(res1.message)\n\t\t\t\tthis.updateUserBase(res1.message)\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tif (options && options.goods_info) {\n\t\t\t\t\tconst chatData  = JSON.parse(decodeURIComponent(options.goods_info)) || null;\n\t\t\t\t\t// Âà§Êñ≠ÊòØÂê¶‰º†‰∫Ü other_openid\n\t\t\t\t\tif (chatData.other_openid) {\n\t\t\t\t\t\t// Êé•Êî∂ÂÆåÊï¥Êï∞ÊçÆ(ÂåÖÂê´ other_openid)\n\t\t\t\t\t\tthis.goods_info = chatData;\n\t\t\t\t\t\tthis.otherOpenid = chatData.other_openid;\n\t\t\t\t\t\tconsole.log('Êé•Êî∂Âà∞ other_openid:', this.otherOpenid);\n\t\t\t\t\t\tconst queryObj1 = {code: chatData.other_openid};\n\t\t\t\t\t\tconst { data: res1 } = await uni.$http.get('/users/userinfo', queryObj1);\n\t\t\t\t\t\tif (res1.meta.status === 200) {\n\t\t\t\t\t\t\tthis.other_nickname = res1.message.nickname\r\n\t\t\t\t\t\t\tthis.other_avatarUrl = res1.message.avatarUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Âè™Êé•Êî∂ goods_info\n\t\t\t\t\t\tthis.goods_info = chatData;\n\t\t\t\t\t\tconsole.log('Âè™Êé•Êî∂ goods_info');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('publisher Ëß£ÊûêÂ§±Ë¥•:', e)\n\t\t\t\tthis.goods_info = null\n\t\t\t}\n\t\t\t\n\t\t\t// ÂàùÂßãÂåñÂä†ËΩΩÊ∂àÊÅØ\n\t\t\tawait this.loadMessages();\n\t\t\t\r\n\t\t\t// üî• Êñ∞Â¢ûÔºöÂàùÂßãÂåñÊ∂àÊÅØÊï∞Èáè\r\n\t\t\t  this.lastMessagesLength = this.messages.length;\r\n\t\t\t  \n\t\t\t// Âä†ËΩΩÂΩìÂâçÂïÜÂìÅÁöÑËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\tawait this.loadCurrentOrder();\n\t\t\t\n\t\t\t// ÂêØÂä®ËΩÆËØ¢\n\t\t\tthis.startPolling();\n\t\t\t\n\t\t\t// Âä†ËΩΩÊú¨Âú∞‰øùÂ≠òÁöÑÂú∞ÂùÄ\n\t\t\tthis.loadLocalAddress();\r\n\t\t\t\r\n\t\t\t// üî• Êñ∞Â¢ûÔºöÁ°Æ‰øùÂàùÂßã‰ΩçÁΩÆÂú®Â∫ïÈÉ®\r\n\t\t\t  this.$nextTick(() => {\r\n\t\t\t    this.scrollToBottom();\r\n\t\t\t    this.isNearBottom = true;\r\n\t\t\t  });\n\t\t},\n\t\t\n\t\t// È°µÈù¢ÈöêËóèÊó∂ÂÅúÊ≠¢ËΩÆËØ¢\n\t\tonHide() {\n\t\t\tthis.stopPolling();\n\t\t},\n\t\t\r\n\t\t// Ê∑ªÂä† onReady ÁîüÂëΩÂë®Êúü\r\n\t\tonReady() {\r\n\t\t    uni.createSelectorQuery()\r\n\t\t        .select('.chat-content')\r\n\t\t        .boundingClientRect((rect) => {\r\n\t\t            if (rect) {\r\n\t\t                this.scrollViewHeight = rect.height;\r\n\t\t                console.log('üìè ËÅäÂ§©Âå∫ÂüüÈ´òÂ∫¶:', this.scrollViewHeight);\r\n\t\t            }\r\n\t\t        })\r\n\t\t        .exec();\r\n\t\t},\r\n\t\t\n\t\t// È°µÈù¢ÊòæÁ§∫Êó∂ÊÅ¢Â§çËΩÆËØ¢\n\t\tasync onShow() {\n\t\t\tif (this.goods_info && this.goods_info.goods_id) {\n\t\t\t\tthis.startPolling();\n\t\t\t}\n\t\t\t// ÈáçÊñ∞Âä†ËΩΩÊú¨Âú∞Âú∞ÂùÄ(ÂèØËÉΩÂú®ÂÖ∂‰ªñÈ°µÈù¢Ë¢´‰øÆÊîπ)\n\t\t\tawait this.loadLocalAddress();\n\t\t\t// ÈáçÊñ∞Âä†ËΩΩËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\tawait this.loadCurrentOrder();\n\t\t},\n\t\t\n\t\t// È°µÈù¢Âç∏ËΩΩÊó∂ÂÅúÊ≠¢ËΩÆËØ¢\n\t\tonUnload() {\n\t\t\tthis.stopPolling();\n\t\t},\n\t\t\n\t\tmethods: {\n\t\t\t...mapMutations('m_user', ['updateUserInfo', 'updateToken', 'updateUserBase', 'updateAddress']),\n\t\t\t\r\n\t\t\t// ÂÆåÊï¥ÁöÑ handleScroll\r\n\t\t\thandleScroll(e) {\r\n\t\t\t    const { scrollTop, scrollHeight, deltaY } = e.detail;\r\n\t\t\t    this.scrollTop = scrollTop;\r\n\t\t\t    \r\n\t\t\t    // ËÆ°ÁÆóË∑ùÁ¶ªÂ∫ïÈÉ®ÁöÑË∑ùÁ¶ª\r\n\t\t\t    let distanceToBottom = 0;\r\n\t\t\t    if (this.scrollViewHeight > 0) {\r\n\t\t\t        distanceToBottom = scrollHeight - scrollTop - this.scrollViewHeight;\r\n\t\t\t        this.isNearBottom = distanceToBottom < this.scrollThreshold;\r\n\t\t\t    } else {\r\n\t\t\t        // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî®ÁôæÂàÜÊØî\r\n\t\t\t        const scrollPercentage = scrollTop / scrollHeight;\r\n\t\t\t        this.isNearBottom = scrollPercentage > 0.95;\r\n\t\t\t    }\r\n\t\t\t    \r\n\t\t\t    console.log('üìä', {\r\n\t\t\t        scrollTop: scrollTop.toFixed(0),\r\n\t\t\t        scrollHeight,\r\n\t\t\t        viewHeight: this.scrollViewHeight,\r\n\t\t\t        distanceToBottom: distanceToBottom.toFixed(0),\r\n\t\t\t        isNearBottom: this.isNearBottom\r\n\t\t\t    });\r\n\t\t\t    \r\n\t\t\t    // ÊªöÂä®Âà∞Â∫ïÈÉ®Êó∂Ê∏ÖÈô§ÊèêÁ§∫\r\n\t\t\t    if (this.isNearBottom && this.showNewMessageTip) {\r\n\t\t\t        this.showNewMessageTip = false;\r\n\t\t\t        this.newMessageCount = 0;\r\n\t\t\t    }\r\n\t\t\t},\r\n\t\t\t  \r\n\t\t\t  /**\r\n\t\t\t   * üî• Ëß¶Â∫ï‰∫ã‰ª∂\r\n\t\t\t   */\r\n\t\t\t  handleScrollToLower() {\r\n\t\t\t    this.isNearBottom = true;\r\n\t\t\t    if (this.showNewMessageTip) {\r\n\t\t\t      this.showNewMessageTip = false;\r\n\t\t\t      this.newMessageCount = 0;\r\n\t\t\t    }\r\n\t\t\t  },\r\n\t\t\t  \r\n\t\t\t  /**\r\n\t\t\t   * üî• ÁÇπÂáªÊñ∞Ê∂àÊÅØÊèêÁ§∫Ë∑≥ËΩ¨Âà∞Â∫ïÈÉ®\r\n\t\t\t   */\r\n\t\t\t  scrollToBottomWithTip() {\r\n\t\t\t    this.showNewMessageTip = false;\r\n\t\t\t    this.newMessageCount = 0;\r\n\t\t\t    this.isNearBottom = true;\r\n\t\t\t    \r\n\t\t\t    this.$nextTick(() => {\r\n\t\t\t      this.scrollToBottom();\r\n\t\t\t    });\r\n\t\t\t  },\r\n\t\t\t  \r\n\t\t\t/**\r\n\t\t\t         * üî• Êñ∞Â¢ûÔºöÊ£ÄÊü•‰∫§ÊòìÊòØÂê¶ËøáÊúü\r\n\t\t\t         */\r\n\t\t\t        async checkTransactionExpiration() {\r\n\t\t\t            try {\r\n\t\t\t                // Êü•ÊâæÊúÄÂêé‰∏ÄÊù°‰∫§ÊòìÊ∂àÊÅØ\r\n\t\t\t                const lastTransactionMsg = [...this.messages]\r\n\t\t\t                    .reverse()\r\n\t\t\t                    .find(msg => msg.message_type === 'transaction');\r\n\t\t\t                \r\n\t\t\t                if (!lastTransactionMsg) {\r\n\t\t\t                    return;\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊúâÂêåÊÑè„ÄÅÂÆåÊàêÊàñÁ≥ªÁªüÂÖ≥Èó≠Ê∂àÊÅØ\r\n\t\t\t                const hasAgreeMsg = this.messages.some(msg => msg.message_type === 'agree');\r\n\t\t\t                const hasFinishMsg = this.messages.some(msg => msg.message_type === 'finish');\r\n\t\t\t                const hasSystemCloseMsg = this.messages.some(msg => \r\n\t\t\t                    msg.message_type === 'system' && \r\n\t\t\t                    msg.content && \r\n\t\t\t                    msg.content.includes('‰∫§ÊòìËá™Âä®ÂÖ≥Èó≠')\r\n\t\t\t                );\r\n\t\t\t                \r\n\t\t\t                // Â¶ÇÊûúÂ∑≤ÁªèÊúâÂêéÁª≠Êìç‰ΩúÔºå‰∏çÈúÄË¶ÅÊ£ÄÊü•ËøáÊúü\r\n\t\t\t                if (hasAgreeMsg || hasFinishMsg || hasSystemCloseMsg) {\r\n\t\t\t                    return;\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                // Ëß£Êûê‰∫§ÊòìÊ∂àÊÅØÊó∂Èó¥Êà≥ÔºàÁßíËΩ¨ÊØ´ÁßíÔºâ\r\n\t\t\t                const transactionTime = lastTransactionMsg.created_at * 1000;\r\n\t\t\t                const now = Date.now();\r\n\t\t\t                const timePassed = now - transactionTime;\r\n\t\t\t                \r\n\t\t\t                // üî• Â¶ÇÊûúË∂ÖËøá7Â§©ÔºåÂèëÈÄÅÁ≥ªÁªüÊ∂àÊÅØÂÖ≥Èó≠‰∫§Êòì\r\n\t\t\t                if (timePassed > this.TRANSACTION_EXPIRE_TIME) {\r\n\t\t\t                    console.log('‚è∞ ‰∫§ÊòìÂ∑≤ËøáÊúüÔºåËá™Âä®ÂÖ≥Èó≠');\r\n\t\t\t                    await this.sendSystemCloseMessage();\r\n\t\t\t                }\r\n\t\t\t            } catch (error) {\r\n\t\t\t                console.error('‚ùå Ê£ÄÊü•‰∫§ÊòìËøáÊúüÂ§±Ë¥•:', error);\r\n\t\t\t            }\r\n\t\t\t        },\r\n\t\t\t        \r\n\t\t\t        /**\r\n\t\t\t         * üî• Êñ∞Â¢ûÔºöÂèëÈÄÅÁ≥ªÁªüÂÖ≥Èó≠‰∫§ÊòìÊ∂àÊÅØ\r\n\t\t\t         */\r\n\t\t\t        async sendSystemCloseMessage() {\r\n\t\t\t            try {\r\n\t\t\t                const systemMessage = 'Âõ†7Â§©‰πãÂÜÖÂçñÂÆ∂Ê≤°ÊúâÂêåÊÑèÔºåËØ•‰∫§ÊòìËá™Âä®ÂÖ≥Èó≠';\r\n\t\t\t                \r\n\t\t\t                const reqObj = {\r\n\t\t\t                    openid1: this.openid,\r\n\t\t\t                    openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t                            ? this.goods_info.publisher_id \r\n\t\t\t                            : this.goods_info.other_openid,\r\n\t\t\t                    goods_id: this.goods_info.goods_id,\r\n\t\t\t                    senderid: 'system', // üî• Ê†áËÆ∞‰∏∫Á≥ªÁªüÊ∂àÊÅØ\r\n\t\t\t                    content: systemMessage,\r\n\t\t\t                    message_type: 'system',\r\n\t\t\t                };\r\n\t\t\t                \r\n\t\t\t                const { data: res } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t\t                \r\n\t\t\t                if (res.meta.status === 200) {\r\n\t\t\t                    // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫Êó†‰∫§Êòì\r\n\t\t\t                    this.transactionStatus = 0;\r\n\t\t\t                    this.isTransactionInitiator = false;\r\n\t\t\t                    \r\n\t\t\t                    // Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\r\n\t\t\t                    const newMessages = this.processMessages(res.message.messages);\r\n\t\t\t                    this.messages = newMessages;\r\n\t\t\t                    \r\n\t\t\t                    if (newMessages.length > 0) {\r\n\t\t\t                        this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t                                            newMessages[newMessages.length - 1].created_at;\r\n\t\t\t                    }\r\n\t\t\t                    \r\n\t\t\t                    // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ\r\n\t\t\t                    this.$nextTick(() => {\r\n\t\t\t                        this.scrollToBottom();\r\n\t\t\t                    });\r\n\t\t\t                    \r\n\t\t\t                    console.log('‚úÖ Á≥ªÁªüÂÖ≥Èó≠‰∫§ÊòìÊ∂àÊÅØÂ∑≤ÂèëÈÄÅ');\r\n\t\t\t                }\r\n\t\t\t            } catch (error) {\r\n\t\t\t                console.error('‚ùå ÂèëÈÄÅÁ≥ªÁªüÊ∂àÊÅØÂ§±Ë¥•:', error);\r\n\t\t\t            }\r\n\t\t\t        },\r\n\t\t\t\t\t\r\n\t\t\t/**\r\n\t\t\t * ‰π∞ÂÆ∂Á°ÆËÆ§‰∫§ÊòìÂÆåÊàê\r\n\t\t\t */\r\n\t\t\tasync finish() {\r\n\t\t\t    try {\r\n\t\t\t        // ‰∫åÊ¨°Á°ÆËÆ§\r\n\t\t\t        const [err, res] = await uni.showModal({\r\n\t\t\t            title: 'Á°ÆËÆ§‰∫§ÊòìÂÆåÊàê',\r\n\t\t\t            content: 'Á°ÆËÆ§Â∑≤ÂÆåÊàêÁ∫ø‰∏ã‰∫§ÊòìÔºüÁ°ÆËÆ§Âêé‰∫§ÊòìÁä∂ÊÄÅÂ∞ÜÂèò‰∏∫Â∑≤ÂÆåÊàê',\r\n\t\t\t            confirmText: 'Á°ÆËÆ§ÂÆåÊàê',\r\n\t\t\t            cancelText: 'ÂèñÊ∂à'\r\n\t\t\t        });\r\n\t\t\t        \r\n\t\t\t        if (err || !res.confirm) {\r\n\t\t\t            return;\r\n\t\t\t        }\r\n\t\t\t        \r\n\t\t\t        uni.showLoading({\r\n\t\t\t            title: 'Á°ÆËÆ§‰∏≠...',\r\n\t\t\t            mask: true\r\n\t\t\t        });\r\n\t\t\t        \r\n\t\t\t        // ÊûÑÂª∫ÂÆåÊàê‰∫§ÊòìÊ∂àÊÅØÂÜÖÂÆπ\r\n\t\t\t        const finishData = {\r\n\t\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t\t            goods_name: this.goods_info.goods_name,\r\n\t\t\t            goods_price: this.goods_info.goods_price,\r\n\t\t\t            timestamp: Date.now()\r\n\t\t\t        };\r\n\t\t\t        \r\n\t\t\t        // ÂèëÈÄÅ\"‰∫§ÊòìÂÆåÊàê\"Á±ªÂûãÁöÑÊ∂àÊÅØ\r\n\t\t\t        const reqObj = {\r\n\t\t\t            openid1: this.openid,\r\n\t\t\t            openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t                    ? this.goods_info.publisher_id \r\n\t\t\t                    : this.goods_info.other_openid,\r\n\t\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t\t            senderid: this.openid,\r\n\t\t\t            content: JSON.stringify(finishData),\r\n\t\t\t            message_type: 'finish',  // üî• ‰∫§ÊòìÂÆåÊàêÊ∂àÊÅØÁ±ªÂûã\r\n\t\t\t        };\r\n\t\t\t        \r\n\t\t\t        const { data: res2 } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t\t        \r\n\t\t\t        uni.hideLoading();\r\n\t\t\t        \r\n\t\t\t        if (res2.meta.status === 200) {\r\n\t\t\t            // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫‰∫§ÊòìÂÆåÊàê\r\n\t\t\t            this.transactionStatus = 3;\r\n\t\t\t            \r\n\t\t\t            // Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\r\n\t\t\t            const newMessages = this.processMessages(res2.message.messages);\r\n\t\t\t            this.messages = newMessages;\r\n\t\t\t            \r\n\t\t\t            if (newMessages.length > 0) {\r\n\t\t\t                this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t                                    newMessages[newMessages.length - 1].created_at;\r\n\t\t\t            }\r\n\t\t\t            \r\n\t\t\t            uni.showToast({\r\n\t\t\t                title: '‰∫§ÊòìÂ∑≤ÂÆåÊàê',\r\n\t\t\t                icon: 'success',\r\n\t\t\t                duration: 2000\r\n\t\t\t            });\r\n\t\t\t            \r\n\t\t\t            // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ\r\n\t\t\t            this.$nextTick(() => {\r\n\t\t\t                this.scrollToBottom();\r\n\t\t\t            });\r\n\t\t\t        } else {\r\n\t\t\t            uni.showToast({\r\n\t\t\t                title: res2.meta.msg || 'Êìç‰ΩúÂ§±Ë¥•',\r\n\t\t\t                icon: 'none'\r\n\t\t\t            });\r\n\t\t\t        }\r\n\t\t\t    } catch (error) {\r\n\t\t\t        uni.hideLoading();\r\n\t\t\t        console.error('Á°ÆËÆ§‰∫§ÊòìÂÆåÊàêÂ§±Ë¥•:', error);\r\n\t\t\t        uni.showToast({\r\n\t\t\t            title: 'Êìç‰ΩúÂ§±Ë¥•',\r\n\t\t\t            icon: 'none'\r\n\t\t\t        });\r\n\t\t\t    }\r\n\t\t\t},\r\n\r\n\r\n\t\t\t/**\r\n\t\t\t * È¢ÑËßàË°®ÊÉÖÂåÖ(ÊîæÂ§ßÊü•Áúã)\r\n\t\t\t */\r\n\t\t\tpreviewEmoji(emojiUrl) {\r\n\t\t\t    uni.previewImage({\r\n\t\t\t        current: emojiUrl,\r\n\t\t\t        urls: [emojiUrl]\r\n\t\t\t    });\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t /**\r\n\t\t\t     * ÈÄâÊã©Ë°®ÊÉÖÂåÖÂèëÈÄÅ\r\n\t\t\t     */\r\n\t\t\t    async selectEmoji(emoji) {\r\n\t\t\t        try {\r\n\t\t\t            const reqObj = {\r\n\t\t\t                openid1: this.openid,\r\n\t\t\t                openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t                        ? this.goods_info.publisher_id \r\n\t\t\t                        : this.goods_info.other_openid,\r\n\t\t\t                goods_id: this.goods_info.goods_id,\r\n\t\t\t                senderid: this.openid,\r\n\t\t\t                content: emoji.url,\r\n\t\t\t                message_type: 'emoji',  // Ê†áËÆ∞‰∏∫ÂõæÁâáÊ∂àÊÅØ\r\n\t\t\t                // sub_type: 'emoji'       // Ê†áËÆ∞‰∏∫Ë°®ÊÉÖÂåÖ\r\n\t\t\t            };\r\n\t\t\t            \r\n\t\t\t            const { data: res } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t\t            \r\n\t\t\t            if (res.meta.status === 200) {\r\n\t\t\t                const newMessages = this.processMessages(res.message.messages);\r\n\t\t\t                this.messages = newMessages;\r\n\t\t\t                \r\n\t\t\t                if (newMessages.length > 0) {\r\n\t\t\t                    this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t                                        newMessages[newMessages.length - 1].created_at;\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                this.$nextTick(() => {\r\n\t\t\t                    this.scrollToBottom();\r\n\t\t\t                });\r\n\t\t\t                \r\n\t\t\t                // ÂèëÈÄÅÊàêÂäüÂêéÂÖ≥Èó≠Ë°®ÊÉÖÈù¢Êùø\r\n\t\t\t                this.showEmojiPanel = false;\r\n\t\t\t            }\r\n\t\t\t        } catch (error) {\r\n\t\t\t            console.error('‚ùå ÂèëÈÄÅË°®ÊÉÖÂ§±Ë¥•:', error);\r\n\t\t\t            uni.showToast({\r\n\t\t\t                title: 'ÂèëÈÄÅÂ§±Ë¥•',\r\n\t\t\t                icon: 'none'\r\n\t\t\t            });\r\n\t\t\t        }\r\n\t\t\t    },\r\n\t\t\t\t\n\t\t\t/**\n\t\t\t * Âä†ËΩΩÂΩìÂâçÂïÜÂìÅÁöÑËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\t */\n\t\t\tasync loadCurrentOrder() {\n\t\t\t\ttry {\n\t\t\t\t\t// ÂÅáËÆæÂêéÁ´ØÊúâ‰∏Ä‰∏™Êé•Âè£ÂèØ‰ª•Êü•ËØ¢ÂΩìÂâçÁî®Êà∑ÂØπËØ•ÂïÜÂìÅÁöÑÊúÄÊñ∞ËÆ¢Âçï\n\t\t\t\t\tconst { data: res } = await uni.$http.get('/orders/current', {\n\t\t\t\t\t\tuser_openid: this.userBase.openid,\n\t\t\t\t\t\tgoods_id: this.goods_info.goods_id,\n\t\t\t\t\t\t_hideLoading: true\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (res.code === 200 && res.data) {\n\t\t\t\t\t\tthis.currentOrder = res.data;\n\t\t\t\t\t\tconsole.log('üì¶ ÂΩìÂâçËÆ¢ÂçïÁä∂ÊÄÅ:', this.currentOrder);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.currentOrder = null;\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('‚ùå Âä†ËΩΩËÆ¢ÂçïÁä∂ÊÄÅÂ§±Ë¥•:', error);\n\t\t\t\t\tthis.currentOrder = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Á°ÆËÆ§Êî∂Ë¥ß\n\t\t\t */\n\t\t\tasync confirmReceipt() {\n\t\t\t\t// ‰∫åÊ¨°Á°ÆËÆ§\n\t\t\t\tconst [err, res] = await uni.showModal({\n\t\t\t\t\ttitle: 'Á°ÆËÆ§Êî∂Ë¥ß',\n\t\t\t\t\tcontent: 'Á°ÆËÆ§Â∑≤Êî∂Âà∞ÂïÜÂìÅ?Êî∂Ë¥ßÂêéÊ¨æÈ°πÂ∞ÜËΩ¨ÂÖ•ÂçñÂÆ∂Ë¥¶Êà∑',\n\t\t\t\t\tconfirmText: 'Á°ÆËÆ§Êî∂Ë¥ß',\n\t\t\t\t\tcancelText: 'ÂèñÊ∂à'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (err || !res.confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\ttitle: 'Â§ÑÁêÜ‰∏≠...',\n\t\t\t\t\t\tmask: true\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tconst { data: result } = await uni.$http.post('/orders/confirm_receipt', {\n\t\t\t\t\t\torder_number: this.currentOrder.order_number,\n\t\t\t\t\t\topenid: this.userBase.openid\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\n\t\t\t\t\tif (result.meta.status === 200) {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: 'Á°ÆËÆ§Êî∂Ë¥ßÊàêÂäü',\n\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\t\t\t\tthis.currentOrder.order_status = 3;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// ÂèëÈÄÅÁ°ÆËÆ§Êî∂Ë¥ßÊ∂àÊÅØ\n\t\t\t\t\t\tawait this.sendPaymentMessage('ÊàëÂ∑≤Á°ÆËÆ§Êî∂Ë¥ß,‰∫§ÊòìÂÆåÊàê!');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\n\t\t\t\t\t\tawait this.loadMessages();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: result.meta.msg || 'Á°ÆËÆ§Êî∂Ë¥ßÂ§±Ë¥•',\n\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tconsole.error('‚ùå Á°ÆËÆ§Êî∂Ë¥ßÂ§±Ë¥•:', error);\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'Á°ÆËÆ§Êî∂Ë¥ßÂ§±Ë¥•,ËØ∑ÈáçËØï',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t/**\r\n\t\t\t * üî• ‰øÆÊîπÔºöÂä†ËΩΩÊ∂àÊÅØÊó∂Ê£ÄÊü•ÊòØÂê¶ÊúâÊñ∞Ê∂àÊÅØ\r\n\t\t\t */\r\n\t\t\tasync loadMessages(silent = false) {\r\n\t\t\t  if (this.isRequesting) return;\r\n\t\t\t  \r\n\t\t\t  this.isRequesting = true;\r\n\t\t\t  \r\n\t\t\t  try {\r\n\t\t\t    const req = {\r\n\t\t\t      openid1: this.openid,\r\n\t\t\t      openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t              ? this.goods_info.publisher_id \r\n\t\t\t              : this.goods_info.other_openid,\r\n\t\t\t      goods_id: this.goods_info.goods_id,\r\n\t\t\t      _hideLoading: true\r\n\t\t\t    };\r\n\t\t\t    \r\n\t\t\t    const { data: res } = await uni.$http.get('/chats/message', req);\r\n\t\t\t    \r\n\t\t\t    if (res.meta.status === 200) {\r\n\t\t\t      const newMessages = this.processMessages(res.message.messages);\r\n\t\t\t      \r\n\t\t\t      if (newMessages.length > 0) {\r\n\t\t\t        const newLastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t                                newMessages[newMessages.length - 1].created_at;\r\n\t\t\t        \r\n\t\t\t        // üî• Êñ∞Â¢ûÔºöÊ£ÄÊµãÊòØÂê¶ÊúâÊñ∞Ê∂àÊÅØ\r\n\t\t\t        if (this.lastMessageId !== newLastMessageId) {\r\n\t\t\t          const hadMessages = this.messages.length > 0;\r\n\t\t\t          const oldLength = this.messages.length;\r\n\t\t\t          \r\n\t\t\t          this.messages = newMessages;\r\n\t\t\t          this.lastMessageId = newLastMessageId;\r\n\t\t\t          \r\n\t\t\t          await this.checkTransactionExpiration();\r\n\t\t\t          \r\n\t\t\t          // üî• Êñ∞Â¢ûÔºöÂ§ÑÁêÜÊñ∞Ê∂àÊÅØÈÄªËæë\r\n\t\t\t          if (hadMessages && !silent) {\r\n\t\t\t            const newMessagesCount = newMessages.length - oldLength;\r\n\t\t\t            \r\n\t\t\t            // Ê£ÄÊü•ÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØÊòØÂê¶ÊòØÂà´‰∫∫ÂèëÁöÑ\r\n\t\t\t            const lastMessage = newMessages[newMessages.length - 1];\r\n\t\t\t            const isFromOther = lastMessage.openid !== this.openid && \r\n\t\t\t                               lastMessage.message_type !== 'system';\r\n\t\t\t            \r\n\t\t\t            if (newMessagesCount > 0 && isFromOther) {\r\n\t\t\t              if (this.isNearBottom) {\r\n\t\t\t                // Â¶ÇÊûúÊé•ËøëÂ∫ïÈÉ®ÔºåËá™Âä®ÊªöÂä®\r\n\t\t\t                this.$nextTick(() => {\r\n\t\t\t                  this.scrollToBottom();\r\n\t\t\t                });\r\n\t\t\t              } else {\r\n\t\t\t                // Â¶ÇÊûú‰∏çÂú®Â∫ïÈÉ®ÔºåÊòæÁ§∫ÊèêÁ§∫\r\n\t\t\t                this.newMessageCount += newMessagesCount;\r\n\t\t\t                this.showNewMessageTip = true;\r\n\t\t\t              }\r\n\t\t\t            } else {\r\n\t\t\t              // Ëá™Â∑±ÂèëÁöÑÊ∂àÊÅØÔºåÁõ¥Êé•ÊªöÂä®Âà∞Â∫ïÈÉ®\r\n\t\t\t              this.$nextTick(() => {\r\n\t\t\t                this.scrollToBottom();\r\n\t\t\t              });\r\n\t\t\t            }\r\n\t\t\t          }\r\n\t\t\t        }\r\n\t\t\t      } else {\r\n\t\t\t        this.messages = newMessages;\r\n\t\t\t      }\r\n\t\t\t    }\r\n\t\t\t  } catch (error) {\r\n\t\t\t    console.error('Âä†ËΩΩÊ∂àÊÅØÂ§±Ë¥•:', error);\r\n\t\t\t  } finally {\r\n\t\t\t    this.isRequesting = false;\r\n\t\t\t  }\r\n\t\t\t},\n\t\t\t\n\t\t\t// ÂêØÂä®ËΩÆËØ¢\n\t\t\tstartPolling() {\n\t\t\t\t// ÂÖàÊ∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÂÆöÊó∂Âô®\n\t\t\t\tthis.stopPolling();\n\t\t\t\t\n\t\t\t\t// ÂêØÂä®Êñ∞ÁöÑÂÆöÊó∂Âô®\n\t\t\t\tthis.pollingTimer = setInterval(() => {\n\t\t\t\t\tthis.loadMessages(true); // silent=true ÈùôÈªòÂä†ËΩΩ,‰∏çÊòæÁ§∫ÊèêÁ§∫\n\t\t\t\t\tthis.loadCurrentOrder(); // ÂêåÊó∂ËΩÆËØ¢ËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\t\t}, this.pollingInterval);\n\t\t\t},\n\t\t\t\n\t\t\t// ÂÅúÊ≠¢ËΩÆËØ¢\n\t\t\tstopPolling() {\n\t\t\t\tif (this.pollingTimer) {\n\t\t\t\t\tclearInterval(this.pollingTimer);\n\t\t\t\t\tthis.pollingTimer = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// ËøîÂõû‰∏ä‰∏ÄÈ°µ\n\t\t\tgoBack() {\n\t\t\t\tuni.navigateBack();\n\t\t\t},\n\t\t\t\n\t\t\t// ÊòæÁ§∫Êõ¥Â§öÊìç‰Ωú\n\t\t\tshowMoreOptions() {\n\t\t\t\tuni.showActionSheet({\n\t\t\t\t\titemList: ['‰∏æÊä•'],\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.tapIndex === 0) {\r\n\t\t\t\t\t\t\tthis.reportUser()\r\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\r\n\t\t\t// ‰∏æÊä•Áî®Êà∑\r\n\t\t\t\t\treportUser() {\r\n\t\t\t\t\t\t// ÂÆâÂÖ®Ê£ÄÊü•\r\n\t\t\t\t\t\tif (!this.openid) {\r\n\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t  url: '/pages/my/my',\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\t\t// ÂºπÂá∫‰∏Ä‰∏™ÂèØÁºñËæëÁöÑËæìÂÖ•Ê°Ü\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: 'ËØ∑ËæìÂÖ•ÊÇ®‰∏æÊä•ËØ•Áî®Êà∑ÁöÑÁêÜÁî±:',\r\n\t\t\t\t\t\t\teditable: true, // ÊòæÁ§∫ËæìÂÖ•Ê°Ü\r\n\t\t\t\t\t\t\tplaceholderText: '‰æãÂ¶ÇÔºöÊ∂âÂèä‰∫∫Ë∫´ÊîªÂáª„ÄÅÂπøÂëäÁ≠â',\r\n\t\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\t\t// Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÁÇπÂáª‰∫Ü‚ÄúÁ°ÆÂÆö‚Äù\r\n\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\tconst reason = res.content.trim() // Ëé∑ÂèñËæìÂÖ•Ê°ÜÂÜÖÂÆπ\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// È™åËØÅÁêÜÁî±ÊòØÂê¶‰∏∫Á©∫\r\n\t\t\t\t\t\t\t\t\tif (!reason) {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '‰∏æÊä•ÁêÜÁî±‰∏çËÉΩ‰∏∫Á©∫',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\t// ÂáÜÂ§áÊèê‰∫§Âà∞ÂêéÁ´ØÁöÑÊï∞ÊçÆ\r\n\t\t\t\t\t\t\t\t\tconst reportData = {\r\n\t\t\t\t\t\t\t\t\t\treporter_openid: this.openid, // ‰∏æÊä•‰∫∫ (ÂΩìÂâçÁî®Êà∑)\r\n\t\t\t\t\t\t\t\t\t\treported_openid: this.goods_info.publisher_id, // Ë¢´‰∏æÊä•‰∫∫ (Â∏ñÂ≠ê‰ΩúËÄÖ)\r\n\t\t\t\t\t\t\t\t\t\tpost_id: 0, \r\n\t\t\t\t\t\t\t\t\t\tgoods_id: this.goods_info.goods_id, // Áõ∏ÂÖ≥Â∏ñÂ≠êID\r\n\t\t\t\t\t\t\t\t\t\treason: reason // ‰∏æÊä•ÁêÜÁî±\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tconsole.log('Êèê‰∫§‰∏æÊä•:', reportData)\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t// Ë∞ÉÁî®ÂêéÁ´Ø /users/report Êé•Âè£\r\n\t\t\t\t\t\t\t\t\t\tconst { data: apiRes } = await uni.$http.post('/users/report', reportData)\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t// Ê†πÊçÆÂêéÁ´ØËøîÂõûÁöÑÁä∂ÊÄÅÁ†ÅÂ§ÑÁêÜ\r\n\t\t\t\t\t\t\t\t\t\tif (apiRes.meta.status === 201) {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: '‰∏æÊä•ÊàêÂäüÔºåÊàë‰ª¨‰ºöÂ∞ΩÂø´Ê†∏ÂÆû',\r\n\t\t\t\t\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t// ÊòæÁ§∫ÂêéÁ´ØËøîÂõûÁöÑÈîôËØØ‰ø°ÊÅØ\r\n\t\t\t\t\t\t\t\t\t\t\tthrow new Error(apiRes.meta.msg || '‰∏æÊä•Â§±Ë¥•')\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.error('‰∏æÊä•Â§±Ë¥•:', error)\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: error.message || '‰∏æÊä•Êó∂ÂèëÁîüÈîôËØØ',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\n\t\t\t// Á´ãÂç≥Ë¥≠‰π∞ - ÊòæÁ§∫ÂºπÁ™ó\n\t\t\tbuyNow() {\n\t\t\t\tthis.showPurchasePopup = true;\n\t\t\t\t// ÊØèÊ¨°ÊâìÂºÄÂºπÁ™óÊó∂ÈáçÊñ∞Âä†ËΩΩÂú∞ÂùÄ\n\t\t\t\tthis.loadLocalAddress();\n\t\t\t},\n\t\t\t\n\t\t\t// ÂÖ≥Èó≠Ë¥≠‰π∞ÂºπÁ™ó\n\t\t\tclosePurchasePopup() {\n\t\t\t\tthis.showPurchasePopup = false;\n\t\t\t},\n\t\t\t\n\t\t\t// Âä†ËΩΩÊú¨Âú∞‰øùÂ≠òÁöÑÂú∞ÂùÄ\n\t\t\tloadLocalAddress() {\n\t\t\t\t// ‰ªé Vuex ‰∏≠Ëé∑ÂèñÊú¨Âú∞‰øùÂ≠òÁöÑÂú∞ÂùÄ\n\t\t\t\tif (this.address && typeof this.address === 'object' && Object.keys(this.address).length > 0) {\n\t\t\t\t\t// Â¶ÇÊûúÂú∞ÂùÄÂØπË±°Êúâ fullAddress Â≠óÊÆµ,Áõ¥Êé•‰ΩøÁî®\n\t\t\t\t\tif (this.address.fullAddress) {\n\t\t\t\t\t\tthis.addressInput = this.address.fullAddress;\n\t\t\t\t\t} \n\t\t\t\t\t// Â¶ÇÊûúÊòØÁªìÊûÑÂåñÂú∞ÂùÄ,ÊãºÊé•ÊòæÁ§∫\n\t\t\t\t\telse if (this.address.provinceName || this.address.cityName) {\n\t\t\t\t\t\tconst addressParts = [\n\t\t\t\t\t\t\tthis.address.provinceName,\n\t\t\t\t\t\t\tthis.address.cityName,\n\t\t\t\t\t\t\tthis.address.countyName,\n\t\t\t\t\t\t\tthis.address.detailInfo\n\t\t\t\t\t\t].filter(part => part); // ËøáÊª§ÊéâÁ©∫ÂÄº\n\t\t\t\t\t\tthis.addressInput = addressParts.join(' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// ‰øùÂ≠òÊî∂Ë¥ßÂú∞ÂùÄ\n\t\t\tsaveAddress() {\n\t\t\t\tconst address = this.addressInput.trim();\n\t\t\t\t\n\t\t\t\t// È™åËØÅÂú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫\n\t\t\t\tif (!address) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'ËØ∑ËæìÂÖ•Êî∂Ë¥ßÂú∞ÂùÄ',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// ÊûÑÂª∫Âú∞ÂùÄÂØπË±°\n\t\t\t\t\tconst addressObj = {\n\t\t\t\t\t\tfullAddress: address,\n\t\t\t\t\t\ttimestamp: Date.now() // Ê∑ªÂä†Êó∂Èó¥Êà≥\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// Ë∞ÉÁî® Vuex ÁöÑ updateAddress ÊñπÊ≥ï‰øùÂ≠òÂú∞ÂùÄ\n\t\t\t\t\tthis.updateAddress(addressObj);\n\t\t\t\t\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'Âú∞ÂùÄ‰øùÂ≠òÊàêÂäü',\n\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\tduration: 1500\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('Âú∞ÂùÄÂ∑≤‰øùÂ≠ò:', addressObj);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('‰øùÂ≠òÂú∞ÂùÄÂ§±Ë¥•:', error);\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '‰øùÂ≠òÂ§±Ë¥•,ËØ∑ÈáçËØï',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * ÂèëÈÄÅÊîØ‰ªò‰∏ìÂ±ûÊ∂àÊÅØ\n\t\t\t * @param {string} content - Ê∂àÊÅØÂÜÖÂÆπ\n\t\t\t */\n\t\t\tasync sendPaymentMessage(content) {\n\t\t\t\ttry {\n\t\t\t\t\tconst reqObj = {\n\t\t\t\t\t\topenid1: this.openid,\n\t\t\t\t\t\topenid2: this.userBase.openid !== this.goods_info.publisher_id \n\t\t\t\t\t\t\t\t? this.goods_info.publisher_id \n\t\t\t\t\t\t\t\t: this.goods_info.other_openid,\n\t\t\t\t\t\tgoods_id: this.goods_info.goods_id,\n\t\t\t\t\t\tsenderid: this.openid,\n\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\tis_payment: 1  // Ê†áËÆ∞‰∏∫ÊîØ‰ªòÊ∂àÊÅØ\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tconst { data: res } = await uni.$http.post('/chats/message', reqObj);\n\t\t\t\t\t\n\t\t\t\t\tif (res.meta.status === 200) {\n\t\t\t\t\t\tconsole.log('‚úÖ ÊîØ‰ªòÊ∂àÊÅØÂèëÈÄÅÊàêÂäü');\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('‚ùå ÂèëÈÄÅÊîØ‰ªòÊ∂àÊÅØÂ§±Ë¥•:', error);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\r\n\t\t\t// Â§ÑÁêÜÁ∫ø‰∏ã‰∫§ÊòìËØ∑Ê±Ç\r\n\t\t\tasync handleWechatPay() {\r\n\t\t\t    const finalAddress = this.addressInput.trim();\r\n\t\t\t    \r\n\t\t\t    try {\r\n\t\t\t        uni.showLoading({\r\n\t\t\t            title: 'ÂèëÈÄÅ‰∏≠...',\r\n\t\t\t            mask: true\r\n\t\t\t        });\r\n\t\t\t        \r\n\t\t\t        // ÊûÑÂª∫‰∫§ÊòìÊ∂àÊÅØÂÜÖÂÆπÔºà‰ΩøÁî®JSONÊ†ºÂºèÂ≠òÂÇ®Ôºâ\r\n\t\t\t        const transactionData = {\r\n\t\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t\t            goods_name: this.goods_info.goods_name,\r\n\t\t\t            goods_price: this.goods_info.goods_price,\r\n\t\t\t            location: finalAddress || null,\r\n\t\t\t            timestamp: Date.now()\r\n\t\t\t        };\r\n\t\t\t        \r\n\t\t\t        // ÂèëÈÄÅ‰∫§ÊòìÁ±ªÂûãÊ∂àÊÅØ\r\n\t\t\t        const reqObj = {\r\n\t\t\t            openid1: this.openid,\r\n\t\t\t            openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t                    ? this.goods_info.publisher_id \r\n\t\t\t                    : this.goods_info.other_openid,\r\n\t\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t\t            senderid: this.openid,\r\n\t\t\t            content: JSON.stringify(transactionData),  // Â∞ÜÊï∞ÊçÆÂ∫èÂàóÂåñ‰∏∫JSON\r\n\t\t\t            message_type: 'transaction',  // Êñ∞ÁöÑÊ∂àÊÅØÁ±ªÂûã\r\n\t\t\t            location: finalAddress || null  // È¢ùÂ§ñ‰øùÂ≠òÂú∞ÁÇπÂ≠óÊÆµ\r\n\t\t\t        };\r\n\t\t\t        \r\n\t\t\t        const { data: res } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t\t        \r\n\t\t\t        uni.hideLoading();\r\n\t\t\t        \r\n\t\t\t        if (res.meta.status === 200) {\r\n\t\t\t            // Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\r\n\t\t\t            const newMessages = this.processMessages(res.message.messages);\r\n\t\t\t            this.messages = newMessages;\r\n\t\t\t            \r\n\t\t\t            if (newMessages.length > 0) {\r\n\t\t\t                this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t                                    newMessages[newMessages.length - 1].created_at;\r\n\t\t\t            }\r\n\t\t\t            \r\n\t\t\t\t\t\t // üî• Êñ∞Â¢û: Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅ\r\n\t\t\t\t\t\t    this.transactionStatus = 1; // ‰π∞ÂÆ∂ÂèëËµ∑‰∫§Êòì,Á≠âÂæÖÂçñÂÆ∂Á°ÆËÆ§\r\n\t\t\t\t\t\t    this.isTransactionInitiator = true; // Ê†áËÆ∞‰∏∫‰∫§ÊòìÂèëËµ∑Êñπ\r\n\t\t\t\t\t\t\t\r\n\t\t\t            // ÂÖ≥Èó≠ÂºπÁ™ó\r\n\t\t\t            this.closePurchasePopup();\r\n\t\t\t            \r\n\t\t\t            // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫\r\n\t\t\t            uni.showToast({\r\n\t\t\t                title: '‰∫§ÊòìËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ',\r\n\t\t\t                icon: 'success',\r\n\t\t\t                duration: 2000\r\n\t\t\t            });\r\n\t\t\t            \r\n\t\t\t            // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ\r\n\t\t\t            this.$nextTick(() => {\r\n\t\t\t                this.scrollToBottom();\r\n\t\t\t            });\r\n\t\t\t        } else {\r\n\t\t\t            uni.showToast({\r\n\t\t\t                title: res.meta.msg || 'ÂèëÈÄÅÂ§±Ë¥•',\r\n\t\t\t                icon: 'none',\r\n\t\t\t                duration: 2000\r\n\t\t\t            });\r\n\t\t\t        }\r\n\t\t\t    } catch (error) {\r\n\t\t\t        uni.hideLoading();\r\n\t\t\t        console.error('‚ùå ÂèëÈÄÅ‰∫§ÊòìËØ∑Ê±ÇÂ§±Ë¥•:', error);\r\n\t\t\t        uni.showToast({\r\n\t\t\t            title: 'ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',\r\n\t\t\t            icon: 'none',\r\n\t\t\t            duration: 2000\r\n\t\t\t        });\r\n\t\t\t    }\r\n\t\t\t},\r\n\n\t\t\t// // Â§ÑÁêÜÂæÆ‰ø°ÊîØ‰ªò\n\t\t\t// async handleWechatPay() {\n\t\t\t// \t// Âú∞ÂùÄÂèò‰∏∫ÈÄâÂ°´,ÊâÄ‰ª•ÂéªÊéâÂº∫Âà∂È™åËØÅ\n\t\t\t// \tconst finalAddress = this.addressInput.trim();\n\t\t\t\t\n\t\t\t// \ttry {\n\t\t\t// \t\tuni.showLoading({\n\t\t\t// \t\t\ttitle: 'ÂàõÂª∫ËÆ¢Âçï‰∏≠...',\n\t\t\t// \t\t\tmask: true\n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\t// 1. ÂàõÂª∫ËÆ¢Âçï\n\t\t\t// \t\tconst orderInfo = {\n\t\t\t// \t\t\t//order_price: this.goods_info.goods_price,  // ‰ΩøÁî®ÂÆûÈôÖ‰ª∑Ê†º\n\t\t\t// \t\t\torder_price: 0.1,\n\t\t\t// \t\t\tconsignee_addr: finalAddress || null,  // ÂÖÅËÆ∏‰∏∫Á©∫\n\t\t\t// \t\t\tgoods: this.goods_info,\n\t\t\t// \t\t\topenid: this.openid\n\t\t\t// \t\t};\n\t\t\t\t\t\n\t\t\t// \t\tconst { data: res } = await uni.$http.post('/orders/create', orderInfo);\n\t\t\t\t\t\n\t\t\t// \t\tif (res.meta.status !== 200) {\n\t\t\t// \t\t\tuni.hideLoading();\n\t\t\t// \t\t\treturn uni.$showMsg('ÂàõÂª∫ËÆ¢ÂçïÂ§±Ë¥•ÔºÅ');\n\t\t\t// \t\t}\n\t\t\t\t\t\n\t\t\t// \t\tconst orderNumber = res.message.order_number;\n\t\t\t// \t\tconsole.log('üìù ËÆ¢ÂçïÂàõÂª∫ÊàêÂäü:', orderNumber);\n\t\t\t\t\t\n\t\t\t// \t\tuni.showLoading({\n\t\t\t// \t\t\ttitle: 'ÂáÜÂ§áÊîØ‰ªò...',\n\t\t\t// \t\t\tmask: true\n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\t// 2. ËÆ¢ÂçïÈ¢ÑÊîØ‰ªò\n\t\t\t// \t\tconst { data: res2 } = await uni.$http.post('/orders/req_unifiedorder', { \n\t\t\t// \t\t\torder_number: orderNumber \n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\tif (res2.meta.status !== 200) {\n\t\t\t// \t\t\tuni.hideLoading();\n\t\t\t// \t\t\treturn uni.$showMsg('È¢Ñ‰ªòËÆ¢ÂçïÁîüÊàêÂ§±Ë¥•ÔºÅ');\n\t\t\t// \t\t}\n\t\t\t\t\t\n\t\t\t// \t\tconst payInfo = res2.message.pay;\n\t\t\t// \t\tconsole.log('üí≥ È¢ÑÊîØ‰ªò‰ø°ÊÅØËé∑ÂèñÊàêÂäü');\n\t\t\t\t\t\n\t\t\t// \t\tuni.hideLoading();\n\t\t\t\t\t\n\t\t\t// \t\t// 3. ÂèëËµ∑ÂæÆ‰ø°ÊîØ‰ªò\n\t\t\t// \t\tconst [err, succ] = await uni.requestPayment(payInfo);\n\t\t\t\t\t\n\t\t\t// \t\tif (err) {\n\t\t\t// \t\t\tconsole.log('‚ùå Áî®Êà∑ÂèñÊ∂àÊîØ‰ªò');\n\t\t\t// \t\t\treturn uni.$showMsg('ËÆ¢ÂçïÊú™ÊîØ‰ªòÔºÅ');\n\t\t\t// \t\t}\n\t\t\t\t\t\n\t\t\t// \t\tconsole.log('‚úÖ ÊîØ‰ªòÊàêÂäü,È™åËØÅËÆ¢ÂçïÁä∂ÊÄÅ...');\n\t\t\t\t\t\n\t\t\t// \t\tuni.showLoading({\n\t\t\t// \t\t\ttitle: 'È™åËØÅÊîØ‰ªòÁä∂ÊÄÅ...',\n\t\t\t// \t\t\tmask: true\n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\t// 4. È™åËØÅËÆ¢ÂçïÊîØ‰ªòÁä∂ÊÄÅ\n\t\t\t// \t\tconst { data: res3 } = await uni.$http.post('/orders/chkOrder', { \n\t\t\t// \t\t\torder_number: orderNumber \n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\tuni.hideLoading();\n\t\t\t\t\t\n\t\t\t// \t\tif (res3.meta.status !== 200) {\n\t\t\t// \t\t\treturn uni.$showMsg('ËÆ¢ÂçïÊú™ÊîØ‰ªòÔºÅ');\n\t\t\t// \t\t}\n\t\t\t\t\t\n\t\t\t// \t\t// 5. ÊîØ‰ªòÊàêÂäüÂêéÂèëÈÄÅ‰∏ìÂ±ûÊ∂àÊÅØ\n\t\t\t// \t\tlet paymentMessage = '';\n\t\t\t// \t\tif (finalAddress) {\n\t\t\t// \t\t\tpaymentMessage = `ÊàëÂ∑≤‰ªòÊ¨æ,ÈÄâÊã©ÁöÑ‰∫§ÊòìÂú∞ÁÇπ‰∏∫: ${finalAddress}`;\n\t\t\t// \t\t} else {\n\t\t\t// \t\t\tpaymentMessage = 'ÊàëÂ∑≤‰ªòÊ¨æ,ËØ∑Êàë‰ª¨ÂçèÂïÜ‰∫§ÊòìÂú∞ÁÇπ';\n\t\t\t// \t\t}\n\t\t\t\t\t\n\t\t\t// \t\t// ÂèëÈÄÅÊîØ‰ªòÊ∂àÊÅØ\n\t\t\t// \t\tawait this.sendPaymentMessage(paymentMessage);\n\t\t\t\t\t\n\t\t\t// \t\t// 6. Êõ¥Êñ∞ÂΩìÂâçËÆ¢ÂçïÁä∂ÊÄÅ\n\t\t\t// \t\tthis.currentOrder = {\n\t\t\t// \t\t\torder_number: orderNumber,\n\t\t\t// \t\t\tpay_status: 1,\n\t\t\t// \t\t\torder_status: 1,  // ÂæÖÂèëË¥ß\n\t\t\t// \t\t\tconsignee_addr: finalAddress\n\t\t\t// \t\t};\n\t\t\t\t\t\n\t\t\t// \t\t// 7. Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\n\t\t\t// \t\tawait this.loadMessages();\n\t\t\t\t\t\n\t\t\t// \t\t// 8. ÂÖ≥Èó≠ÂºπÁ™ó\n\t\t\t// \t\tthis.closePurchasePopup();\n\t\t\t\t\t\n\t\t\t// \t\t// 9. ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫\n\t\t\t// \t\tuni.showToast({\n\t\t\t// \t\t\ttitle: 'ÊîØ‰ªòÊàêÂäü!',\n\t\t\t// \t\t\ticon: 'success',\n\t\t\t// \t\t\tduration: 2000\n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t\t// 10. ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ\n\t\t\t// \t\tthis.$nextTick(() => {\n\t\t\t// \t\t\tthis.scrollToBottom();\n\t\t\t// \t\t});\n\t\t\t\t\t\n\t\t\t// \t} catch (error) {\n\t\t\t// \t\tuni.hideLoading();\n\t\t\t// \t\tconsole.error('‚ùå ËÆ¢ÂçïÊîØ‰ªòÂ§±Ë¥•:', error);\n\t\t\t// \t\tuni.showToast({\n\t\t\t// \t\t\ttitle: 'ËÆ¢ÂçïÊîØ‰ªòÂ§±Ë¥•',\n\t\t\t// \t\t\ticon: 'none',\n\t\t\t// \t\t\tduration: 2000\n\t\t\t// \t\t});\n\t\t\t// \t}\n\t\t\t// },\n\t\t\t\n\t\t\t// ÂèëÈÄÅÊ∂àÊÅØ\n\t\t\tasync sendMessage() {\n\t\t\t\tif (!this.inputText.trim()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newMessage = this.inputText;\n\t\t\t\tthis.inputText = '';\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// ÂèëÈÄÅÊ∂àÊÅØÂà∞ÂêéÁ´Ø\n\t\t\t\t\tconst requyObj = {\n\t\t\t\t\t\topenid1: this.openid,\n\t\t\t\t\t\topenid2: this.userBase.openid !== this.goods_info.publisher_id \n\t\t\t\t\t\t\t\t? this.goods_info.publisher_id \n\t\t\t\t\t\t\t\t: this.goods_info.other_openid,\n\t\t\t\t\t\tgoods_id: this.goods_info.goods_id,\n\t\t\t\t\t\tsenderid: this.openid,\n\t\t\t\t\t\tcontent: newMessage,\r\n\t\t\t\t\t\tmessage_type: 'text',\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tconst { data: res } = await uni.$http.post('/chats/message', requyObj)\n\t\t\t\t\t\n\t\t\t\t\tif (res.meta.status === 200) {\n\t\t\t\t\t\t// ÂèëÈÄÅÊàêÂäüÂêéÁ´ãÂç≥Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\n\t\t\t\t\t\tconst newMessages = this.processMessages(res.message.messages);\n\t\t\t\t\t\tthis.messages = newMessages;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Êõ¥Êñ∞ÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØID\n\t\t\t\t\t\tif (newMessages.length > 0) {\n\t\t\t\t\t\t\tthis.lastMessageId = newMessages[newMessages.length - 1].id || \n\t\t\t\t\t\t\t\t\t\t\t\tnewMessages[newMessages.length - 1].created_at;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// ÊªöÂä®Âà∞Â∫ïÈÉ®\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:', error);\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'ÂèëÈÄÅÂ§±Ë¥•',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tshowEmojiPicker() {\r\n\t\t\t        this.showEmojiPanel = !this.showEmojiPanel;\r\n\t\t\t    },\n\t\t\t\n\t\t\t   /**\r\n\t\t\t     * ÊòæÁ§∫Ê∑ªÂä†ËèúÂçï - ‰øÆÊîπÂéüÊñπÊ≥ï\r\n\t\t\t     */\r\n\t\t\t    showAddMenu() {\r\n\t\t\t        uni.showActionSheet({\r\n\t\t\t            itemList: ['‰ªéÁõ∏ÂÜåÈÄâÊã©', 'ÊãçÁÖß'],\r\n\t\t\t            success: (res) => {\r\n\t\t\t                if (res.tapIndex === 0) {\r\n\t\t\t                    this.chooseImageFromAlbum();\r\n\t\t\t                } else if (res.tapIndex === 1) {\r\n\t\t\t                    this.chooseImageFromCamera();\r\n\t\t\t                }\r\n\t\t\t            }\r\n\t\t\t        });\r\n\t\t\t    },\r\n\t\t\t\t /**\r\n\t\t\t\t     * ‰ªéÁõ∏ÂÜåÈÄâÊã©ÂõæÁâá\r\n\t\t\t\t     */\r\n\t\t\t\t    chooseImageFromAlbum() {\r\n\t\t\t\t        uni.chooseImage({\r\n\t\t\t\t            count: 1,\r\n\t\t\t\t            sizeType: ['compressed'],\r\n\t\t\t\t            sourceType: ['album'],\r\n\t\t\t\t            success: (res) => {\r\n\t\t\t\t                this.uploadAndSendImage(res.tempFilePaths);\r\n\t\t\t\t            }\r\n\t\t\t\t        });\r\n\t\t\t\t    },\r\n\t\t\t\t\t\r\n\t\t\t\t\t /**\r\n\t\t\t\t\t     * ÊãçÁÖß\r\n\t\t\t\t\t     */\r\n\t\t\t\t\t    chooseImageFromCamera() {\r\n\t\t\t\t\t        uni.chooseImage({\r\n\t\t\t\t\t            count: 1,\r\n\t\t\t\t\t            sizeType: ['compressed'],\r\n\t\t\t\t\t            sourceType: ['camera'],\r\n\t\t\t\t\t            success: (res) => {\r\n\t\t\t\t\t                this.uploadAndSendImage(res.tempFilePaths);\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        });\r\n\t\t\t\t\t    },\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t     * ‰∏ä‰º†Âπ∂ÂèëÈÄÅÂõæÁâá\r\n\t\t\t\t\t\t     */\r\n\t\t\t\t\t\t    async uploadAndSendImage(filePaths) {\r\n\t\t\t\t\t\t        if (!filePaths || filePaths.length === 0) {\r\n\t\t\t\t\t\t            return;\r\n\t\t\t\t\t\t        }\r\n\t\t\t\t\t\t        \r\n\t\t\t\t\t\t        this.uploading = true;\r\n\t\t\t\t\t\t        uni.showLoading({\r\n\t\t\t\t\t\t            title: '‰∏ä‰º†‰∏≠...',\r\n\t\t\t\t\t\t            mask: true\r\n\t\t\t\t\t\t        });\r\n\t\t\t\t\t\t        \r\n\t\t\t\t\t\t        try {\r\n\t\t\t\t\t\t            const filePath = filePaths[0];\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            // 1. Ëé∑Âèñ‰∏ä‰º†Âá≠ËØÅ\r\n\t\t\t\t\t\t            const { data: tokenRes } = await uni.$http.get('/upload/token', {\r\n\t\t\t\t\t\t                openid: this.openid,\r\n\t\t\t\t\t\t                fileType: 'image'\r\n\t\t\t\t\t\t            });\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            if (tokenRes.meta.status !== 200) {\r\n\t\t\t\t\t\t                throw new Error('Ëé∑Âèñ‰∏ä‰º†Âá≠ËØÅÂ§±Ë¥•');\r\n\t\t\t\t\t\t            }\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            // 2. ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ\r\n\t\t\t\t\t\t            const fileContent = await new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t                uni.getFileSystemManager().readFile({\r\n\t\t\t\t\t\t                    filePath: filePath,\r\n\t\t\t\t\t\t                    encoding: 'base64',\r\n\t\t\t\t\t\t                    success: (res) => resolve(res.data),\r\n\t\t\t\t\t\t                    fail: reject\r\n\t\t\t\t\t\t                });\r\n\t\t\t\t\t\t            });\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            // 3. ‰∏ä‰º†Âà∞OSS\r\n\t\t\t\t\t\t            await new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t                uni.request({\r\n\t\t\t\t\t\t                    url: tokenRes.message.publicUrl,\r\n\t\t\t\t\t\t                    method: 'PUT',\r\n\t\t\t\t\t\t                    header: {\r\n\t\t\t\t\t\t                        'Content-Type': 'application/octet-stream'\r\n\t\t\t\t\t\t                    },\r\n\t\t\t\t\t\t                    data: uni.base64ToArrayBuffer(fileContent),\r\n\t\t\t\t\t\t                    success: (res) => {\r\n\t\t\t\t\t\t                        if (res.statusCode === 200) {\r\n\t\t\t\t\t\t                            resolve(res);\r\n\t\t\t\t\t\t                        } else {\r\n\t\t\t\t\t\t                            reject(new Error(`‰∏ä‰º†Â§±Ë¥•: ${res.statusCode}`));\r\n\t\t\t\t\t\t                        }\r\n\t\t\t\t\t\t                    },\r\n\t\t\t\t\t\t                    fail: reject\r\n\t\t\t\t\t\t                });\r\n\t\t\t\t\t\t            });\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            const imageUrl = tokenRes.message.publicUrl;\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            uni.hideLoading();\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            // 4. ÂèëÈÄÅÂõæÁâáÊ∂àÊÅØ\r\n\t\t\t\t\t\t            const reqObj = {\r\n\t\t\t\t\t\t                openid1: this.openid,\r\n\t\t\t\t\t\t                openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t\t\t\t\t                        ? this.goods_info.publisher_id \r\n\t\t\t\t\t\t                        : this.goods_info.other_openid,\r\n\t\t\t\t\t\t                goods_id: this.goods_info.goods_id,\r\n\t\t\t\t\t\t                senderid: this.openid,\r\n\t\t\t\t\t\t                content: imageUrl,\r\n\t\t\t\t\t\t                message_type: 'image',  // Ê†áËÆ∞‰∏∫ÂõæÁâáÊ∂àÊÅØ\r\n\t\t\t\t\t\t                sub_type: 'image'       // Ê†áËÆ∞‰∏∫ÊôÆÈÄöÂõæÁâá\r\n\t\t\t\t\t\t            };\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            const { data: res } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t            if (res.meta.status === 200) {\r\n\t\t\t\t\t\t                const newMessages = this.processMessages(res.message.messages);\r\n\t\t\t\t\t\t                this.messages = newMessages;\r\n\t\t\t\t\t\t                \r\n\t\t\t\t\t\t                if (newMessages.length > 0) {\r\n\t\t\t\t\t\t                    this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t\t\t\t\t                                        newMessages[newMessages.length - 1].created_at;\r\n\t\t\t\t\t\t                }\r\n\t\t\t\t\t\t                \r\n\t\t\t\t\t\t                this.$nextTick(() => {\r\n\t\t\t\t\t\t                    this.scrollToBottom();\r\n\t\t\t\t\t\t                });\r\n\t\t\t\t\t\t            }\r\n\t\t\t\t\t\t            \r\n\t\t\t\t\t\t        } catch (error) {\r\n\t\t\t\t\t\t            console.error('‚ùå ‰∏ä‰º†ÂõæÁâáÂ§±Ë¥•:', error);\r\n\t\t\t\t\t\t            uni.hideLoading();\r\n\t\t\t\t\t\t            uni.showToast({\r\n\t\t\t\t\t\t                title: error.message || '‰∏ä‰º†Â§±Ë¥•',\r\n\t\t\t\t\t\t                icon: 'none',\r\n\t\t\t\t\t\t                duration: 2000\r\n\t\t\t\t\t\t            });\r\n\t\t\t\t\t\t        } finally {\r\n\t\t\t\t\t\t            this.uploading = false;\r\n\t\t\t\t\t\t        }\r\n\t\t\t\t\t\t    },\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t     * È¢ÑËßàÂõæÁâá\r\n\t\t\t\t\t\t\t     */\r\n\t\t\t\t\t\t\t    previewImage(imageUrl) {\r\n\t\t\t\t\t\t\t        // Êî∂ÈõÜÊâÄÊúâÂõæÁâáÊ∂àÊÅØÁöÑURL\r\n\t\t\t\t\t\t\t        const imageUrls = this.messages\r\n\t\t\t\t\t\t\t            .filter(msg => msg.message_type === 'image')\r\n\t\t\t\t\t\t\t            .map(msg => msg.content);\r\n\t\t\t\t\t\t\t        \r\n\t\t\t\t\t\t\t        uni.previewImage({\r\n\t\t\t\t\t\t\t            current: imageUrl,\r\n\t\t\t\t\t\t\t            urls: imageUrls\r\n\t\t\t\t\t\t\t        });\r\n\t\t\t\t\t\t\t    },\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\n\t\t\t\n\t\t\t// ÊªöÂä®Âà∞Â∫ïÈÉ®\n\t\t\tscrollToBottom() {\n\t\t\t\tif (this.messages.length > 0) {\n\t\t\t\t\tthis.scrollIntoView = 'msg-' + (this.messages.length - 1);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// Ê†ºÂºèÂåñÊó∂Èó¥\n\t\t\tformatTime(date) {\n\t\t\t\tconst month = String(date.getMonth() + 1).padStart(2, '0');\n\t\t\t\tconst day = String(date.getDate()).padStart(2, '0');\n\t\t\t\tconst hour = String(date.getHours()).padStart(2, '0');\n\t\t\t\tconst minute = String(date.getMinutes()).padStart(2, '0');\n\t\t\t\treturn `${month}-${day} ${hour}:${minute}`;\n\t\t\t},\n\t\t\t\n\t\t\t/**\r\n\t\t\t         * üî• ‰øÆÊîπÔºöÂ§ÑÁêÜÊ∂àÊÅØÊó∂ËØÜÂà´Á≥ªÁªüÊ∂àÊÅØ\r\n\t\t\t         */\r\n\t\t\t        processMessages(messages) {\r\n\t\t\t            if (!Array.isArray(messages)) {\r\n\t\t\t                console.log(\"messages‰∏çÊòØÊï∞ÁªÑ\");\r\n\t\t\t                return [];\r\n\t\t\t            }\r\n\t\t\t            \r\n\t\t\t            // Ê£ÄÊü•ÊòØÂê¶ÊúâÁ≥ªÁªüÂÖ≥Èó≠Ê∂àÊÅØ\r\n\t\t\t            const hasSystemCloseMsg = messages.some(msg => \r\n\t\t\t                msg.message_type === 'system' && \r\n\t\t\t                msg.content && \r\n\t\t\t                msg.content.includes('‰∫§ÊòìËá™Âä®ÂÖ≥Èó≠')\r\n\t\t\t            );\r\n\t\t\t            \r\n\t\t\t            // üî• Â¶ÇÊûúÊúâÁ≥ªÁªüÂÖ≥Èó≠Ê∂àÊÅØÔºåÈáçÁΩÆ‰∫§ÊòìÁä∂ÊÄÅ\r\n\t\t\t            if (hasSystemCloseMsg) {\r\n\t\t\t                this.transactionStatus = 0;\r\n\t\t\t                this.isTransactionInitiator = false;\r\n\t\t\t            } else {\r\n\t\t\t                // ÂéüÊúâÁöÑÁä∂ÊÄÅÊ£ÄÊü•ÈÄªËæë\r\n\t\t\t                const hasTransactionMessage = messages.some(msg => msg.message_type === 'transaction');\r\n\t\t\t                const hasAgreeMessage = messages.some(msg => msg.message_type === 'agree');\r\n\t\t\t                const hasFinishMessage = messages.some(msg => msg.message_type === 'finish');\r\n\t\t\t                \r\n\t\t\t                if (hasFinishMessage) {\r\n\t\t\t                    this.transactionStatus = 3;\r\n\t\t\t                } else if (hasAgreeMessage) {\r\n\t\t\t                    this.transactionStatus = 2;\r\n\t\t\t                } else if (hasTransactionMessage) {\r\n\t\t\t                    const latestTransaction = [...messages]\r\n\t\t\t                        .reverse()\r\n\t\t\t                        .find(msg => msg.message_type === 'transaction');\r\n\t\t\t                    \r\n\t\t\t                    if (latestTransaction) {\r\n\t\t\t                        if (latestTransaction.openid === this.openid) {\r\n\t\t\t                            this.transactionStatus = 1;\r\n\t\t\t                            this.isTransactionInitiator = true;\r\n\t\t\t                        } else {\r\n\t\t\t                            this.transactionStatus = 1;\r\n\t\t\t                            this.isTransactionInitiator = false;\r\n\t\t\t                        }\r\n\t\t\t                    }\r\n\t\t\t                }\r\n\t\t\t            }\r\n\t\t\t            \r\n\t\t\t            return messages.map(message => {\r\n\t\t\t                const processed = {\r\n\t\t\t                    ...message,\r\n\t\t\t                    type: message.openid === this.openid ? 'sent' : \r\n\t\t\t                          message.message_type === 'system' ? 'system' : 'received', // üî• Á≥ªÁªüÊ∂àÊÅØÊ†áËÆ∞\r\n\t\t\t                    is_payment: message.is_payment || 0,\r\n\t\t\t                    message_type: message.message_type || 'text',\r\n\t\t\t                    sub_type: message.sub_type || null\r\n\t\t\t                };\r\n\t\t\t                \r\n\t\t\t                // ‰∫§ÊòìÊ∂àÊÅØÂ§ÑÁêÜ\r\n\t\t\t                if (message.message_type === 'transaction') {\r\n\t\t\t                    try {\r\n\t\t\t                        const transactionData = JSON.parse(message.content);\r\n\t\t\t                        processed.location = transactionData.location || message.location;\r\n\t\t\t                        processed.transactionData = transactionData;\r\n\t\t\t                    } catch (e) {\r\n\t\t\t                        console.error('Ëß£Êûê‰∫§ÊòìÊ∂àÊÅØÂ§±Ë¥•:', e);\r\n\t\t\t                        processed.location = message.location;\r\n\t\t\t                    }\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                // ÂêåÊÑèÊ∂àÊÅØÂ§ÑÁêÜ\r\n\t\t\t                if (message.message_type === 'agree') {\r\n\t\t\t                    try {\r\n\t\t\t                        const agreeData = JSON.parse(message.content);\r\n\t\t\t                        processed.agreeData = agreeData;\r\n\t\t\t                    } catch (e) {\r\n\t\t\t                        console.error('Ëß£ÊûêÂêåÊÑèÊ∂àÊÅØÂ§±Ë¥•:', e);\r\n\t\t\t                    }\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                // ÂÆåÊàêÊ∂àÊÅØÂ§ÑÁêÜ\r\n\t\t\t                if (message.message_type === 'finish') {\r\n\t\t\t                    try {\r\n\t\t\t                        const finishData = JSON.parse(message.content);\r\n\t\t\t                        processed.finishData = finishData;\r\n\t\t\t                    } catch (e) {\r\n\t\t\t                        console.error('Ëß£ÊûêÂÆåÊàêÊ∂àÊÅØÂ§±Ë¥•:', e);\r\n\t\t\t                    }\r\n\t\t\t                }\r\n\t\t\t                \r\n\t\t\t                return processed;\r\n\t\t\t            });\r\n\t\t\t        },\r\n\t\t\t\r\n\t\t// Âú® methods ‰∏≠‰øÆÊîπ agreeTransaction ÊñπÊ≥ï\r\n\t\tasync agreeTransaction() {\r\n\t\t    try {\r\n\t\t        uni.showLoading({\r\n\t\t            title: 'Á°ÆËÆ§‰∏≠...',\r\n\t\t            mask: true\r\n\t\t        });\r\n\t\t        \r\n\t\t        // üî• ÊûÑÂª∫ÂêåÊÑè‰∫§ÊòìÊ∂àÊÅØÂÜÖÂÆπ\r\n\t\t        const agreeData = {\r\n\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t            goods_name: this.goods_info.goods_name,\r\n\t\t            goods_price: this.goods_info.goods_price,\r\n\t\t            timestamp: Date.now()\r\n\t\t        };\r\n\t\t        \r\n\t\t        // üî• ÂèëÈÄÅ\"ÂêåÊÑè‰∫§Êòì\"Á±ªÂûãÁöÑÊ∂àÊÅØ\r\n\t\t        const reqObj = {\r\n\t\t            openid1: this.openid,\r\n\t\t            openid2: this.userBase.openid !== this.goods_info.publisher_id \r\n\t\t                    ? this.goods_info.publisher_id \r\n\t\t                    : this.goods_info.other_openid,\r\n\t\t            goods_id: this.goods_info.goods_id,\r\n\t\t            senderid: this.openid,\r\n\t\t            content: JSON.stringify(agreeData),\r\n\t\t            message_type: 'agree',  // üî• Êñ∞Â¢û: ÂêåÊÑè‰∫§ÊòìÊ∂àÊÅØÁ±ªÂûã\r\n\t\t        };\r\n\t\t        \r\n\t\t        const { data: res } = await uni.$http.post('/chats/message', reqObj);\r\n\t\t        \r\n\t\t        uni.hideLoading();\r\n\t\t        \r\n\t\t        if (res.meta.status === 200) {\r\n\t\t            // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫‰∫§ÊòìËøõË°å‰∏≠\r\n\t\t            this.transactionStatus = 2;\r\n\t\t            \r\n\t\t            // Âà∑Êñ∞Ê∂àÊÅØÂàóË°®\r\n\t\t            const newMessages = this.processMessages(res.message.messages);\r\n\t\t            this.messages = newMessages;\r\n\t\t            \r\n\t\t            if (newMessages.length > 0) {\r\n\t\t                this.lastMessageId = newMessages[newMessages.length - 1].id || \r\n\t\t                                    newMessages[newMessages.length - 1].created_at;\r\n\t\t            }\r\n\t\t            \r\n\t\t            uni.showToast({\r\n\t\t                title: 'Â∑≤ÂêåÊÑè‰∫§Êòì',\r\n\t\t                icon: 'success'\r\n\t\t            });\r\n\t\t            \r\n\t\t            // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ\r\n\t\t            this.$nextTick(() => {\r\n\t\t                this.scrollToBottom();\r\n\t\t            });\r\n\t\t        } else {\r\n\t\t            uni.showToast({\r\n\t\t                title: res.meta.msg || 'Êìç‰ΩúÂ§±Ë¥•',\r\n\t\t                icon: 'none'\r\n\t\t            });\r\n\t\t        }\r\n\t\t    } catch (error) {\r\n\t\t        uni.hideLoading();\r\n\t\t        console.error('ÂêåÊÑè‰∫§ÊòìÂ§±Ë¥•:', error);\r\n\t\t        uni.showToast({\r\n\t\t            title: 'Êìç‰ΩúÂ§±Ë¥•',\r\n\t\t            icon: 'none'\r\n\t\t        });\r\n\t\t    }\r\n\t\t},\r\n\t\t\t\n\t\t\t\n\t\t\t// Ë∑≥ËΩ¨Âà∞ÂïÜÂìÅËØ¶ÊÉÖ\n\t\t\tasync gotoDetail(item) {\n\t\t\t\ttry {\n\t\t\t\t\t// 1. ÂÖàÂ¢ûÂä†ÊµèËßàÊ¨°Êï∞\n\t\t\t\t\tconsole.log('üìä Â¢ûÂä†ÂïÜÂìÅÊµèËßàÊ¨°Êï∞:', item.goods_id);\n\t\t\t\t\tconst { data: res } = await uni.$http.post('/goods/view', {\n\t\t\t\t\t\tgoods_id: item.goods_id,\n\t\t\t\t\t\t// ÂèØÈÄâÔºöÊ∑ªÂä†Áî®Êà∑‰ø°ÊÅØÁî®‰∫éÁªüËÆ°ÂàÜÊûê\n\t\t\t\t\t\tuser_openid: this.openid || null\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\tif (res.meta.status === 200) {\n\t\t\t\t\t\tconsole.log('‚úÖ ÊµèËßàÊ¨°Êï∞Â¢ûÂä†ÊàêÂäü');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn('‚ö†Ô∏è ÊµèËßàÊ¨°Êï∞Â¢ûÂä†Â§±Ë¥•:', res.meta.msg);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('‚ùå ÊµèËßàÊ¨°Êï∞Â¢ûÂä†Êé•Âè£ÈîôËØØ:', error);\n\t\t\t\t\t// Âç≥‰ΩøÊé•Âè£Â§±Ë¥•‰πüÁªßÁª≠Ë∑≥ËΩ¨Ôºå‰∏çÂΩ±ÂìçÁî®Êà∑‰ΩìÈ™å\n\t\t\t\t}\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: '/subpkg/goods_detail/goods_detail?goods_id=' + item.goods_id\n\t\t\t\t})\n\t\t\t},\n\t\t},\n\t\tcomputed: {\n\t\t\t...mapState('m_user', ['token', 'code', 'userBase', 'openid', 'address']),\n\t\t\t // üî• Êñ∞Â¢ûÔºöÂ§ÑÁêÜÂïÜÂìÅÂêçÁß∞Êà™Êñ≠\r\n\t\t\t    displayGoodsName() {\r\n\t\t\t        if (!this.goods_info || !this.goods_info.goods_name) {\r\n\t\t\t            return '';\r\n\t\t\t        }\r\n\t\t\t        const name = this.goods_info.goods_name;\r\n\t\t\t        return name.length > 15 ? name.substring(0, 13) + '...' : name;\r\n\t\t\t    },\r\n\t\t\t\t\n\t\t\t// ÊòæÁ§∫Â∑≤‰øùÂ≠òÁöÑÂú∞ÂùÄÊñáÊú¨\n\t\t\tsavedAddressText() {\n\t\t\t\tif (this.address && this.address.fullAddress) {\n\t\t\t\t\treturn this.address.fullAddress;\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n/* ÂéüÊúâÊ†∑Âºè‰øùÊåÅ‰∏çÂèò */\n.chat-container {\n\tposition: relative;\n\theight: 100vh;\n\tbackground-color: #f5f5f5;\n}\n\n.header {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tz-index: 100;\n\tdisplay: flex;\n\talign-items: center;\n\theight: 88rpx;\n\tpadding: 0 24rpx;\n\tbackground-color: #ffffff;\n\tborder-bottom: 1rpx solid #e5e5e5;\n\t\n\t.back-btn {\n\t\tfont-size: 36rpx;\n\t\tcolor: #333333;\n\t}\n\t\n\t.seller-info {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tmargin-left: 20rpx;\n\t\t\n\t\t.seller-name {\n\t\t\tfont-size: 32rpx;\n\t\t\tfont-weight: 500;\n\t\t\tcolor: #333333;\n\t\t\tmargin-right: 16rpx;\n\t\t}\n\t\t\n\t\t.member-badge {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #999999;\n\t\t}\n\t}\n\t\n\t.more-btn {\n\t\tfont-size: 36rpx;\n\t\tcolor: #333333;\n\t\t.more_icons {\n\t\t\twidth: 50rpx;\n\t\t\theight: 50rpx;\n\t\t}\n\t}\n}\n\n.goods-bar {\n\tposition: fixed;\n\ttop: 88rpx;\n\tleft: 0;\n\tright: 0;\n\tz-index: 99;\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 20rpx 24rpx;\n\tbackground-color: #ffffff;\n\tborder-bottom: 1rpx solid #e5e5e5;\n\t\n\t.goods-image {\n\t\twidth: 120rpx;\n\t\theight: 120rpx;\n\t\tborder-radius: 8rpx;\n\t}\n\t\n\t.goods-info {\n\t\tflex: 1;\n\t\tmargin-left: 20rpx;\n\t\t\n\t\t.goods-name {\n\t\t\tdisplay: block;\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #333333;\n\t\t\tmargin-bottom: 8rpx;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\twhite-space: nowrap;\n\t\t}\n\t\t\n\t\t.goods-price {\n\t\t\tfont-size: 32rpx;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #ff4444;\n\t\t}\n\t}\n\t\n\t.buy-btn,\n\t.waiting-btn,\n\t.agree-btn,\n\t.in-progress-btn,\n\t.completed-btn,\n\t.no-transaction-btn {\n\t\tpadding: 16rpx 32rpx;\n\t\tborder-radius: 40rpx;\n\t\tfont-size: 28rpx;\n\t\tfont-weight: 500;\n\t\twhite-space: nowrap;\n\t}\n\t\n\t.buy-btn {\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\tcolor: #ffffff;\n\t}\n\t\n\t.waiting-btn {\n\t\tbackground: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);\n\t\tcolor: #ffffff;\n\t\topacity: 0.8;\n\t}\n\t\n\t.agree-btn {\n\t\tbackground: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);\n\t\tcolor: #ffffff;\n\t\tanimation: pulse 2s infinite;\n\t}\n\t\n\t.in-progress-btn {\n\t\tbackground: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);\n\t\tcolor: #ffffff;\n\t\topacity: 0.8;\n\t}\n\t\n\t.completed-btn {\n\t\tbackground-color: #e5e5e5;\n\t\tcolor: #999999;\n\t}\n\t\n\t.no-transaction-btn {\n\t\tbackground-color: #f5f5f5;\n\t\tcolor: #999999;\n\t\tborder: 1rpx solid #e5e5e5;\n\t}\n}\n\n@keyframes pulse {\n\t0%, 100% {\n\t\ttransform: scale(1);\n\t\tbox-shadow: 0 4rpx 12rpx rgba(102, 187, 106, 0.3);\n\t}\n\t50% {\n\t\ttransform: scale(1.05);\n\t\tbox-shadow: 0 6rpx 16rpx rgba(102, 187, 106, 0.5);\n\t}\n}\n\n.chat-content {\n\tposition: fixed;\n\ttop: 228rpx;\n\tbottom: 100rpx;\n\tleft: 0;\n\tright: 0;\n\tpadding: 20rpx 24rpx;\n\t\n\t.message-item {\n\t\tmargin-bottom: 32rpx;\n\t\t\n\t\t.message-time {\n\t\t\ttext-align: center;\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #999999;\n\t\t\tmargin-bottom: 20rpx;\n\t\t}\n\t\t\n\t\t.system-message {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\tmargin: 24rpx 0;\n\t\t\t\n\t\t\t.system-text {\n\t\t\t\tpadding: 12rpx 24rpx;\n\t\t\t\tbackground-color: #e0e0e0;\n\t\t\t\tcolor: #666666;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tborder-radius: 16rpx;\n\t\t\t\tmax-width: 500rpx;\n\t\t\t\ttext-align: center;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n\t\t\t}\n\t\t}\n\t\t\n\t\t.message-wrapper {\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-end;\n\t\t\t\n\t\t\t&.left {\n\t\t\t\tjustify-content: flex-start;\n\t\t\t\t\n\t\t\t\t/* üî• ÂÖ≥ÈîÆ‰øÆÊîπÔºöÂ∑¶‰æßÊ∂àÊÅØÂÜÖÂÆπÁªü‰∏ÄÊ∑ªÂä†Â∑¶ËæπË∑ù */\n\t\t\t\t.message-content {\n\t\t\t\t\tmargin-left: 24rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t&.right {\n\t\t\t\tjustify-content: flex-end;\n\t\t\t\tpadding-right: 16rpx;\n\t\t\t\t\n\t\t\t\t/* üî• ÂÖ≥ÈîÆ‰øÆÊîπÔºöÂè≥‰æßÊ∂àÊÅØÂÜÖÂÆπÁªü‰∏ÄÊ∑ªÂä†Âè≥ËæπË∑ù */\n\t\t\t\t.message-content {\n\t\t\t\t\tmargin-right: 24rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.avatar {\n\t\t\t\twidth: 80rpx;\n\t\t\t\theight: 80rpx;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t}\n\t\t\t\n\t\t\t.message-bubble {\n\t\t\t\tmax-width: 500rpx;\n\t\t\t\tpadding: 20rpx 24rpx;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tword-wrap: break-word;\n\t\t\t\t\n\t\t\t\t&.left-bubble {\n\t\t\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\t\t\tcolor: #ffffff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t&.right-bubble {\n\t\t\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\t\t\tcolor: #ffffff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t&.payment-message {\n\t\t\t\t\tborder: 2rpx solid #ff6b6b;\n\t\t\t\t\tbackground: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);\n\t\t\t\t\tcolor: #ff4444;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(255, 107, 107, 0.2);\n\t\t\t\t\t\n\t\t\t\t\t&.right-bubble {\n\t\t\t\t\t\tbackground: linear-gradient(135deg, #ff6b6b 0%, #ff4444 100%);\n\t\t\t\t\t\tcolor: #ffffff;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.input-bar {\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n\tz-index: 100;\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 16rpx 24rpx;\n\tbackground-color: #ffffff;\n\tborder-top: 1rpx solid #e5e5e5;\n\ttransition: bottom 0.3s ease;\n\t\n\t.input-field {\n\t\tflex: 1;\n\t\theight: 68rpx;\n\t\tpadding: 0 24rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tborder-radius: 34rpx;\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.emoji-btn,\n\t.add-btn {\n\t\tmargin-left: 16rpx;\n\t\tfont-size: 48rpx;\n\t\tcolor: #666666;\n\t}\n}\n\n.new-message-tip {\n\tposition: fixed;\n\tright: 32rpx;\n\tbottom: 180rpx;\n\tz-index: 99;\n\topacity: 0;\n\ttransform: translateY(20rpx) scale(0.8);\n\ttransition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\tpointer-events: none;\n\t\n\t&.show {\n\t\topacity: 1;\n\t\ttransform: translateY(0) scale(1);\n\t\tpointer-events: auto;\n\t}\n\t\n\t.tip-content {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 16rpx 24rpx;\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\tcolor: #ffffff;\n\t\tborder-radius: 40rpx;\n\t\tbox-shadow: 0 8rpx 24rpx rgba(102, 126, 234, 0.4);\n\t\tanimation: tipPulse 2s infinite;\n\t\t\n\t\t.tip-icon {\n\t\t\tfont-size: 32rpx;\n\t\t\tmargin-right: 8rpx;\n\t\t}\n\t\t\n\t\t.tip-text {\n\t\t\tfont-size: 26rpx;\n\t\t\tfont-weight: 500;\n\t\t\tmargin-right: 8rpx;\n\t\t}\n\t\t\n\t\t.tip-arrow {\n\t\t\tfont-size: 28rpx;\n\t\t\tanimation: bounce 1s infinite;\n\t\t}\n\t}\n}\n\n@keyframes tipPulse {\n\t0%, 100% {\n\t\tbox-shadow: 0 8rpx 24rpx rgba(102, 126, 234, 0.4);\n\t}\n\t50% {\n\t\tbox-shadow: 0 8rpx 32rpx rgba(102, 126, 234, 0.6);\n\t}\n}\n\n@keyframes bounce {\n\t0%, 100% {\n\t\ttransform: translateY(0);\n\t}\n\t50% {\n\t\ttransform: translateY(4rpx);\n\t}\n}\n\n.purchase-popup {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tdisplay: none;\n\tjustify-content: center;\n\talign-items: flex-end;\n\tz-index: 1000;\n\t\n\t&.show {\n\t\tdisplay: flex;\n\t\tanimation: fadeIn 0.3s ease;\n\t}\n\t\n\t.popup-content {\n\t\twidth: 100%;\n\t\tmax-height: 80vh;\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 32rpx 32rpx 0 0;\n\t\tpadding: 40rpx 32rpx;\n\t\tposition: relative;\n\t\tanimation: slideUp 0.3s ease;\n\t\t\n\t\t.close-btn {\n\t\t\tposition: absolute;\n\t\t\ttop: 20rpx;\n\t\t\tright: 20rpx;\n\t\t\twidth: 60rpx;\n\t\t\theight: 60rpx;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tfont-size: 40rpx;\n\t\t\tcolor: #999999;\n\t\t}\n\t\t\n\t\t.popup-goods-info {\n\t\t\tdisplay: flex;\n\t\t\tpadding: 20rpx 0;\n\t\t\tborder-bottom: 1rpx solid #f0f0f0;\n\t\t\tmargin-bottom: 30rpx;\n\t\t\t\n\t\t\t.popup-goods-image {\n\t\t\t\twidth: 160rpx;\n\t\t\t\theight: 160rpx;\n\t\t\t\tborder-radius: 12rpx;\n\t\t\t}\n\t\t\t\n\t\t\t.popup-goods-detail {\n\t\t\t\tflex: 1;\n\t\t\t\tmargin-left: 24rpx;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\t\n\t\t\t\t.popup-goods-name {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #333333;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.popup-goods-price {\n\t\t\t\t\tfont-size: 40rpx;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcolor: #ff4444;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t.address-section {\n\t\t\tmargin-bottom: 30rpx;\n\t\t\t\n\t\t\t.address-header {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tmargin-bottom: 20rpx;\n\t\t\t\t\n\t\t\t\t.location-icon {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\tmargin-right: 8rpx;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.address-title {\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #333333;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.address-tip {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #999999;\n\t\t\t\t\tmargin-left: 8rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.address-input-container {\n\t\t\t\tposition: relative;\n\t\t\t\t\n\t\t\t\t.address-input {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmin-height: 120rpx;\n\t\t\t\t\tpadding: 20rpx;\n\t\t\t\t\tbackground-color: #f8f8f8;\n\t\t\t\t\tborder-radius: 12rpx;\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor: #333333;\n\t\t\t\t\tline-height: 1.6;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.address-placeholder {\n\t\t\t\t\tcolor: #cccccc;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.save-address-btn {\n\t\t\t\twidth: 100%;\n\t\t\t\tmargin-top: 20rpx;\n\t\t\t\tpadding: 20rpx;\n\t\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\t\tcolor: #ffffff;\n\t\t\t\tborder-radius: 12rpx;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t\ttext-align: center;\n\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(102, 126, 234, 0.3);\n\t\t\t\ttransition: all 0.3s;\n\t\t\t\t\n\t\t\t\t&:active {\n\t\t\t\t\ttransform: scale(0.98);\n\t\t\t\t\tbox-shadow: 0 2rpx 8rpx rgba(102, 126, 234, 0.3);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.saved-address {\n\t\t\t\tmargin-top: 16rpx;\n\t\t\t\tpadding: 16rpx;\n\t\t\t\tbackground-color: #f0f9ff;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t\tborder-left: 4rpx solid #667eea;\n\t\t\t\t\n\t\t\t\t.saved-label {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #667eea;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tmargin-right: 8rpx;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.saved-text {\n\t\t\t\t\tfont-size: 26rpx;\n\t\t\t\t\tcolor: #666666;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t.payment-section {\n\t\t\t.payment-button {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 88rpx;\n\t\t\t\tbackground: linear-gradient(135deg, #ff9800 0%, #ff6b00 100%);\n\t\t\t\tborder-radius: 44rpx;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tbox-shadow: 0 8rpx 24rpx rgba(255, 152, 0, 0.3);\n\t\t\t\t\n\t\t\t\t.transaction-icon {\n\t\t\t\t\tfont-size: 48rpx;\n\t\t\t\t\tmargin-right: 12rpx;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.payment-text {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcolor: #ffffff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.emoji-panel {\n\tposition: fixed;\n\tbottom: 100rpx;\n\tleft: 0;\n\tright: 0;\n\theight: 500rpx;\n\tbackground-color: #f7f7f7;\n\tborder-top: 1rpx solid #e5e5e5;\n\ttransform: translateY(100%);\n\ttransition: transform 0.3s ease;\n\tz-index: 98;\n\t\n\t&.show {\n\t\ttransform: translateY(0);\n\t}\n\t\n\t.emoji-scroll {\n\t\theight: 100%;\n\t\tpadding: 20rpx;\n\t\t\n\t\t.emoji-grid {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: repeat(4, 1fr);\n\t\t\tgap: 20rpx;\n\t\t\t\n\t\t\t.emoji-item {\n\t\t\t\taspect-ratio: 1;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tbackground-color: #ffffff;\n\t\t\t\tborder-radius: 12rpx;\n\t\t\t\ttransition: all 0.2s;\n\t\t\t\t\n\t\t\t\t&:active {\n\t\t\t\t\ttransform: scale(0.95);\n\t\t\t\t\tbackground-color: #f0f0f0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.emoji-image {\n\t\t\t\t\twidth: 80%;\n\t\t\t\t\theight: 80%;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n/* üî• ÂÖ≥ÈîÆ‰øÆÊîπÔºöÊ∂àÊÅØÂÜÖÂÆπÂÆπÂô® - ÁßªÈô§ÊâÄÊúâÂÜÖÈÉ® margin */\n.message-content {\n\tmax-width: 500rpx;\n\t\n\t/* ÂõæÁâáÊ∂àÊÅØ */\n\t.message-image {\n\t\tmax-width: 250rpx;\n\t\tmax-height: 250rpx;\n\t\tmin-width: 160rpx;\n\t\tmin-height: 160rpx;\n\t\tborder-radius: 12rpx;\n\t\tdisplay: block;\n\t\tbackground-color: #f5f5f5;\n\t\t/* üî• ÁßªÈô§ margin-right Âíå margin-left */\n\t}\n\t\n\t/* Ë°®ÊÉÖÂåÖÊ∂àÊÅØ */\n\t.message-emoji {\n\t\twidth: 120rpx;\n\t\theight: 120rpx;\n\t\tdisplay: block;\n\t\t/* üî• ÁßªÈô§ margin-right Âíå margin-left */\n\t}\n\t\n\t/* ‰∫§ÊòìÊ∂àÊÅØ */\n\t.transaction-message {\n\t\tmax-width: none !important;\n\t\tpadding: 0 !important;\n\t\tborder-radius: 16rpx !important;\n\t\t/* üî• ÁßªÈô§ margin-right Âíå margin-left */\n\t}\n\t\n\t/* ÂêåÊÑèÊ∂àÊÅØ */\n\t.agree-message {\n\t\tmax-width: none !important;\n\t\tpadding: 0 !important;\n\t\tborder-radius: 16rpx !important;\n\t\t/* üî• ÁßªÈô§ margin-right Âíå margin-left */\n\t}\n\t\n\t/* ÂÆåÊàêÊ∂àÊÅØ */\n\t.finish-message {\n\t\tmax-width: none !important;\n\t\tpadding: 0 !important;\n\t\tborder-radius: 16rpx !important;\n\t\t/* üî• ÁßªÈô§ margin-right Âíå margin-left */\n\t}\n}\n\n.message-emoji:active {\n\ttransform: scale(1.1);\n\ttransition: transform 0.1s ease;\n}\n\n/* ‰∫§ÊòìÊ∂àÊÅØÊ†∑Âºè */\n.transaction-message {\n\twidth: 480rpx;\n\tbackground: linear-gradient(135deg, #fff9e6 0%, #fff3d6 100%);\n\tborder: 2rpx solid #ffb800;\n\tborder-radius: 16rpx;\n\toverflow: hidden;\n\tbox-shadow: 0 4rpx 12rpx rgba(255, 184, 0, 0.15);\n\t\n\t&.left-transaction {\n\t\tbackground: linear-gradient(135deg, #e8f5e9 0%, #dcedc8 100%);\n\t\tborder-color: #4caf50;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(76, 175, 80, 0.15);\n\t}\n\t\n\t&.right-transaction {\n\t\tbackground: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);\n\t\tborder-color: #2196f3;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(33, 150, 243, 0.15);\n\t}\n\t\n\t.transaction-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 18rpx 20rpx;\n\t\tbackground: rgba(255, 255, 255, 0.5);\n\t\tborder-bottom: 1rpx solid rgba(0, 0, 0, 0.05);\n\t\t\n\t\t.transaction-icon {\n\t\t\tfont-size: 36rpx;\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t\t\n\t\t.transaction-title {\n\t\t\tfont-size: 28rpx;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #333333;\n\t\t}\n\t}\n\t\n\t.transaction-body {\n\t\tpadding: 18rpx 20rpx;\n\t\t\n\t\t.transaction-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-start;\n\t\t\tmargin-bottom: 12rpx;\n\t\t\t\n\t\t\t&:last-child {\n\t\t\t\tmargin-bottom: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.label {\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #666666;\n\t\t\t\tmin-width: 120rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t}\n\t\t\t\n\t\t\t.value {\n\t\t\t\tflex: 1;\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #333333;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tword-break: break-all;\n\t\t\t\t\n\t\t\t\t&.price {\n\t\t\t\t\tcolor: #ff4444;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t&.location {\n\t\t\t\t\tcolor: #2196f3;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t&.tips {\n\t\t\t\t\tcolor: #999999;\n\t\t\t\t\tfont-style: italic;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t.transaction-footer {\n\t\tpadding: 16rpx 20rpx;\n\t\tbackground: rgba(0, 0, 0, 0.03);\n\t\tborder-top: 1rpx solid rgba(0, 0, 0, 0.05);\n\t\t\n\t\t.status-text {\n\t\t\tfont-size: 22rpx;\n\t\t\tcolor: #ff9800;\n\t\t\tfont-weight: 500;\n\t\t}\n\t}\n}\n\n/* ÂêåÊÑè‰∫§ÊòìÊ∂àÊÅØÊ†∑Âºè */\n.agree-message {\n\twidth: 480rpx;\n\tbackground: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);\n\tborder: 2rpx solid #4caf50;\n\tborder-radius: 16rpx;\n\toverflow: hidden;\n\tbox-shadow: 0 4rpx 12rpx rgba(76, 175, 80, 0.2);\n\t\n\t&.left-agree {\n\t\tbackground: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);\n\t\tborder-color: #4caf50;\n\t}\n\t\n\t&.right-agree {\n\t\tbackground: linear-gradient(135deg, #a5d6a7 0%, #81c784 100%);\n\t\tborder-color: #66bb6a;\n\t}\n\t\n\t.agree-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 18rpx 20rpx;\n\t\tbackground: rgba(255, 255, 255, 0.6);\n\t\tborder-bottom: 1rpx solid rgba(76, 175, 80, 0.1);\n\t\t\n\t\t.agree-icon {\n\t\t\tfont-size: 36rpx;\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t\t\n\t\t.agree-title {\n\t\t\tfont-size: 28rpx;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #2e7d32;\n\t\t}\n\t}\n\t\n\t.agree-body {\n\t\tpadding: 18rpx 20rpx;\n\t\t\n\t\t.agree-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-start;\n\t\t\tmargin-bottom: 12rpx;\n\t\t\t\n\t\t\t&:last-child {\n\t\t\t\tmargin-bottom: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.label {\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #1b5e20;\n\t\t\t\tmin-width: 120rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t}\n\t\t\t\n\t\t\t.value {\n\t\t\t\tflex: 1;\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #2e7d32;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tword-break: break-all;\n\t\t\t\t\n\t\t\t\t&.price {\n\t\t\t\t\tcolor: #f44336;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.tips-text {\n\t\t\t\twidth: 100%;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tcolor: #558b2f;\n\t\t\t\ttext-align: center;\n\t\t\t\tpadding: 8rpx 0;\n\t\t\t\tbackground: rgba(255, 255, 255, 0.5);\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t.agree-footer {\n\t\tpadding: 16rpx 20rpx;\n\t\tbackground: rgba(76, 175, 80, 0.1);\n\t\tborder-top: 1rpx solid rgba(76, 175, 80, 0.1);\n\t\t\n\t\t.status-text {\n\t\t\tfont-size: 22rpx;\n\t\t\tcolor: #2e7d32;\n\t\t\tfont-weight: 600;\n\t\t}\n\t}\n}\n\n/* ÂÆåÊàê‰∫§ÊòìÊ∂àÊÅØÊ†∑Âºè */\n.finish-message {\n\twidth: 480rpx;\n\tbackground: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);\n\tborder: 2rpx solid #ff9800;\n\tborder-radius: 16rpx;\n\toverflow: hidden;\n\tbox-shadow: 0 4rpx 12rpx rgba(255, 152, 0, 0.2);\n\t\n\t&.left-finish {\n\t\tbackground: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);\n\t\tborder-color: #ff9800;\n\t}\n\t\n\t&.right-finish {\n\t\tbackground: linear-gradient(135deg, #ffcc80 0%, #ffb74d 100%);\n\t\tborder-color: #f57c00;\n\t}\n\t\n\t.finish-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 18rpx 20rpx;\n\t\tbackground: rgba(255, 255, 255, 0.6);\n\t\tborder-bottom: 1rpx solid rgba(255, 152, 0, 0.1);\n\t\t\n\t\t.finish-icon {\n\t\t\tfont-size: 36rpx;\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t\t\n\t\t.finish-title {\n\t\t\tfont-size: 28rpx;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #e65100;\n\t\t}\n\t}\n\t\n\t.finish-body {\n\t\tpadding: 18rpx 20rpx;\n\t\t\n\t\t.finish-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-start;\n\t\t\tmargin-bottom: 12rpx;\n\t\t\t\n\t\t\t&:last-child {\n\t\t\t\tmargin-bottom: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.label {\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #e65100;\n\t\t\t\tmin-width: 120rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t}\n\t\t\t\n\t\t\t.value {\n\t\t\t\tflex: 1;\n\t\t\t\tfont-size: 26rpx;\n\t\t\t\tcolor: #f57c00;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tword-break: break-all;\n\t\t\t\t\n\t\t\t\t&.price {\n\t\t\t\t\tcolor: #f44336;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.tips-text {\n\t\t\t\twidth: 100%;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tcolor: #ef6c00;\n\t\t\t\ttext-align: center;\n\t\t\t\tpadding: 8rpx 0;\n\t\t\t\tbackground: rgba(255, 255, 255, 0.5);\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t.finish-footer {\n\t\tpadding: 16rpx 20rpx;\n\t\tbackground: rgba(255, 152, 0, 0.1);\n\t\tborder-top: 1rpx solid rgba(255, 152, 0, 0.1);\n\t\t\n\t\t.status-text {\n\t\t\tfont-size: 22rpx;\n\t\t\tcolor: #e65100;\n\t\t\tfont-weight: 600;\n\t\t}\n\t}\n}\n\n@keyframes fadeIn {\n\tfrom {\n\t\topacity: 0;\n\t}\n\tto {\n\t\topacity: 1;\n\t}\n}\n\n@keyframes slideUp {\n\tfrom {\n\t\ttransform: translateY(100%);\n\t}\n\tto {\n\t\ttransform: translateY(0);\n\t}\n}\n</style>\n","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1762677684090\n      var cssReload = require(\"D:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}