{"version":3,"sources":["uni-app:///main.js","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?75d5","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?73bf","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?9016","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?17f9","uni-app:///subpkg/text-to-image/text-to-image.vue","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?1c3b","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?1351"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","contentItems","contentText","backgroundCategories","fontLibrary","computed","currentStyle","currentFontList","console","name","currentFontIndex","currentBackground","path","textBox","fontConfig","family","weight","style","url","textColor","highlightColor","highlightGeometry","onLoad","items","plainText","uni","type","content","category","methods","convertContentItemsToText","showHighlightPrompt","title","showCancel","confirmText","confirmColor","filter","map","join","editable","placeholderText","success","icon","duration","clearHighlight","convertToPlainText","handleSelectCategory","selectCategory","handleChangeStyle","changeStyle","length","indices","handleChangeFont","newIndex","handleSliderChange","clearTimeout","getCanvasContext","query","fields","node","size","exec","reject","resolve","doesTextFit","ctx","calculateMaxFontSize","padding","maxWidth","maxHeight","minFont","maxFont","bestFit","low","high","i","mid","loadCustomFont","Promise","fontFamilyName","mask","source","fail","generateImage","newFontSize","canvasWidth","canvasHeight","fontSize","newMaxFontSize","enableShadow","highlightQueries","tempFilePath","drawTextOnBackground","canvas","dpr","width","height","fontStyle","fontWeight","fontFamily","exportPromise","exportTimeout","setTimeout","drawMixedContent","box","hAlign","vAlign","lineHeight","emojiSize","segments","totalHeight","startY","hasHighlight","defaultHighlightGeo","yOffset","customHighlightGeo","geo","textWithoutEmojis","highlightRanges","start","end","startIndex","textCharIndex","line","lineWidth","x","currentIndex","prepareDrawSegments","lines","currentLine","currentLineWidth","item","text","char","charWidth","lastItem","image","loadImageToCanvas","img","wrapText","drawBackgroundImage","uploadToOSS","src","quality","compressedFile","openid","fileType","tokenRes","uploadUrl","publicUrl","filePath","encoding","fileContent","method","header","confirmSelection","uploadAndNavigate","ossUrl","res","imageUrl","images","isTopic","goBack"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsI;AACtI;AACiE;AACL;AACsC;;;AAGlG;AACyJ;AACzJ,gBAAgB,mKAAU;AAC1B,EAAE,mFAAM;AACR,EAAE,oGAAM;AACR,EAAE,6GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,wGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAwjB,CAAgB,qkBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;AC+H5kB;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAEA;EACAC;IAAA;IACA;MACAC;MACAC;IAAA,uDACA,kEACA,0DACA,8DACA,yDACA,2DACA,uDACA,gEAIA,iEAEAC,4FACAC,0FACA,mEAEA,6DACA,wDACA,gEACA,0DAEA,6DAEA;EAEA;EAEAC,0CAEA;IAEAC;MACA;MACA;MACA;IACA;IAEAC;MAAA;MACA;QACA;MACA;MACA;QACA;QACA;UACAC;UACA;YAAAC;UAAA;QACA;QACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MAEA;MACA;MAEA;MACA;QACAH;QACA;MACA;MAEA;MAEA;QACAA;QACA;MACA;MAEA;QACAI;QACAH;QACAI;QAEAC;UACAC;UACAC;UACAC;UACAC;QACA;QACAC;QACAC;QACAC;MACA;IACA;EAAA,EAEA;EACAC;IAAA;IACA;MACA;MACA;MAEA;QACA;QACA;QACAd;UACAe;UACAC;QACA;QACAC;MACA;QACA;QACA;UACAC;UACAC;QACA;MACA;IACA;MACAnB;MACA;QACA;QACA;UACAkB;UACAC;QACA;MACA;IACA;;IAEA;IACA;MACA;QACA;QACA;UACA;UACAnB;QACA;MACA;QACAA;MACA;IACA;IAEA;MACA;IACA;;IAEA;IACA;MACA;MAEAoB;QACA;UACA;QACA;MACA;MAEA;MACA;IACA;IAEA;MACA;IACA;EACA;EAEAC,yCACA;IAGA;IACAC;MACA;QACA;UACA;QACA;UACA;QACA;;QACA;MACA;IACA;IAEAC;MAAA;MACA;MACA;QAAA;MAAA;MACA;QACA;UACA;UACA;UACA;QACA;QACA;MACA;MAEA;MAEA;QACAN;UACAO;UACAL;UACAM;UACAC;UACAC;QACA;QACA;MACA;;MAEA;MACA,0CACAC;QAAA;MAAA,GACAC;QAAA;MAAA,GACAC;MAEA9B;MAEAiB;QACAO;QACAO;QACAC;QACAC;UACA;YACA;YACA;;YAEA;YACA;cACAhB;gBACAO;gBACAL;gBACAM;gBACAC;gBACAO;kBACA;gBACA;cACA;cACA;YAEA;;YAEA;YACA;cACAhB;gBACAO;gBACAU;gBACAC;cACA;cACA;YACA;;YAEA;YACA;YACAnC;;YAEA;YACA;YAEAiB;cACAO;cACAU;cACAC;YACA;UACA;QACA;MACA;IACA;IAIA;IACA;IACAC;MAAA;MACA;QAEAnB;UACAO;UACAL;UACAc;YACA;cACA;cACA;cACAhB;gBACAO;gBACAU;cACA;YACA;UACA;QACA;MACA;IACA;IAEAG;MACA;QACA;UACA;QACA;UACA;QACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MACA;MAEA;QACAxB;UACAO;UACAU;UACAC;QACA;QACA;MACA;MAEA;QACAnC;QACA;UAAA0C;QAAA;UAAA;QAAA;QACA;UACA;UAAA,YACA;UAAAC;UAAAA;QACA;QACA;QA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CAC;8BAEAlC;8BACAA;8BACAA;8BAEA;gCACAA;gCACAA;gCACAA;gCACAA;8BACA;;8BAEA;8BAAA;8BAAA,OACA;4BAAA;8BAEA;8BACAmC;gCACA3E;kCACAoE;kCACApD;oCAAA;kCAAA;kCACAyC;oCAAA;kCAAA;gCACA;8BACA;8BAEAmB;gCACAC;kCACA9F;kCACAsD;gCACA;8BACA;8BAAA;8BAAA,OAEAgB;4BAAA;8BAAAa;8BACA5B;8BAAA;8BAAA;4BAAA;8BAAA;8BAAA;8BAGAD;4BAAA;4BAAA;8BAAA;0BAAA;wBAAA;sBAAA;oBAAA,CAEA;oBAAA;sBAAA;oBAAA;kBAAA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACAyC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBACArC;gBAEAC;gBACAqC;gBACAC;gBAEAC;gBACAC;gBAEA;gBAAA;gBAAA,OACA;cAAA;gBAAAC;gBAEA;gBACAC;gBAGA;kBACA;oBACAC;kBACA;oBACAA;kBACA;oBACAA;kBACA;gBACA;kBACAA;gBACA;;gBAEA;gBACArB;gBACAsB;gBACA5F;gBACA6F;kBAAAC;kBAAAlB;gBAAA;gBACAmB;gBACAC,iDAEA;gBACAC,iCACAjF;kBAAA;gBAAA,GACAC;kBAAA;gBAAA,GACAC,UAEA;gBACAgF;gBACA;kBACA5B;oBACA;oBACA;oBACA;sBACA4B;wBACAC;wBACAC;sBACA;sBACAC;oBACA;kBACA;gBACA;;gBAEA;gBACAC;gBAEAb;kBACA;;kBAEA;kBACA;kBACAc;oBACA;sBACAC;oBACA;sBACAA;oBACA;kBACA;;kBAEA;kBACA;kBACA;oBACA;sBACAC;oBACA;sBACAA;oBACA;sBACAA;oBACA;kBACA;oBACA;sBACAA;oBACA;sBACAA;oBACA;sBACAA;oBACA;kBACA;;kBAEA;kBACAF;oBACA;sBACA;;sBAEA;sBACA;wBAAA,2BACAhD;0BACA;0BACA;0BACA;;0BAEA;0BACA;4BAAA,OACAmD;0BAAA,EACA;0BAEA;4BACA;4BACA;4BACA;4BAEA7D;4BACAA;4BACAA;4BACAA;4BACAA;4BACAA;4BACAA;4BACAA;0BACA;;0BAEA;0BACAA;0BACA4D;wBAAA;wBA3BA;0BAAA;wBA4BA;sBACA;wBACA;wBACA5D;wBACA4D;sBACA;sBAEAH;oBAEA;sBACA;sBACA;sBACAzD;sBACA4D;oBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAGA;IACAE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBACAC;gBACAC,sBAEA;gBAAA,uCACAjI;gBAAA;gBAAA;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;gBAAAkI;gBAAA,MACAA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAA;gBACA3H;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACA2H;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAKA;gBAAA,wCACAlI;gBAAA;kBAAA;oBAAAkI;oBACA;sBACAC;sBAAA,wCAEAA;sBAAA;wBAAA;0BAAAC;0BACAC;0BAEA;4BACA;4BACAN;4BACAC;4BACAC;0BACA;;0BAEA;0BACAK;0BACA;4BACAA;0BACA;4BACAN;8BACAvG;8BACAC;4BACA;0BACA;0BAEAuG;wBACA;sBAAA;wBAAA;sBAAA;wBAAA;sBAAA;oBAEA;sBACA;wBACA;wBACAF;wBACAC;wBACAC;sBACA;sBAEAD;wBACAvG;wBACA8G;wBACA/H;sBACA;sBAEAyH;oBACA;kBACA;;kBAEA;gBAAA;kBAAA;gBAAA;kBAAA;gBAAA;gBACA;kBACAF;gBACA;gBAAA,kCAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACAS;MACA;QACA;QAEAC;UACAlI;UACAuD;QACA;QAEA2E;UACAlI;UACAsD;QACA;QAEA4E;;QAEA;QACApC;UACAxC;QACA;MACA;IACA;IAGA;IACA;IACA6E;MACA;MACA;MACA;;MAEA;QAAA;;QAEA;QACA;UACAX;UACAC;UACA;QACA;;QAEA;QACA;;QAEA;UAAA;UACAD;UACAC;QACA;UACAA;QACA;MACA;;MAEA;QAAA;QACAD;MACA;;MAEA;IACA;IAEA;IACAY;MACA;QACA;QAEAJ;UACAvE;UACAzD;UACAuD;QACA;QAEAyE;UACAhI;UACAsD;QACA;QAEA0E;QACAhI;MACA;MAEA;QACA8F;UACA9F;UACAsD;QACA;MACA;MAEA;IACA;IAEA;IACA+E;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEArI;gBAEAA;gBAAA;gBAAA,OACA;kBACAiB;oBACAqH;oBACAC;oBACAtG;oBACAyC;sBACA1E;sBACAsD;oBACA;kBACA;gBACA;cAAA;gBAVAkF;gBAYArD;gBACAnF;gBAAA;gBAAA,OAGAiB;kBACAwH;kBACAC;gBACA;cAAA;gBAAA;gBAHAC;gBAAA,MAKAA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAGAC;gBACAC;gBAAA;gBAAA,OAEA;kBACA5H;oBACA6H;oBACAC;oBACA9G;sBAAA;oBAAA;oBACAyC;kBACA;gBACA;cAAA;gBAPAsE;gBAAA;gBAAA,OASA;kBACA/H;oBACA6H;oBACA7G;sBACAjC;sBAEAiB;wBACAP;wBACAuI;wBACAC;0BAAA;wBAAA;wBACA1J;wBACAyC;0BACA,8CACAqB;wBACA;wBACAoB;sBACA;oBACA;oBACAA;kBACA;gBACA;cAAA;gBAEA;gBACA1E;gBAAA,kCAEA6I;cAAA;gBAAA;gBAAA;gBAGA7I;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA;IAEA;IACAmJ;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAIA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBAAA;gBAAA;gBAAA,OAGA;cAAA;gBAAAC;gBAEApI;kBACAO;kBACAU;kBACAC;gBACA;gBAEA2D;kBACA;kBACA;kBAEA9F;kBAEAiB;oBACAP;oBACAuB;sBACAqH;wBACAC;wBAAA;wBACAC;wBAAA;wBACArI;wBACAsI;sBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAzJ;gBACAiB;kBACAO;kBACAU;kBACAC;gBACA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAuH;MACAzI;IACA;EAAA;AAGA;AAAA,2B;;;;;;;;;;;;;ACluCA;AAAA;AAAA;AAAA;AAAmlC,CAAgB,oiCAAG,EAAC,C;;;;;;;;;;;ACAvmC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"subpkg/text-to-image/text-to-image.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpkg/text-to-image/text-to-image.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./text-to-image.vue?vue&type=template&id=3f3b62ce&scoped=true&\"\nvar renderjs\nimport script from \"./text-to-image.vue?vue&type=script&lang=js&\"\nexport * from \"./text-to-image.vue?vue&type=script&lang=js&\"\nimport style0 from \"./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f3b62ce\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpkg/text-to-image/text-to-image.vue\"\nexport default component.exports","export * from \"-!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=template&id=3f3b62ce&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.tempImagePath && !_vm.isGenerating && _vm.highlightQueries.length > 0\n  var g1 =\n    _vm.tempImagePath && !_vm.isGenerating ? _vm.currentFontList.length : null\n  var l0 = _vm.__map(_vm.backgroundCategories, function (bg, index) {\n    var $orig = _vm.__get_orig(bg)\n    var g2 = _vm.selectedCategoryIndex === index && bg.styles.length > 1\n    return {\n      $orig: $orig,\n      g2: g2,\n    }\n  })\n  var g3 =\n    _vm.tempImagePath && !_vm.isGenerating ? _vm.highlightQueries.length : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        l0: l0,\n        g3: g3,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"text-to-image-page\">\n\t\t<canvas \n\t\t\tid=\"textCanvas\" \n\t\t\ttype=\"2d\" \n\t\t\tstyle=\"width: 750px; height: 1000px; position: fixed; left: -9999px;\"\n\t\t></canvas>\n\t\t\n\t\t<view class=\"image-preview-container\">\n\t\t\t<view class=\"loading-container\" v-if=\"isGenerating\">\n\t\t\t\t<view class=\"loading-spinner\"></view>\n\t\t\t\t<text class=\"loading-text\">æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"preview-image-wrapper\" \n\t\t\t\tv-else-if=\"tempImagePath\"\n\t\t\t>\n\t\t\t\t<image \n\t\t\t\t  id=\"previewImage\"\n\t\t\t\t  class=\"preview-image\" \n\t\t\t\t  :src=\"tempImagePath\" \n\t\t\t\t  mode=\"widthFix\"\n\t\t\t\t></image>\n\t\t\t\t\n\t\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"empty-preview\" v-else>\n\t\t\t\t<text class=\"empty-icon\">ğŸ¨</text>\n\t\t\t\t<text class=\"empty-text\">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡ç”Ÿæˆé¢„è§ˆ</text>\n\t\t\t\t<text class=\"empty-hint\">å‘ä¸‹æ»‘åŠ¨é€‰æ‹©èƒŒæ™¯é£æ ¼</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"highlight-toolbar-container\" v-if=\"tempImagePath && !isGenerating && highlightQueries.length > 0\">\n\t\t\t<view class=\"button-group\">\n\t\t\t\t<view class=\"highlight-action-btn add-more\" @click=\"showHighlightPrompt\">\n\t\t\t\t\t<text>ç»§ç»­æ·»åŠ </text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"highlight-action-btn clear\" @click=\"clearHighlight\">\n\t\t\t\t\t<text>æ¸…é™¤</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"font-slider-container\" v-if=\"tempImagePath && !isGenerating\">\n\t\t\t<text class=\"slider-label\">å­—å·:</text>\n\t\t\t<slider\n\t\t\t\tclass=\"font-slider\"\n\t\t\t\t:value=\"currentFontSize\"\n\t\t\t\t:min=\"minFontSize\"\n\t\t\t\t:max=\"initialFontSize\"\n\t\t\t\t@changing=\"handleSliderChange\" \n\t\t\t\tblock-size=\"20\"\n\t\t\t\tactiveColor=\"#C00000\"\n\t\t\t\tbackgroundColor=\"#f0f0f0\"\n\t\t\t/>\n\t\t\t<view \n\t\t\t\tclass=\"font-change-button\" \n\t\t\t\tv-if=\"currentFontList.length > 1\" \n\t\t\t\t@click=\"handleChangeFont\"\n\t\t\t>\n\t\t\t\t<text>æ¢å­—ä½“</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"bg-selector-section\">\n\t\t\t<text class=\"selector-title\">é€‰æ‹©èƒŒæ™¯é£æ ¼</text>\n\t\t\t<scroll-view class=\"bg-image-list\" scroll-x show-scrollbar=\"false\">\n\t\t\t\t<view \n\t\t\t\t\tclass=\"bg-image-item\"\n\t\t\t\t\tv-for=\"(bg, index) in backgroundCategories\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"{ \n\t\t\t\t\t\t'active': selectedCategoryIndex === index,\n\t\t\t\t\t\t'disabled': isGenerating\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"handleSelectCategory(index)\"\n\t\t\t\t>\n\t\t\t\t\t<image \n\t\t\t\t\t\tclass=\"bg-thumbnail\" \n\t\t\t\t\t\t:src=\"bg.currentStyle.path\" \n\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t></image>\n\t\t\t\t\t<view class=\"bg-name-wrapper\">\n\t\t\t\t\t\t<text class=\"bg-name\">{{ bg.name }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"selected-badge\" v-if=\"selectedCategoryIndex === index\">\n\t\t\t\t\t\t<text class=\"badge-icon\">âœ“</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"change-style-btn\" \n\t\t\t\t\t\tv-if=\"selectedCategoryIndex === index && bg.styles.length > 1\"\n\t\t\t\t\t\t@click.stop=\"handleChangeStyle(index)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<text class=\"change-icon\">ğŸ”„</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<view class=\"bottom-actions\">\n\t\t\t<view class=\"action-btn cancel\" @click=\"goBack\">\n\t\t\t\t<text>å–æ¶ˆ</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"action-btn drawing-toggle\" \n\t\t\t\t@click=\"showHighlightPrompt\"\n\t\t\t\tv-if=\"tempImagePath && !isGenerating\"\n\t\t\t>\n\t\t\t\t<text>{{ highlightQueries.length > 0 ? 'ç»§ç»­æ·»åŠ ' : 'é«˜äº®' }}</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"action-btn confirm\" \n\t\t\t\t:class=\"{ 'disabled': !tempImagePath || isGenerating || isUploading }\"\n\t\t\t\t@click=\"confirmSelection\"\n\t\t\t>\n\t\t\t\t<text>{{ isUploading ? 'ä¸Šä¼ ä¸­...' : isGenerating ? 'ç”Ÿæˆä¸­...' : 'ä¸‹ä¸€æ­¥' }}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState, mapMutations } from 'vuex'\n\timport { backgroundCategories, fontLibrary } from './backgroundConfig.js'; \n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcontentItems: [], \n\t\t\t\tcontentText: '',\n\t\t\t\tcontentItems: [], // ğŸ”¥ æ–°å¢ï¼šå­˜å‚¨æ··åˆå†…å®¹\n\t\t\t\tselectedCategoryIndex: -1,\n\t\t\t\ttempImagePath: '',\n\t\t\t\tgeneratedImageUrl: '',\n\t\t\t\tisGenerating: false,\n\t\t\t\tisUploading: false,\n\t\t\t\tisTopic: false,\n\t\t\t\t\n\t\t\t\t// ğŸ¨ 2. <script> data() ä¿®æ”¹:\n\t\t\t\t// highlightQuery (string) -> highlightQueries (array)\n\t\t\t\thighlightQueries: [], \n\t\t\t\t\n\t\t\t\tbackgroundCategories: backgroundCategories,\n\t\t\t\tfontLibrary: fontLibrary, \n\t\t\t\tloadedFontFamilies: new Set(), \n\t\t\t\t\n\t\t\t\tinitialFontSize: 100, \n\t\t\t\tcurrentFontSize: 18,\n\t\t\t\tminFontSize: 18,\n\t\t\t\tsliderDebounceTimer: null, \n\t\t\t\t\n\t\t\t\tisFirstLoad: true,\r\n\t\t\t\t// ğŸ”¥ æ–°å¢ï¼šå­˜å‚¨ä» topic é¡µé¢ä¼ é€’è¿‡æ¥çš„å›¾ç‰‡\r\n\t\t\t\t      existingImages: []\n\t\t\t}\n\t\t},\n\t\t\n\t\tcomputed: {\n\t\t\t// ... (computed ä¿æŒä¸å˜) ...\n\t\t\t...mapState('m_user', ['openid', 'userBase']),\n\t\t\t\n\t\t\tcurrentStyle() {\n\t\t\t\tif (this.selectedCategoryIndex === -1) return null;\n\t\t\t\tconst category = this.backgroundCategories[this.selectedCategoryIndex];\n\t\t\t\treturn category.styles[category.currentStyleIndex];\n\t\t\t},\n\t\t\t\n\t\t\tcurrentFontList() {\n\t\t\t\tif (!this.currentStyle || !this.currentStyle.fonts) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\treturn this.currentStyle.fonts.map(fontKey => {\n\t\t\t\t\tconst fontData = this.fontLibrary[fontKey];\n\t\t\t\t\tif (!fontData) {\n\t\t\t\t\t\tconsole.error(`âŒ å­—ä½“Key \"${fontKey}\" åœ¨ fontLibrary ä¸­æœªæ‰¾åˆ°!`);\n\t\t\t\t\t\treturn { name: 'Error' }; \n\t\t\t\t\t}\n\t\t\t\t\treturn fontData;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tcurrentFontIndex() {\n\t\t\t\treturn this.currentStyle ? this.currentStyle.currentFontIndex : 0;\n\t\t\t},\n\t\t\t\n\t\t\tcurrentBackground() {\n\t\t\t\tif (!this.currentStyle) return null;\n\t\t\t\t\n\t\t\t\tconst style = this.currentStyle;\n\t\t\t\tconst fontIndex = style.currentFontIndex || 0;\n\t\t\t\t\n\t\t\t\tconst fontKey = style.fonts[fontIndex];\n\t\t\t\tif (!fontKey) {\n\t\t\t\t\t console.error('âŒ å­—ä½“Keyç¼ºå¤±');\n\t\t\t\t\t return null;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst font = this.fontLibrary[fontKey]; \n\t\t\t\t\n\t\t\t\tif (!font) {\n\t\t\t\t\tconsole.error(`âŒ å­—ä½“Key \"${fontKey}\" åœ¨åº“ä¸­æœªæ‰¾åˆ°!`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t  path: style.path,\n\t\t\t\t  name: style.name,\n\t\t\t\t  textBox: style.textBox || null,\n\t\t\t\t  \n\t\t\t\t  fontConfig: { \n\t\t\t\t\tfamily: font.family,\n\t\t\t\t\tweight: font.weight,\n\t\t\t\t\tstyle: font.style || 'normal',\n\t\t\t\t\turl: font.url || null \n\t\t\t\t  },\n\t\t\t\t  textColor: font.textColor,\n\t\t\t\t  highlightColor: font.highlightColor,\n\t\t\t\t  highlightGeometry: font.highlightGeometry || null\n\t\t\t\t};\n\t\t\t}\n\n\t\t},\n\t\tonLoad(options) {\r\n\t\t    try {\r\n\t\t      // å¤„ç†è¯é¢˜å†…å®¹\r\n\t\t      const storedContentItems = uni.getStorageSync('topic_content_items');\r\n\t\t      \r\n\t\t      if (storedContentItems && storedContentItems.length > 0) {\r\n\t\t        this.contentItems = storedContentItems;\r\n\t\t        this.contentText = this.convertContentItemsToText(storedContentItems);\r\n\t\t        console.log('âœ… æˆåŠŸåŠ è½½è¯é¢˜å†…å®¹:', {\r\n\t\t          items: this.contentItems,\r\n\t\t          plainText: this.contentText\r\n\t\t        });\r\n\t\t        uni.removeStorageSync('topic_content_items');\r\n\t\t      } else if (options.content) {\r\n\t\t        this.contentText = decodeURIComponent(options.content);\r\n\t\t        this.contentItems = [{\r\n\t\t          type: 'text',\r\n\t\t          content: this.contentText\r\n\t\t        }];\r\n\t\t      }\r\n\t\t    } catch (err) {\r\n\t\t      console.error('âŒ åŠ è½½è¯é¢˜å†…å®¹å¤±è´¥:', err);\r\n\t\t      if (options.content) {\r\n\t\t        this.contentText = decodeURIComponent(options.content);\r\n\t\t        this.contentItems = [{\r\n\t\t          type: 'text',\r\n\t\t          content: this.contentText\r\n\t\t        }];\r\n\t\t      }\r\n\t\t    }\r\n\t\t    \r\n\t\t    // ğŸ”¥ æ–°å¢ï¼šæ¥æ”¶ä» topic é¡µé¢ä¼ é€’çš„å›¾ç‰‡\r\n\t\t    if (options.images) {\r\n\t\t      try {\r\n\t\t        const images = JSON.parse(decodeURIComponent(options.images));\r\n\t\t        if (Array.isArray(images) && images.length > 0) {\r\n\t\t          this.existingImages = images;\r\n\t\t          console.log('âœ… æˆåŠŸæ¥æ”¶ topic é¡µé¢çš„å›¾ç‰‡:', images);\r\n\t\t        }\r\n\t\t      } catch (error) {\r\n\t\t        console.error('âŒ è§£æå›¾ç‰‡æ•°æ®å¤±è´¥:', error);\r\n\t\t      }\r\n\t\t    }\r\n\t\t    \r\n\t\t    if (options.isTopic) {\r\n\t\t      this.isTopic = options.isTopic === '1';\r\n\t\t    }\r\n\t\t    \r\n\t\t    // åˆå§‹åŒ–èƒŒæ™¯æ ·å¼\r\n\t\t    this.backgroundCategories.forEach(category => {\r\n\t\t      this.$set(category, 'currentStyle', category.styles[category.currentStyleIndex]);\r\n\t\t      \r\n\t\t      category.styles.forEach(style => {\r\n\t\t        if (style.currentFontIndex === undefined) {\r\n\t\t          this.$set(style, 'currentFontIndex', 0);\r\n\t\t        }\r\n\t\t      });\r\n\t\t\r\n\t\t      this.$set(category, '_shuffledIndices', null); \r\n\t\t      this.$set(category, '_shuffledCycleIndex', -1); \r\n\t\t    });\r\n\t\t    \r\n\t\t    this.$nextTick(() => {\r\n\t\t      this.selectCategory(0);\r\n\t\t    });\r\n\t\t  },\n\t\t\n\t\tmethods: {\n\t\t\t...mapMutations('m_user', ['updateUserBase']),\n\t\t\t\n\t\t\t\n\t\t\t// ğŸ”¥ æ–°å¢æ–¹æ³•ï¼šè½¬æ¢contentItemsä¸ºçº¯æ–‡æœ¬\n\t\t\tconvertContentItemsToText(items) {\n\t\t\t  return items.map(item => {\n\t\t\t    if (item.type === 'text') {\n\t\t\t      return item.content;\n\t\t\t    } else if (item.type === 'emoji') {\n\t\t\t      return 'ã€€'; // ç”¨å…¨è§’ç©ºæ ¼å ä½ï¼Œä¿æŒå®½åº¦è®¡ç®—\n\t\t\t    }\n\t\t\t    return '';\n\t\t\t  }).join('');\n\t\t\t},\n\t\t\t\n\t\t\tshowHighlightPrompt() {\r\n\t\t\t   // ğŸ”¥ ä¿®æ”¹ï¼šæ£€æµ‹ä¸¤ç§è¡¨æƒ…åŒ…æƒ…å†µ\r\n\t\t\t    const hasEmojiType = this.contentItems.some(item => item.type === 'emoji');\r\n\t\t\t    const hasEmojiInText = this.contentItems.some(item => {\r\n\t\t\t      if (item.type === 'text') {\r\n\t\t\t        // ä½¿ç”¨æ­£åˆ™æ£€æµ‹æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«emojiå­—ç¬¦\r\n\t\t\t        const emojiRegex = /[\\p{Emoji}\\p{Emoji_Component}]/gu;\r\n\t\t\t        return emojiRegex.test(item.content);\r\n\t\t\t      }\r\n\t\t\t      return false;\r\n\t\t\t    });\r\n\t\t\t    \r\n\t\t\t    const hasEmoji = hasEmojiType || hasEmojiInText;\r\n\t\t\t    \r\n\t\t\t    if (hasEmoji) {\r\n\t\t\t      uni.showModal({\r\n\t\t\t        title: 'æ— æ³•æ·»åŠ é«˜äº®',\r\n\t\t\t        content: 'æ·»åŠ è¡¨æƒ…åŒ…åæ— æ³•æ·»åŠ é«˜äº®ï¼Œè¯·åœ¨çº¯æ–‡å­—å†…å®¹ä¸­ä½¿ç”¨é«˜äº®åŠŸèƒ½',\r\n\t\t\t        showCancel: false,\r\n\t\t\t        confirmText: 'æˆ‘çŸ¥é“äº†',\r\n\t\t\t        confirmColor: '#C00000'\r\n\t\t\t      });\r\n\t\t\t      return;\r\n\t\t\t    }\r\n\t\t\t  \r\n\t\t\t  // ğŸ”¥ ä»¥ä¸‹æ˜¯åŸæœ‰é€»è¾‘ï¼ˆä»…åœ¨æ— è¡¨æƒ…æ—¶æ‰§è¡Œï¼‰\r\n\t\t\t  const textWithoutEmojis = this.contentItems\r\n\t\t\t    .filter(item => item.type === 'text')\r\n\t\t\t    .map(item => item.content)\r\n\t\t\t    .join('');\r\n\t\t\t  \r\n\t\t\t  console.log('ğŸ“„ å½“å‰çº¯æ–‡æœ¬å†…å®¹ï¼ˆç”¨äºé«˜äº®ï¼‰:', textWithoutEmojis);\r\n\t\t\t  \r\n\t\t\t  uni.showModal({\r\n\t\t\t    title: 'æ·»åŠ é«˜äº®å…³é”®è¯',\r\n\t\t\t    editable: true,\r\n\t\t\t    placeholderText: 'ä¾‹å¦‚ï¼šé‡ç‚¹',\r\n\t\t\t    success: (res) => {\r\n\t\t\t      if (res.confirm && res.content) {\r\n\t\t\t        const newQuery = res.content.trim();\r\n\t\t\t        if (!newQuery) return;\r\n\t\t\t        \r\n\t\t\t        // ğŸ”¥ æ£€æŸ¥å…³é”®è¯æ˜¯å¦åœ¨çº¯æ–‡æœ¬ä¸­å­˜åœ¨\r\n\t\t\t        if (!textWithoutEmojis.includes(newQuery)) {\r\n\t\t\t          uni.showModal({\r\n\t\t\t            title: 'æœªæ‰¾åˆ°å…³é”®è¯',\r\n\t\t\t            content: `å†…å®¹ä¸­ä¸åŒ…å«\"${newQuery}\"ï¼Œè¯·æ£€æŸ¥æ‹¼å†™æˆ–é€‰æ‹©å…¶ä»–å…³é”®è¯`,\r\n\t\t\t            showCancel: false,\r\n\t\t\t            confirmText: 'é‡æ–°è¾“å…¥',\r\n\t\t\t            success: () => {\r\n\t\t\t              this.showHighlightPrompt();\r\n\t\t\t            }\r\n\t\t\t          });\r\n\t\t\t          return;\r\n\t\t\t\t\t  \r\n\t\t\t        }\r\n\t\t\t        \r\n\t\t\t        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨\r\n\t\t\t        if (this.highlightQueries.includes(newQuery)) {\r\n\t\t\t          uni.showToast({\r\n\t\t\t            title: 'å…³é”®è¯å·²å­˜åœ¨',\r\n\t\t\t            icon: 'none',\r\n\t\t\t            duration: 2000\r\n\t\t\t          });\r\n\t\t\t          return;\r\n\t\t\t        }\r\n\t\t\t        \r\n\t\t\t        // æ·»åŠ åˆ°æ•°ç»„\r\n\t\t\t        this.highlightQueries.push(newQuery);\r\n\t\t\t        console.log('âœ¨ æ·»åŠ é«˜äº®å…³é”®è¯:', this.highlightQueries);\r\n\t\t\t        \r\n\t\t\t        // é‡æ–°ç”Ÿæˆå›¾ç‰‡\r\n\t\t\t        this.generateImage(this.currentFontSize);\r\n\t\t\t        \r\n\t\t\t        uni.showToast({\r\n\t\t\t          title: `å·²é«˜äº®\"${newQuery}\"`,\r\n\t\t\t          icon: 'success',\r\n\t\t\t          duration: 1500\r\n\t\t\t        });\r\n\t\t\t      }\r\n\t\t\t    }\r\n\t\t\t  });\r\n\t\t\t},\r\n\r\n\n\t\t\t\n\t\t\t// ğŸ¨ 4. <script> methods ä¿®æ”¹: clearHighlight\n\t\t\t// (æ¸…é™¤æ•°ç»„å¹¶å¢åŠ ç¡®è®¤æ¡†)\n\t\t\tclearHighlight() {\n\t\t\t\tif (this.highlightQueries.length > 0) {\n\t\t\t\t\t\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: 'ç¡®è®¤æ¸…é™¤',\n\t\t\t\t\t\tcontent: 'è¦æ¸…é™¤æ‰€æœ‰é«˜äº®å…³é”®è¯å—ï¼Ÿ',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\tthis.highlightQueries = []; // (ä¿®æ”¹) æ¸…ç©ºæ•°ç»„\n\t\t\t\t\t\t\t\tthis.generateImage(this.currentFontSize);\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: 'é«˜äº®å·²æ¸…é™¤',\n\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t  \t\t\t\t\t  \n\t\t\tconvertToPlainText(items) {\n\t\t\t\treturn items.map(item => {\n\t\t\t\t\tif (item.type === 'text') {\n\t\t\t\t\t\treturn item.content;\n\t\t\t\t\t} else if (item.type === 'emoji') {\n\t\t\t\t\t\treturn `[${item.name || 'è¡¨æƒ…'}]`;\n\t\t\t\t\t}\n\t\t\t\t\treturn '';\n\t\t\t\t}).join('');\n\t\t\t},\n\t\t\t\n\t\t\t// ... (handleSelectCategory, selectCategory, changeStyle ä¿æŒä¸å˜) ...\n\t\t\thandleSelectCategory(index) {\n\t\t\t\tif (this.isGenerating) return;\n\t\t\t\tthis.selectCategory(index);\n\t\t\t},\n\t\t\t\n\t\t\tselectCategory(index) {\n\t\t\t\tthis.selectedCategoryIndex = index;\n\t\t\t\tthis.generateImage(null);\n\t\t\t},\n\t\t\t\n\t\t\thandleChangeStyle(index) {\n\t\t\t\tif (this.isGenerating) return;\n\t\t\t\tthis.changeStyle(index);\n\t\t\t},\n\t\t\t\n\t\t\tchangeStyle(categoryIndex) {\n\t\t\t  const category = this.backgroundCategories[categoryIndex];\n\t\t\t  const styleCount = category.styles.length;\n\t\t\t  \n\t\t\t  if (styleCount <= 1) {\n\t\t\t\tuni.showToast({\n\t\t\t\t  title: 'è¯¥é£æ ¼æš‚æ— å…¶ä»–æ­é…',\n\t\t\t\t  icon: 'none',\n\t\t\t\t  duration: 1500\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t  }\n\t\t\t  \n\t\t\t  if (!category._shuffledIndices || category._shuffledCycleIndex >= styleCount - 1) {\n\t\t\t\tconsole.log(`ğŸ”„ åˆ—è¡¨æ’­æ”¾å®Œæ¯•, ä¸º ${category.name} é‡æ–°ç”Ÿæˆéšæœºåˆ—è¡¨...`);\n\t\t\t\tlet indices = Array.from({ length: styleCount }, (_, i) => i);\n\t\t\t\tfor (let i = indices.length - 1; i > 0; i--) {\n\t\t\t\t  const j = Math.floor(Math.random() * (i + 1));\n\t\t\t\t  [indices[i], indices[j]] = [indices[j], indices[i]];\n\t\t\t\t}\n\t\t\t\tconst currentStyleIndex = category.currentStyleIndex;\n\t\t\t\tif (indices[0] === currentStyleIndex && styleCount > 1) {\n\t\t\t\t  const lastIndex = indices.length - 1;\n\t\t\t\t  [indices[0], indices[lastIndex]] = [indices[lastIndex], indices[0]];\n\t\t\t\t}\n\t\t\t\tcategory._shuffledIndices = indices;\n\t\t\t\tcategory._shuffledCycleIndex = -1;\n\t\t\t  }\n\t\t\t  \n\t\t\t  category._shuffledCycleIndex++;\n\t\t\t  const newStyleIndex = category._shuffledIndices[category._shuffledCycleIndex];\n\t\t\t  \n\t\t\t  category.currentStyleIndex = newStyleIndex;\n\t\t\t  this.$forceUpdate();\n\t\t\t  \n\t\t\t  this.generateImage(null); \n\t\t\t  \n\t\t\t  const newStyle = category.styles[newStyleIndex];\n\t\t\t  const fontKey = newStyle.fonts[newStyle.currentFontIndex || 0];\n\t\t\t  const newFont = this.fontLibrary[fontKey]; \n\t\t\t  \n\t\t\t  uni.showToast({\n\t\t\t\ttitle: `${newStyle.name} Â· ${newFont.name}`,\n\t\t\t\ticon: 'success',\n\t\t\t\tduration: 1500\n\t\t\t  });\n\t\t\t},\n\t\t\t\n\t\t\t// ... (handleChangeFont, handleSliderChange ä¿æŒä¸å˜) ...\n\t\t\thandleChangeFont() {\n\t\t\t\tif (this.isGenerating || !this.currentStyle) return;\n\n\t\t\t\tconst fontCount = this.currentFontList.length;\n\t\t\t\tif (fontCount <= 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tconst currentIndex = this.currentFontIndex;\n\t\t\t\tlet newIndex;\n\t\n\t\t\t\tdo {\n\t\t\t\t\tnewIndex = Math.floor(Math.random() * fontCount);\n\t\t\t\t} while (newIndex === currentIndex);\n\t\n\t\t\t\tthis.currentStyle.currentFontIndex = newIndex;\n\t\t\t\tthis.$forceUpdate(); \n\t\t\t\t\n\t\t\t\tthis.generateImage(null); \n\t\n\t\t\t\tconst newFont = this.currentFontList[newIndex];\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: `å­—ä½“: ${newFont.name}`,\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\thandleSliderChange(e) {\n\t\t\t\tconst newSize = e.detail.value;\n\t\t\t\t\n\t\t\t\tthis.currentFontSize = newSize; \n\t\t\t\t\n\t\t\t\tif (this.sliderDebounceTimer) {\n\t\t\t\t\tclearTimeout(this.sliderDebounceTimer);\n\t\t\t\t}\n\t\t\t\tthis.sliderDebounceTimer = setTimeout(() => {\n\t\t\t\t\tthis.generateImage(newSize); \n\t\t\t\t}, 50);\n\t\t\t},\n\n\t\t\t// ... (getCanvasContext, doesTextFit, calculateMaxFontSize, loadCustomFont ä¿æŒä¸å˜) ...\n\t\t\tasync getCanvasContext() {\n\t\t\t\t return new Promise((resolve, reject) => {\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\t\t\tquery.select('#textCanvas')\n\t\t\t\t\t\t.fields({ node: true, size: true })\n\t\t\t\t\t\t.exec((res) => {\n\t\t\t\t\t\t\tif (!res || !res[0] || !res[0].node) {\n\t\t\t\t\t\t\t\treject(new Error('è·å– Canvas å¤±è´¥'));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst canvas = res[0].node;\n\t\t\t\t\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\t\t\t\t\tresolve(ctx);\n\t\t\t\t\t\t});\n\t\t\t\t });\n\t\t\t},\n\t\t\t\n\t\t\tdoesTextFit(ctx, text, fontSize, maxWidth, maxHeight, fontConfig) {\n\t\t\t\tconst fontWeight = fontConfig.weight || 'normal';\n\t\t\t\tconst fontFamily = fontConfig.family || 'sans-serif';\n\t\t\t\tctx.font = `normal ${fontWeight} ${fontSize}px ${fontFamily}`;\n\t\t\t\t\n\t\t\t\tconst lineHeight = fontSize * 1.4;\n\t\t\t\tconst lines = this.wrapText(ctx, text, maxWidth, fontSize); \n\t\t\t\tconst totalHeight = lines.length * lineHeight;\n\t\t\t\t\n\t\t\t\treturn totalHeight <= maxHeight;\n\t\t\t},\n\t\t\t\n\t\t\tasync calculateMaxFontSize(text, canvasWidth, canvasHeight, textBox, fontConfig) {\n\t\t\t\tconst padding = 60;\n\t\t\t\tconst maxWidth = textBox ? textBox.width : canvasWidth - padding * 2;\n\t\t\t\tconst maxHeight = textBox ? textBox.height : canvasHeight * 0.7;\n\t\t\t\t\n\t\t\t\tconst minFont = this.minFontSize; // 18\n\t\t\t\tconst maxFont = 300; \n\n\t\t\t\tconst ctx = await this.getCanvasContext();\n\t\t\t\t\n\t\t\t\tlet bestFit = minFont;\n\t\t\t\tlet low = minFont;\n\t\t\t\tlet high = maxFont;\n\t\t\t\t\n\t\t\t\tfor (let i = 0; i < 10; i++) {\n\t\t\t\t\tif (low > high) break;\n\t\t\t\t\t\n\t\t\t\t\tlet mid = Math.floor((low + high) / 2);\n\t\t\t\t\tif (mid === 0) return bestFit; \n\n\t\t\t\t\tif (this.doesTextFit(ctx, text, mid, maxWidth, maxHeight, fontConfig)) {\n\t\t\t\t\t\tbestFit = mid;\n\t\t\t\t\t\tlow = mid + 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thigh = mid - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log(`Binary search result: bestFit = ${bestFit}`);\n\t\t\t\treturn bestFit;\n\t\t\t},\n\n\t\t\tasync loadCustomFont(fontConfig) {\n\t\t\t  // ğŸ”¥ å…³é”®ï¼šæ²¡æœ‰ URL çš„ç³»ç»Ÿå­—ä½“ç›´æ¥è¿”å›æˆåŠŸ\n\t\t\t  if (!fontConfig || !fontConfig.url) {\n\t\t\t    console.log('âœ… ä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œæ— éœ€åŠ è½½');\n\t\t\t    return Promise.resolve();\n\t\t\t  }\n\t\t\t  \n\t\t\t  const fontFamilyName = fontConfig.family;\n\t\t\t  \n\t\t\t  // å¦‚æœå·²ç»å°è¯•åŠ è½½è¿‡ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œä¸å†é‡å¤å°è¯•\n\t\t\t  if (this.loadedFontFamilies.has(fontFamilyName)) {\n\t\t\t    console.log(`â­ï¸ å­—ä½“ '${fontFamilyName}' å·²å¤„ç†è¿‡ï¼Œè·³è¿‡`);\n\t\t\t    return Promise.resolve();\n\t\t\t  }\n\t\t\t  \n\t\t\t  console.log(`â³ å¼€å§‹åŠ è½½å­—ä½“: ${fontFamilyName} from ${fontConfig.url}`);\n\t\t\t  uni.showLoading({ title: 'åŠ è½½å­—ä½“...', mask: true });\n\t\t\t  \n\t\t\t  // ğŸ”¥ å…³é”®ï¼šä½¿ç”¨ try-catch åŒ…è£¹æ•´ä¸ª Promiseï¼Œç¡®ä¿ä»»ä½•é”™è¯¯éƒ½ä¸ä¼šä¸­æ–­æµç¨‹\n\t\t\t  try {\n\t\t\t    await new Promise((resolve, reject) => {\n\t\t\t      uni.loadFontFace({\n\t\t\t        family: fontFamilyName,\n\t\t\t        source: `url(\"${fontConfig.url}\")`,\n\t\t\t        weight: fontConfig.weight || 'normal',\n\t\t\t        style: fontConfig.style || 'normal',\n\t\t\t        success: () => {\n\t\t\t          console.log(`âœ… å­—ä½“ '${fontFamilyName}' åŠ è½½æˆåŠŸ`);\n\t\t\t          this.loadedFontFamilies.add(fontFamilyName);\n\t\t\t          uni.hideLoading();\n\t\t\t          resolve(); // æˆåŠŸæ—¶ resolve\n\t\t\t        },\n\t\t\t        fail: (err) => {\n\t\t\t          console.warn(`âš ï¸ å­—ä½“ '${fontFamilyName}' åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“:`, err);\n\t\t\t          // ğŸ”¥ å…³é”®ä¿®æ”¹ï¼šå¤±è´¥æ—¶ä¹Ÿæ ‡è®°ä¸ºå·²å¤„ç†ï¼Œå¹¶ resolveï¼ˆä¸ rejectï¼‰\n\t\t\t          this.loadedFontFamilies.add(fontFamilyName);\n\t\t\t          uni.hideLoading();\n\t\t\t          resolve(); // âœ… å³ä½¿å¤±è´¥ä¹Ÿ resolveï¼Œä¸ä¸­æ–­æµç¨‹\n\t\t\t        }\n\t\t\t      });\n\t\t\t    });\n\t\t\t  } catch (error) {\n\t\t\t    // ğŸ”¥ å…œåº•å¤„ç†ï¼šå³ä½¿ Promise å¼‚å¸¸ä¹Ÿä¸æŠ›å‡ºé”™è¯¯\n\t\t\t    console.warn(`âš ï¸ å­—ä½“åŠ è½½å¼‚å¸¸ï¼Œç»§ç»­ä½¿ç”¨ç³»ç»Ÿå­—ä½“:`, error);\n\t\t\t    uni.hideLoading();\n\t\t\t  }\n\t\t\t  \n\t\t\t  // ğŸ”¥ æœ€ç»ˆç¡®ä¿æ€»æ˜¯è¿”å› resolved Promise\n\t\t\t  return Promise.resolve();\n\t\t\t},\n\n\t\t\t\n\t\t\t// ğŸ¨ 5. <script> methods ä¿®æ”¹: generateImage\n\t\t\tasync generateImage(newFontSize = null) {\n\t\t\t\tif (this.isGenerating && newFontSize) {\n\t\t\t\t\tconsole.log('--- æ­£åœ¨ç”Ÿæˆ, ä¸¢å¼ƒæ»‘å—äº‹ä»¶ ---');\n\t\t\t\t\treturn; \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.isGenerating = true;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t  const canvasWidth = 750;\n\t\t\t\t  const canvasHeight = 1000;\n\t\t\t\t  \n\t\t\t\t  if (!this.currentBackground) {\n\t\t\t\t\tthrow new Error('æ— æ³•è·å–å½“å‰èƒŒæ™¯é…ç½®');\n\t\t\t\t  }\n\t\t\t\t  \n\t\t\t\t  await this.loadCustomFont(this.currentBackground.fontConfig);\n\t\t\t\t  \n\t\t\t\t  let fontSize;\n\n\t\t\t\t  if (newFontSize) {\n\t\t\t\t\tfontSize = newFontSize;\n\t\t\t\t  } else {\n\t\t\t\t\tconsole.log('Calculating max font size for new background...');\n\t\t\t\t\tconst newMaxFontSize = await this.calculateMaxFontSize(\n\t\t\t\t\t\tthis.contentText.trim(),\n\t\t\t\t\t\tcanvasWidth,\n\t\t\t\t\t\tcanvasHeight,\n\t\t\t\t\t\tthis.currentBackground.textBox,\n\t\t\t\t\t\tthis.currentBackground.fontConfig \n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(`ğŸ“ æ–°èƒŒæ™¯æœ€å¤§å­—å·: ${newMaxFontSize}px`);\n\t\t\t\t\t\n\t\t\t\t\tthis.initialFontSize = newMaxFontSize;  \n\t\t\t\t\t\n\t\t\t\t\tif (this.isFirstLoad) {\n\t\t\t\t\t\tfontSize = newMaxFontSize;\n\t\t\t\t\t\tthis.isFirstLoad = false; \n\t\t\t\t\t\tconsole.log('é¦–æ¬¡åŠ è½½ï¼Œè®¾ç½®ä¸ºæœ€å¤§å€¼');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfontSize = Math.min(this.currentFontSize, newMaxFontSize);\n\t\t\t\t\t\tconsole.log(`åˆ‡æ¢èƒŒæ™¯ï¼Œä¿ç•™å­—å·: ${this.currentFontSize} -> ${fontSize}`);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tthis.currentFontSize = fontSize;\n\t\t\t\t  }\n\t\t\t\t  \n\t\t\t\t   // ä¿®æ”¹è¿™é‡Œï¼šä¼ é€’ contentItems è€Œä¸æ˜¯ contentText\n\t\t\t\t    const tempFilePath = await this.drawTextOnBackground(\n\t\t\t\t      this.contentItems, // ğŸ”¥ ä¼ é€’ contentItems\n\t\t\t\t      this.currentBackground.path,\n\t\t\t\t      {\n\t\t\t\t        fontSize: fontSize,\n\t\t\t\t        textColor: this.currentBackground.textColor,\n\t\t\t\t        enableShadow: true,\n\t\t\t\t        fontConfig: this.currentBackground.fontConfig,\n\t\t\t\t        highlightColor: this.currentBackground.highlightColor,\n\t\t\t\t        textBox: this.currentBackground.textBox,\n\t\t\t\t        highlightGeometry: this.currentBackground.highlightGeometry,\n\t\t\t\t        highlightQueries: this.highlightQueries\n\t\t\t\t      }\n\t\t\t\t    );\n\t\t\t\t  \n\t\t\t\t  this.tempImagePath = tempFilePath;\n\t\t\t\t  \n\t\t\t\t} catch (error) {\n\t\t\t\t  console.error('âŒ ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);\n\t\t\t\t  uni.showToast({\n\t\t\t\t\ttitle: error.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t  });\n\t\t\t\t} finally {\n\t\t\t\t  this.isGenerating = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// ğŸ”¥ ä¿®æ”¹ drawTextOnBackground æ–¹æ³•\n\t\t\tasync drawTextOnBackground(contentItems, bgImagePath, styleConfig) {\n\t\t\t  return new Promise((resolve, reject) => {\n\t\t\t    const query = uni.createSelectorQuery().in(this);\n\t\t\t    query.select('#textCanvas')\n\t\t\t      .fields({ node: true, size: true })\n\t\t\t      .exec(async (res) => {\n\t\t\t        \n\t\t\t        if (!res || !res[0]) {\n\t\t\t          reject(new Error('è·å– Canvas å¤±è´¥'));\n\t\t\t          return;\n\t\t\t        }\n\t\t\t        \n\t\t\t        const canvas = res[0].node;\n\t\t\t        const ctx = canvas.getContext('2d');\n\t\t\t        \n\t\t\t        const dpr = uni.getSystemInfoSync().pixelRatio;\n\t\t\t        canvas.width = 750 * dpr;\n\t\t\t        canvas.height = 1000 * dpr;\n\t\t\t        ctx.scale(dpr, dpr);\n\t\t\t        \n\t\t\t        const width = 750;\n\t\t\t        const height = 1000;\n\t\t\t        \n\t\t\t        ctx.clearRect(0, 0, width, height);\n\t\t\t        \n\t\t\t        try {\n\t\t\t          // 1. ç»˜åˆ¶èƒŒæ™¯\n\t\t\t          await this.drawBackgroundImage(ctx, canvas, width, height, bgImagePath);\n\t\t\t          \n\t\t\t          // 2. è®¾ç½®å­—ä½“\n\t\t\t          const fontConfig = styleConfig.fontConfig;\n\t\t\t          const fontStyle = fontConfig.style === 'italic' ? 'italic' : 'normal';\n\t\t\t          const fontWeight = fontConfig.weight || 'normal';\n\t\t\t          const fontFamily = fontConfig.family || 'sans-serif';\n\t\t\t          \n\t\t\t          ctx.fillStyle = styleConfig.textColor;\n\t\t\t          ctx.textBaseline = 'middle';\n\t\t\t          ctx.font = `${fontStyle} ${fontWeight} ${styleConfig.fontSize}px ${fontFamily}`;\n\t\t\t          \n\t\t\t          if (styleConfig.enableShadow) {\n\t\t\t            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';\n\t\t\t            ctx.shadowBlur = 8;\n\t\t\t            ctx.shadowOffsetX = 2;\n\t\t\t            ctx.shadowOffsetY = 2;\n\t\t\t          }\n\t\t\t          \n\t\t\t          // 3. ğŸ”¥ ç»˜åˆ¶æ··åˆå†…å®¹ï¼ˆæ–‡å­— + è¡¨æƒ…ï¼‰\n\t\t\t          await this.drawMixedContent(ctx, canvas, contentItems, width, height, styleConfig);\n\t\t\t          \n\t\t\t          // 4. å¯¼å‡ºå›¾ç‰‡\n\t\t\t          const exportPromise = new Promise((res, rej) => {\n\t\t\t            uni.canvasToTempFilePath({\n\t\t\t              canvas: canvas,\n\t\t\t              success: (r) => res(r.tempFilePath),\n\t\t\t              fail: (err) => rej(new Error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥: ' + err.errMsg))\n\t\t\t            }, this);\n\t\t\t          });\n\t\t\t\n\t\t\t          const exportTimeout = new Promise((_, rej) => {\n\t\t\t            setTimeout(() => {\n\t\t\t              console.error('âŒ å¯¼å‡º Canvas è¶…æ—¶');\n\t\t\t              reject(new Error('å›¾ç‰‡å¯¼å‡ºè¶…æ—¶'));\n\t\t\t            }, 5000);\n\t\t\t          });\n\t\t\t          \n\t\t\t          const tempFilePath = await Promise.race([exportPromise, exportTimeout]);\n\t\t\t          resolve(tempFilePath);\n\t\t\t          \n\t\t\t        } catch (error) {\n\t\t\t          reject(error);\n\t\t\t        }\n\t\t\t      });\n\t\t\t  });\n\t\t\t},\n\t\t\t\n\t\t\t// ğŸ”¥ ç»§ç»­ drawMixedContent æ–¹æ³•\n\t\t\tasync drawMixedContent(ctx, canvas, contentItems, canvasWidth, canvasHeight, styleConfig) {\n\t\t\t  const box = styleConfig.textBox;\n\t\t\t  const padding = 60;\n\t\t\t  \n\t\t\t  const maxWidth = box ? box.width : canvasWidth - padding * 2;\n\t\t\t  const hAlign = box ? (box.hAlign || 'center') : 'center';\n\t\t\t  const vAlign = box ? (box.vAlign || 'middle') : 'middle';\n\t\t\t  \n\t\t\t  const lineHeight = styleConfig.fontSize * 1.4;\n\t\t\t  const emojiSize = styleConfig.fontSize * 1.1; // è¡¨æƒ…å¤§å°ç•¥å¤§äºå­—ä½“\n\t\t\t  \n\t\t\t  // ğŸ”¥ å°† contentItems è½¬æ¢ä¸ºå¯ç»˜åˆ¶çš„ segmentsï¼ˆåŒ…å«åŠ è½½çš„å›¾ç‰‡ï¼‰\n\t\t\t  const segments = await this.prepareDrawSegments(canvas, contentItems, maxWidth, styleConfig.fontSize, emojiSize, ctx);\n\t\t\t  \n\t\t\t  // è®¡ç®—æ€»é«˜åº¦\n\t\t\t  const totalHeight = segments.length * lineHeight;\n\t\t\t  \n\t\t\t  let startY;\n\t\t\t  if (box) {\n\t\t\t    if (vAlign === 'top') {\n\t\t\t      startY = box.y;\n\t\t\t    } else if (vAlign === 'bottom') {\n\t\t\t      startY = box.y + box.height - totalHeight;\n\t\t\t    } else {\n\t\t\t      startY = box.y + (box.height - totalHeight) / 2;\n\t\t\t    }\n\t\t\t  } else {\n\t\t\t    startY = (canvasHeight - totalHeight) / 2;\n\t\t\t  }\n\t\t\t  \n\t\t\t  // é«˜äº®å¤„ç†\n\t\t\t  const highlightQueries = styleConfig.highlightQueries;\n\t\t\t  const hasHighlight = Array.isArray(highlightQueries) && highlightQueries.length > 0;\n\t\t\t  const highlightColor = styleConfig.highlightColor || '#A6ECA6';\n\t\t\t  const defaultHighlightGeo = { yOffset: -0.1, height: 0.6 };\n\t\t\t  const customHighlightGeo = styleConfig.highlightGeometry;\n\t\t\t  const geo = customHighlightGeo || defaultHighlightGeo;\n\t\t\t  \n\t\t\t  // åˆ›å»ºæ²¡æœ‰è¡¨æƒ…çš„çº¯æ–‡æœ¬ç‰ˆæœ¬ç”¨äºé«˜äº®åŒ¹é…\n\t\t\t  const textWithoutEmojis = contentItems\n\t\t\t    .filter(item => item.type === 'text')\n\t\t\t    .map(item => item.content)\n\t\t\t    .join('');\n\t\t\t  \n\t\t\t  // æŸ¥æ‰¾æ‰€æœ‰é«˜äº®èŒƒå›´\n\t\t\t  const highlightRanges = [];\n\t\t\t  if (hasHighlight) {\n\t\t\t    highlightQueries.forEach(query => {\n\t\t\t      if (!query || query.trim() === '') return;\n\t\t\t      let startIndex = textWithoutEmojis.indexOf(query);\n\t\t\t      while (startIndex !== -1) {\n\t\t\t        highlightRanges.push({\n\t\t\t          start: startIndex,\n\t\t\t          end: startIndex + query.length\n\t\t\t        });\n\t\t\t        startIndex = textWithoutEmojis.indexOf(query, startIndex + 1);\n\t\t\t      }\n\t\t\t    });\n\t\t\t  }\n\t\t\t  \n\t\t\t  // ğŸ”¥ ç»˜åˆ¶æ¯ä¸€è¡Œ\n\t\t\t  let textCharIndex = 0; // è·Ÿè¸ªçº¯æ–‡æœ¬å­—ç¬¦ç´¢å¼•\n\t\t\t  \n\t\t\t  segments.forEach((line, lineIndex) => {\n\t\t\t    const y = startY + lineIndex * lineHeight + lineHeight / 2;\n\t\t\t    \n\t\t\t    // è®¡ç®—è¡Œå®½åº¦\n\t\t\t    let lineWidth = 0;\n\t\t\t    line.forEach(item => {\n\t\t\t      if (item.type === 'text') {\n\t\t\t        lineWidth += ctx.measureText(item.content).width;\n\t\t\t      } else if (item.type === 'emoji') {\n\t\t\t        lineWidth += emojiSize;\n\t\t\t      }\n\t\t\t    });\n\t\t\t    \n\t\t\t    // è®¡ç®— x èµ·å§‹ä½ç½®\n\t\t\t    let x;\n\t\t\t    if (box) {\n\t\t\t      if (hAlign === 'left') {\n\t\t\t        x = box.x;\n\t\t\t      } else if (hAlign === 'right') {\n\t\t\t        x = box.x + box.width - lineWidth;\n\t\t\t      } else {\n\t\t\t        x = box.x + (box.width - lineWidth) / 2;\n\t\t\t      }\n\t\t\t    } else {\n\t\t\t      if (hAlign === 'left') {\n\t\t\t        x = padding;\n\t\t\t      } else if (hAlign === 'right') {\n\t\t\t        x = canvasWidth - padding - lineWidth;\n\t\t\t      } else {\n\t\t\t        x = (canvasWidth - lineWidth) / 2;\n\t\t\t      }\n\t\t\t    }\n\t\t\t    \n\t\t\t    // ğŸ”¥ ç»˜åˆ¶è¡Œå†…å®¹\n\t\t\t    line.forEach(item => {\n\t\t\t      if (item.type === 'text') {\n\t\t\t        const text = item.content;\n\t\t\t        \n\t\t\t        // æ£€æŸ¥æ˜¯å¦éœ€è¦é«˜äº®\n\t\t\t        if (hasHighlight) {\n\t\t\t          for (let i = 0; i < text.length; i++) {\n\t\t\t            const currentIndex = textCharIndex + i;\n\t\t\t            const char = text[i];\n\t\t\t            const charWidth = ctx.measureText(char).width;\n\t\t\t            \n\t\t\t            // åˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦åœ¨é«˜äº®èŒƒå›´å†…\n\t\t\t            const isHighlighted = highlightRanges.some(range => \n\t\t\t              currentIndex >= range.start && currentIndex < range.end\n\t\t\t            );\n\t\t\t            \n\t\t\t            if (isHighlighted) {\n\t\t\t              // ç»˜åˆ¶é«˜äº®èƒŒæ™¯\n\t\t\t              const highlightY = y + styleConfig.fontSize * geo.yOffset;\n\t\t\t              const highlightHeight = styleConfig.fontSize * geo.height;\n\t\t\t              \n\t\t\t              ctx.save();\n\t\t\t              ctx.shadowColor = 'transparent';\n\t\t\t              ctx.shadowBlur = 0;\n\t\t\t              ctx.shadowOffsetX = 0;\n\t\t\t              ctx.shadowOffsetY = 0;\n\t\t\t              ctx.fillStyle = highlightColor;\n\t\t\t              ctx.fillRect(x, highlightY, charWidth, highlightHeight);\n\t\t\t              ctx.restore();\n\t\t\t            }\n\t\t\t            \n\t\t\t            // ç»˜åˆ¶å­—ç¬¦\n\t\t\t            ctx.fillText(char, x, y);\n\t\t\t            x += charWidth;\n\t\t\t          }\n\t\t\t        } else {\n\t\t\t          // æ— é«˜äº®ï¼Œç›´æ¥ç»˜åˆ¶\n\t\t\t          ctx.fillText(text, x, y);\n\t\t\t          x += ctx.measureText(text).width;\n\t\t\t        }\n\t\t\t        \n\t\t\t        textCharIndex += text.length;\n\t\t\t        \n\t\t\t      } else if (item.type === 'emoji' && item.image) {\n\t\t\t        // ğŸ”¥ ç»˜åˆ¶è¡¨æƒ…å›¾ç‰‡\n\t\t\t        const emojiY = y - emojiSize / 2;\n\t\t\t        ctx.drawImage(item.image, x, emojiY, emojiSize, emojiSize);\n\t\t\t        x += emojiSize;\n\t\t\t      }\n\t\t\t    });\n\t\t\t  });\n\t\t\t},\n\t\t\t\n\t\t\t\n\t\t\t// ğŸ”¥ æ–°å¢æ–¹æ³•ï¼šå‡†å¤‡ç»˜åˆ¶ç‰‡æ®µï¼ˆåŒ…å«åŠ è½½è¡¨æƒ…å›¾ç‰‡ï¼‰\n\t\t\tasync prepareDrawSegments(canvas, contentItems, maxWidth, fontSize, emojiSize, ctx) {\n\t\t\t  const lines = [];\n\t\t\t  let currentLine = [];\n\t\t\t  let currentLineWidth = 0;\n\t\t\t  \n\t\t\t  // ğŸ”¥ é¦–å…ˆåŠ è½½æ‰€æœ‰è¡¨æƒ…å›¾ç‰‡\n\t\t\t  for (let item of contentItems) {\n\t\t\t    if (item.type === 'emoji' && item.url) {\n\t\t\t      try {\n\t\t\t        item.image = await this.loadImageToCanvas(canvas, item.url);\n\t\t\t        console.log('âœ… è¡¨æƒ…å›¾ç‰‡åŠ è½½æˆåŠŸ:', item.name);\n\t\t\t      } catch (err) {\n\t\t\t        console.error('âŒ è¡¨æƒ…å›¾ç‰‡åŠ è½½å¤±è´¥:', item.name, err);\n\t\t\t        item.image = null;\n\t\t\t      }\n\t\t\t    }\n\t\t\t  }\n\t\t\t  \n\t\t\t  // ğŸ”¥ å¤„ç†æ¢è¡Œ\n\t\t\t  for (let item of contentItems) {\n\t\t\t    if (item.type === 'text') {\n\t\t\t      const text = item.content;\n\t\t\t      \n\t\t\t      for (let char of text) {\n\t\t\t        const charWidth = ctx.measureText(char).width;\n\t\t\t        \n\t\t\t        if (currentLineWidth + charWidth > maxWidth && currentLine.length > 0) {\n\t\t\t          // éœ€è¦æ¢è¡Œ\n\t\t\t          lines.push(currentLine);\n\t\t\t          currentLine = [];\n\t\t\t          currentLineWidth = 0;\n\t\t\t        }\n\t\t\t        \n\t\t\t        // åˆå¹¶ç›¸é‚»çš„æ–‡å­—\n\t\t\t        const lastItem = currentLine[currentLine.length - 1];\n\t\t\t        if (lastItem && lastItem.type === 'text') {\n\t\t\t          lastItem.content += char;\n\t\t\t        } else {\n\t\t\t          currentLine.push({\n\t\t\t            type: 'text',\n\t\t\t            content: char\n\t\t\t          });\n\t\t\t        }\n\t\t\t        \n\t\t\t        currentLineWidth += charWidth;\n\t\t\t      }\n\t\t\t      \n\t\t\t    } else if (item.type === 'emoji') {\n\t\t\t      if (currentLineWidth + emojiSize > maxWidth && currentLine.length > 0) {\n\t\t\t        // éœ€è¦æ¢è¡Œ\n\t\t\t        lines.push(currentLine);\n\t\t\t        currentLine = [];\n\t\t\t        currentLineWidth = 0;\n\t\t\t      }\n\t\t\t      \n\t\t\t      currentLine.push({\n\t\t\t        type: 'emoji',\n\t\t\t        image: item.image,\n\t\t\t        name: item.name\n\t\t\t      });\n\t\t\t      \n\t\t\t      currentLineWidth += emojiSize;\n\t\t\t    }\n\t\t\t  }\n\t\t\t  \n\t\t\t  // æ·»åŠ æœ€åä¸€è¡Œ\n\t\t\t  if (currentLine.length > 0) {\n\t\t\t    lines.push(currentLine);\n\t\t\t  }\n\t\t\t  \n\t\t\t  return lines;\n\t\t\t},\n\t\t\t\n\t\t\t// ğŸ”¥ æ–°å¢æ–¹æ³•ï¼šåŠ è½½å›¾ç‰‡åˆ° Canvas\n\t\t\tloadImageToCanvas(canvas, imageUrl) {\n\t\t\t  return new Promise((resolve, reject) => {\n\t\t\t    const img = canvas.createImage();\n\t\t\t    \n\t\t\t    img.onload = () => {\n\t\t\t      console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:', imageUrl);\n\t\t\t      resolve(img);\n\t\t\t    };\n\t\t\t    \n\t\t\t    img.onerror = (err) => {\n\t\t\t      console.error('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl, err);\n\t\t\t      reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));\n\t\t\t    };\n\t\t\t    \n\t\t\t    img.src = imageUrl;\n\t\t\t    \n\t\t\t    // è®¾ç½®è¶…æ—¶\n\t\t\t    setTimeout(() => {\n\t\t\t      reject(new Error('å›¾ç‰‡åŠ è½½è¶…æ—¶'));\n\t\t\t    }, 5000);\n\t\t\t  });\n\t\t\t},\n\t\t\t\n\t\t\t\n\t\t\t// ... (wrapText ä¿æŒä¸å˜) ...\n\t\t\t// ğŸ¨ 2. Bugä¿®å¤: ä¿®æ”¹ wrapText ä»¥æ”¯æŒ \\n æ¢è¡Œ\n\t\t\t\t\t\twrapText(ctx, text, maxWidth, fontSize) {\n\t\t\t\t\t\t\tconst lines = [];\n\t\t\t\t\t\t\tlet currentLine = '';\n\t\t\t\t\t\t\tconst words = text.split(''); // (ä¿æŒå­—ç¬¦åˆ†å‰²)\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor (let i = 0; i < words.length; i++) { //\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// (Bugä¿®å¤) æ£€æŸ¥æ˜¯å¦æ˜¯ \\n\n\t\t\t\t\t\t\t\tif (words[i] === '\\n') {\n\t\t\t\t\t\t\t\t\tlines.push(currentLine); // æ¨é€ \\n ä¹‹å‰çš„å†…å®¹\n\t\t\t\t\t\t\t\t\tcurrentLine = ''; // å¼€å§‹æ–°çš„ä¸€è¡Œ\n\t\t\t\t\t\t\t\t\tcontinue; // è·³è¿‡ \\n å­—ç¬¦\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst testLine = currentLine + words[i]; //\n\t\t\t\t\t\t\t\tconst metrics = ctx.measureText(testLine); //\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (metrics.width > maxWidth && currentLine !== '') { //\n\t\t\t\t\t\t\t\t\tlines.push(currentLine); //\n\t\t\t\t\t\t\t\t\tcurrentLine = words[i]; //\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcurrentLine = testLine; //\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (currentLine !== '') { //\n\t\t\t\t\t\t\t\tlines.push(currentLine); //\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn lines;\n\t\t\t\t\t\t},\n\t\t\t\n\t\t\t// ... (drawBackgroundImage ä¿æŒä¸å˜) ...\n\t\t\tdrawBackgroundImage(ctx, canvas, width, height, imagePath) {\n\t\t\t\tconst loadPromise = new Promise((resolve, reject) => {\n\t\t\t\t\tconst image = canvas.createImage();\n\t\t\t\t\t\n\t\t\t\t\timage.onload = () => {\n\t\t\t\t\t\tctx.drawImage(image, 0, 0, width, height);\n\t\t\t\t\t\tconsole.log('âœ… èƒŒæ™¯å›¾ç‰‡ç»˜åˆ¶æˆåŠŸ');\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\timage.onerror = (err) => {\n\t\t\t\t\t\tconsole.error('âŒ åŠ è½½èƒŒæ™¯å›¾ç‰‡å¤±è´¥:', err);\n\t\t\t\t\t\treject(new Error('åŠ è½½èƒŒæ™¯å›¾ç‰‡å¤±è´¥'));\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\timage.src = imagePath;\n\t\t\t\t\tconsole.log('ğŸ“· å¼€å§‹åŠ è½½èƒŒæ™¯å›¾ç‰‡:', imagePath);\n\t\t\t\t});\n\n\t\t\t\tconst timeoutPromise = new Promise((_, reject) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconsole.error(`âŒ åŠ è½½èƒŒæ™¯å›¾ç‰‡è¶…æ—¶: ${imagePath}`);\n\t\t\t\t\t\treject(new Error('èƒŒæ™¯å›¾ç‰‡åŠ è½½è¶…æ—¶'));\n\t\t\t\t\t}, 10000);\n\t\t\t\t});\n\n\t\t\t\treturn Promise.race([loadPromise, timeoutPromise]);\n\t\t\t},\n\t\t\t\n\t\t\t// ... (uploadToOSS ä¿æŒä¸å˜, å·²åŒ…å«å‹ç¼©) ...\n\t\t\tasync uploadToOSS(originalTempFilePath) {\n\t\t\t\ttry {\n\t\t\t\t\tconsole.log('ğŸ“¤ å¼€å§‹ä¸Šä¼ å›¾ç‰‡åˆ° OSS...');\n\n\t\t\t\t\tconsole.log('â³ æ­£åœ¨å‹ç¼©å›¾ç‰‡ (quality: 80)...');\n\t\t\t\t\tconst compressedFile = await new Promise((resolve, reject) => {\n\t\t\t\t\t\tuni.compressImage({\n\t\t\t\t\t\t\tsrc: originalTempFilePath, \n\t\t\t\t\t\t\tquality: 80, \n\t\t\t\t\t\t\tsuccess: resolve,\n\t\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\t\tconsole.error('âŒ å›¾ç‰‡å‹ç¼©å¤±è´¥:', err);\n\t\t\t\t\t\t\t\treject(new Error('å›¾ç‰‡å‹ç¼©å¤±è´¥'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tconst tempFilePath = compressedFile.tempFilePath;\n\t\t\t\t\tconsole.log(`âœ… å‹ç¼©å®Œæˆ, æ–°è·¯å¾„: ${tempFilePath}`);\n\n\t\t\t\t\t\n\t\t\t\t\tconst { data: tokenRes } = await uni.$http.get('/upload/token', {\n\t\t\t\t\t\topenid: this.openid,\n\t\t\t\t\t\tfileType: 'image'\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (tokenRes.meta.status !== 200) {\n\t\t\t\t\t\tthrow new Error('è·å–ä¸Šä¼ å‡­è¯å¤±è´¥');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst uploadUrl = tokenRes.message.uploadUrl;\n\t\t\t\t\tconst publicUrl = tokenRes.message.publicUrl;\n\t\t\t\t\t\n\t\t\t\t\tconst fileContent = await new Promise((resolve, reject) => {\n\t\t\t\t\t\tuni.getFileSystemManager().readFile({\n\t\t\t\t\t\t\tfilePath: tempFilePath, \n\t\t\t\t\t\t\tencoding: 'base64',\n\t\t\t\t\t\t\tsuccess: (res) => resolve(res.data),\n\t\t\t\t\t\t\tfail: reject\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tawait new Promise((resolve, reject) => {\n\t\t\t\t\t\tuni.getFileInfo({\n\t\t\t\t\t\t\tfilePath: tempFilePath, \n\t\t\t\t\t\t\tsuccess: (fileInfo) => {\n\t\t\t\t\t\t\t\tconsole.log(` compressed file size: ${(fileInfo.size / 1024).toFixed(2)} KB`);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tuni.request({\n\t\t\t\t\t\t\t\t\turl: publicUrl,\n\t\t\t\t\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\t\t\t\t\theader: { 'Content-Type': 'application/octet-stream' },\n\t\t\t\t\t\t\t\t\tdata: uni.base64ToArrayBuffer(fileContent),\n\t\t\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\t\t\tif (res.statusCode === 200) resolve(res);\n\t\t\t\t\t\t\t\t\t\telse reject(new Error(`ä¸Šä¼ å¤±è´¥: ${res.statusCode}`));\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfail: reject\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail: reject\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tthis.generatedImageUrl = publicUrl;\n\t\t\t\t\tconsole.log('âœ… å›¾ç‰‡ä¸Šä¼ åˆ° OSS å®Œæˆ:', publicUrl);\n\t\t\t\t\t\n\t\t\t\t\treturn publicUrl;\n\t\t\t\t\t\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('âŒ ä¸Šä¼ å¤±è´¥:', error);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// ... (confirmSelection, uploadAndNavigate, goBack ä¿æŒä¸å˜) ...\n\t\t\tasync confirmSelection() {\n\t\t\t\tif (!this.tempImagePath || this.isGenerating || this.isUploading) {\n\t\t\t\t  return;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.uploadAndNavigate();\n\t\t\t},\n\t\t\t  \n\t\t\t// ğŸ”¥ ä¿®æ”¹ï¼šuploadAndNavigate æ–¹æ³•ï¼Œä¼ é€’å›¾ç‰‡æ•°æ®\r\n\t\t\t    async uploadAndNavigate() {\r\n\t\t\t      this.isUploading = true;\r\n\t\t\t      \r\n\t\t\t      try {\r\n\t\t\t        const ossUrl = await this.uploadToOSS(this.tempImagePath);\r\n\t\t\t        \r\n\t\t\t        uni.showToast({\r\n\t\t\t          title: 'ä¸Šä¼ æˆåŠŸ',\r\n\t\t\t          icon: 'success',\r\n\t\t\t          duration: 1500\r\n\t\t\t        });\r\n\t\t\t        \r\n\t\t\t        setTimeout(() => {\r\n\t\t\t          // ğŸ”¥ ä¿®æ”¹ï¼šå°†ç”Ÿæˆçš„èƒŒæ™¯å›¾å’ŒåŸæœ‰å›¾ç‰‡ä¸€èµ·ä¼ é€’\r\n\t\t\t          const allImages = [ossUrl, ...this.existingImages];\r\n\t\t\t          \r\n\t\t\t          console.log('ğŸ“¤ ä¼ é€’åˆ° publish-post çš„å›¾ç‰‡:', allImages);\r\n\t\t\t          \r\n\t\t\t          uni.navigateTo({\r\n\t\t\t            url: '/subpkg/publish-post/publish-post',\r\n\t\t\t            success: (res) => {\r\n\t\t\t              res.eventChannel.emit('topicImageData', {\r\n\t\t\t                imageUrl: ossUrl, // ç”Ÿæˆçš„èƒŒæ™¯å›¾ï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰\r\n\t\t\t                images: allImages, // ğŸ”¥ æ–°å¢ï¼šæ‰€æœ‰å›¾ç‰‡æ•°ç»„ï¼ˆèƒŒæ™¯å›¾ + topic å›¾ç‰‡ï¼‰\r\n\t\t\t                content: this.contentText,\r\n\t\t\t                isTopic: this.isTopic\r\n\t\t\t              });\r\n\t\t\t            }\r\n\t\t\t          });\r\n\t\t\t        }, 1500);\r\n\t\t\t        \r\n\t\t\t      } catch (error) {\r\n\t\t\t        console.error('âŒ ä¸Šä¼ å¤±è´¥:', error);\r\n\t\t\t        uni.showToast({\r\n\t\t\t          title: error.message || 'ä¸Šä¼ å¤±è´¥,è¯·é‡è¯•',\r\n\t\t\t          icon: 'none',\r\n\t\t\t          duration: 2000\r\n\t\t\t        });\r\n\t\t\t      } finally {\r\n\t\t\t        this.isUploading = false;\r\n\t\t\t      }\r\n\t\t\t    },\n\t\t\t  \n\t\t\tgoBack() {\n\t\t\t\tuni.navigateBack();\n\t\t\t}\n\t\t\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n// ... ( .text-to-image-page, .image-preview-container ä¿æŒä¸å˜) ...\n.text-to-image-page {\n\tmin-height: 100vh;\n\tbackground-color: #ffffff;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.image-preview-container {\n\tflex: 1;\n\twidth: 100%;\n\tbackground-color: #f8f8f8;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 32rpx;\n\tmin-height: 600rpx;\n\tbox-sizing: border-box;\n\t\n\t.loading-container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\t\n\t\t.loading-spinner {\n\t\t\twidth: 60rpx;\n\t\t\theight: 60rpx;\n\t\t\tborder: 4rpx solid rgba(192, 0, 0, 0.1);\n\t\t\tborder-top: 4rpx solid #C00000;\n\t\t\tborder-radius: 50%;\n\t\t\tanimation: spin 1s linear infinite;\n\t\t}\n\t\t\n\t\t.loading-text {\n\t\t\tmargin-top: 24rpx;\n\t\t\tfont-size: 26rpx;\n\t\t\tcolor: #999999;\n\t\t}\n\t}\n\t\n\t.preview-image-wrapper {\n\t  width: 686rpx;\n\t  max-width: 100%;\n\t  background-color: #ffffff;\n\t  border-radius: 24rpx;\n\t  box-shadow: 0 12rpx 48rpx rgba(0, 0, 0, 0.15);\n\t  overflow: hidden;\n\t  position: relative;\n\t  left: 50%;\n\t  transform: translateX(-50%);\n\t  \n\t  .preview-image {\n\t    width: 100%;\n\t    height: auto;\n\t    display: block;\n\t    vertical-align: top;\n\t  }\n\t  \n\t}\n\t\n\t.empty-preview {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 16rpx;\n\t\t\n\t\t.empty-icon {\n\t\t\tfont-size: 120rpx;\n\t\t\tmargin-bottom: 16rpx;\n\t\t\topacity: 0.3;\n\t\t}\n\t\t\n\t\t.empty-text {\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #999999;\n\t\t}\n\t\t\n\t\t.empty-hint {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #cccccc;\n\t\t}\n\t}\n}\n\n// ğŸ¨ 7. <style> ä¿®æ”¹:\n// (é‡å†™æ ·å¼ï¼Œç§»é™¤ .highlight-status, å°† .button-group å±…ä¸­)\n.highlight-toolbar-container {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center; // (ä¿®æ”¹) æ”¹ä¸º center\n\tpadding: 20rpx 32rpx;\n\tbackground-color: #ffffff;\n\tborder-top: 1rpx solid #f0f0f0;\n\tgap: 16rpx;\n\t\n\t// (ç§»é™¤) .highlight-status æ ·å¼\n\t\n\t.button-group {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 16rpx;\n\t\t// (ç§»é™¤) flex-shrink: 0 (ä¸å†éœ€è¦ï¼Œå› ä¸ºçˆ¶çº§æ˜¯ center)\n\t}\n\t\n\t.highlight-action-btn {\n\t\tpadding: 10rpx 24rpx;\n\t\tborder-radius: 30rpx;\n\t\t\n\t\ttext {\n\t\t   font-size: 24rpx;\n\t\t   font-weight: 500;\n\t\t}\n\t\t\n\t\t&.add-more {\n\t\t\tbackground-color: #f5f5f5;\n\t\t\tborder: 1rpx solid #e0e0e0;\n\t\t\t\n\t\t\ttext {\n\t\t\t\tcolor: #333;\n\t\t\t}\n\t\t\t\n\t\t\t&:active {\n\t\t\t\tbackground-color: #e0e0e0;\n\t\t\t}\n\t\t}\n\t\t\n\t\t&.clear {\n\t\t\tbackground-color: #fef0f0;\n\t\t\tborder: 1rpx solid #fde2e2;\n\t\t\t\n\t\t\ttext {\n\t\t\t\tcolor: #C00000;\n\t\t\t}\n\t\t\t\n\t\t\t&:active {\n\t\t\t\tbackground-color: #fde2e2;\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n.font-slider-container {\n// ... (æ»‘å—æ ·å¼ ä¿æŒä¸å˜) ...\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 10rpx 32rpx 20rpx;\n\tbackground-color: #ffffff;\n\tborder-top: 1rpx solid #f0f0f0;\n\tgap: 24rpx;\n\t\n\t.slider-label {\n\t\tfont-size: 26rpx;\n\t\tcolor: #666;\n\t\tflex-shrink: 0; \n\t}\n\t\n\t.font-slider {\n\t\tflex: 1;\n\t\tmargin: 0;\n\t}\n\t\n\t.font-change-button {\n\t\tflex-shrink: 0; \n\t\tpadding: 10rpx 24rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tborder: 1rpx solid #e0e0e0;\n\t\tborder-radius: 30rpx;\n\t\t\n\t\ttext {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #333;\n\t\t\tfont-weight: 500;\n\t\t}\n\t\t\n\t\t&:active {\n\t\t\tbackground-color: #e0e0e0;\n\t\t}\n\t}\n}\n\n\n.bg-selector-section {\n\t// ... (èƒŒæ™¯é€‰æ‹©æ ·å¼ ä¿æŒä¸å˜) ...\n\tbackground-color: #ffffff;\n\tpadding: 32rpx 0 24rpx;\n\tborder-top: 1rpx solid #f0f0f0;\n\tposition: relative;\n\tz-index: 10;\n\tflex-shrink: 0;\n\t\n\t.selector-title {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tcolor: #333333;\n\t\tfont-weight: 500;\n\t\tpadding: 0 32rpx;\n\t\tmargin-bottom: 24rpx;\n\t}\n\t\n\t.bg-image-list {\n\t\twhite-space: nowrap;\n\t\tpadding: 0 32rpx;\n\t\t\n\t\t.bg-image-item {\n\t\t\tdisplay: inline-block;\n\t\t\tmargin-right: 20rpx;\n\t\t\tposition: relative;\n\t\t\tvertical-align: top;\n\t\t\t\n\t\t\t&:last-child {\n\t\t\t\tmargin-right: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.bg-thumbnail {\n\t\t\t\twidth: 160rpx;\n\t\t\t\theight: 200rpx;\n\t\t\t\tborder-radius: 16rpx;\n\t\t\t\tborder: 3rpx solid transparent;\n\t\t\t\ttransition: all 0.3s;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t\t\n\t\t\t.bg-name-wrapper {\n\t\t\t\tmargin-top: 12rpx;\n\t\t\t\ttext-align: center;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tgap: 4rpx;\n\t\t\t\t\n\t\t\t\t.bg-name {\n\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\tcolor: #666666;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\tmax-width: 160rpx;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t.selected-badge {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 12rpx;\n\t\t\t\tright: 12rpx;\n\t\t\t\twidth: 40rpx;\n\t\t\t\theight: 40rpx;\n\t\t\t\tbackground: linear-gradient(135deg, #C00000 0%, #ff6b6b 100%);\n\t\t\t\tborder-radius: 50%;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(192, 0, 0, 0.4);\n\t\t\t\tz-index: 2;\n\t\t\t\t\n\t\t\t\t.badge-icon {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #ffffff;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.change-style-btn {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\twidth: 72rpx;\n\t\t\t\theight: 72rpx;\n\t\t\t\tbackground: rgba(0, 0, 0, 0.7);\n\t\t\t\tbackdrop-filter: blur(10rpx);\n\t\t\t\tborder-radius: 50%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tgap: 4rpx;\n\t\t\t\tbox-shadow: 0 6rpx 20rpx rgba(0, 0, 0, 0.4);\n\t\t\t\tz-index: 3;\n\t\t\t\ttransition: all 0.3s;\n\t\t\t\tborder: 2rpx solid rgba(255, 255, 255, 0.3);\n\t\t\t\t\n\t\t\t\t&:active {\n\t\t\t\t\ttransform: translate(-50%, -50%) scale(0.9);\n\t\t\t\t\tbackground: rgba(0, 0, 0, 0.85);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.change-icon {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t&.active {\n\t\t\t\t.bg-thumbnail {\n\t\t\t\t\tborder-color: #C00000;\n\t\t\t\t\tbox-shadow: 0 8rpx 24rpx rgba(192, 0, 0, 0.3);\n\t\t\t\t\ttransform: scale(1.05);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.bg-name {\n\t\t\t\t\tcolor: #C00000;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n}\n\n\t\t\t\t\t\n.bottom-actions {\n  // ... (åº•éƒ¨æŒ‰é’® ä¿æŒä¸å˜) ...\n  display: flex;\n  gap: 16rpx;\n  padding: 24rpx 32rpx 48rpx;\n  background-color: #ffffff;\n  border-top: 1rpx solid #f0f0f0;\n  flex-shrink: 0;\n  \n  .action-btn {\n\tflex: 1;\n\theight: 88rpx;\n\tborder-radius: 44rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 32rpx;\n\tfont-weight: 500;\n\ttransition: all 0.3s;\n\t\n\ttext-align: center;\n\t\n\t&.cancel {\n\t  background-color: #f5f5ff;\n\t  \n\t  text {\n\t\tcolor: #666666;\n\t  }\n\t  \n\t  &:active {\n\t\tbackground-color: #e8e8e8;\n\t  }\n\t}\n\t\n\t&.drawing-toggle {\n\t  background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);\n\t  box-shadow: 0 6rpx 20rpx rgba(255, 215, 0, 0.3);\n\t  \n\t  text {\n\t\tcolor: #ffffff;\n\t  }\n\t  \n\t  &:active {\n\t\ttransform: scale(0.98);\n\t  }\n\t}\n\t\n\t&.confirm {\n\t  background: linear-gradient(135deg, #C00000 0%, #ff6b6b 100%);\n\t  box-shadow: 0 8rpx 24rpx rgba(192, 0, 0, 0.3);\n\t  \n\t  text {\n\t\tcolor: #ffffff;\n\t  }\n\t  \n\t  &:not(.disabled):active {\n\t\ttransform: scale(0.98);\n\t\tbox-shadow: 0 4rpx 12rpx rgba(192, 0, 0, 0.4);\n\t  }\n\t  \n\t  &.disabled {\n\t\topacity: 0.5;\n\t\tbackground: linear-gradient(135deg, #cccccc 0%, #999999 100%);\n\t\tbox-shadow: none;\n\t  }\n\t}\n  }\n}\n\t\t\t\t\t\n@keyframes spin {\n\t0% {\n\t\ttransform: rotate(0deg);\n\t}\n\t100% {\n\t\ttransform: rotate(360deg);\n\t}\n}\n</style>","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1762677684075\n      var cssReload = require(\"D:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}