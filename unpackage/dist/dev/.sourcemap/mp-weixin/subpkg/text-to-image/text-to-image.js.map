{"version":3,"sources":["uni-app:///main.js",null,"webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?73bf","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?9016","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?17f9","uni-app:///subpkg/text-to-image/text-to-image.vue","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?1c3b","webpack:///D:/HBuilderX.4.76.2025082103/HBuilderX/project/shopping/subpkg/text-to-image/text-to-image.vue?1351"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","contentItems","contentText","selectedCategoryIndex","tempImagePath","generatedImageUrl","isGenerating","isUploading","isTopic","highlightQueries","backgroundCategories","fontLibrary","loadedFontFamilies","initialFontSize","currentFontSize","minFontSize","sliderDebounceTimer","isFirstLoad","existingImages","showTextEditor","editingText","showSelector","selectorType","computed","currentStyle","currentFontList","name","currentFontIndex","currentCategoryStyles","currentStyleIndex","currentBackground","path","textBox","fontConfig","family","weight","style","url","textColor","highlightColor","highlightGeometry","onLoad","uni","type","content","category","methods","openSelector","preloadFontsForList","source","global","success","fail","console","closeSelector","handleOptionSelect","title","icon","openTextEditor","closeTextEditor","confirmTextEdit","convertContentItemsToText","showHighlightPrompt","showCancel","confirmText","confirmColor","filter","map","join","editable","placeholderText","clearHighlight","handleSelectCategory","selectCategory","handleSliderChange","getCanvasContext","query","fields","node","size","exec","reject","resolve","doesTextFit","ctx","calculateMaxFontSize","padding","maxWidth","maxHeight","bestFit","low","i","mid","high","loadCustomFont","fontFamilyName","mask","complete","Promise","generateImage","newFontSize","canvasWidth","fontSize","newMaxFontSize","enableShadow","tempFilePath","drawTextOnBackground","canvas","dpr","fontWeight","drawMixedContent","box","lineHeight","emojiSize","segments","totalHeight","vAlign","startY","hasHighlight","textWithoutEmojis","highlightRanges","start","end","idx","textCharIndex","line","x","text","yOffset","height","prepareDrawSegments","lines","currentLine","currentLineWidth","item","char","charWidth","last","image","loadImageToCanvas","img","wrapText","drawBackgroundImage","uploadToOSS","filePath","openid","fileType","tokenRes","encoding","fileContent","method","header","duration","confirmSelection","ossUrl","res","imageUrl","images","goBack"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsI;AACtI;AACiE;AACL;AACsC;;;AAGlG;AACyJ;AACzJ,gBAAgB,mKAAU;AAC1B,EAAE,mFAAM;AACR,EAAE,oGAAM;AACR,EAAE,6GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,wGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAwjB,CAAgB,qkBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;AC4M5kB;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAEA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEAC;MAEAC;MACAC;MACAC;MAEAC;MACAC;MACAC;MACAC;MAEAC;MACAC;MAEA;MACAC;MACAC;MAEA;MACAC;MACAC;IACA;EACA;;EAEAC,0CACA;IAEAC;MACA;MACA;MACA;IACA;IAEAC;MAAA;MACA;QACA;MACA;MACA;QACA;QACA;UACA;YAAAC;UAAA;QACA;QACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MAEA;MACA;MAEA;MACA;MAEA;MACA;MAEA;QACAC;QACAL;QACAM;QACAC;UACAC;UACAC;UACAC;UACAC;QACA;QACAC;QACAC;QACAC;MACA;IACA;EAAA,EACA;EAEAC;IAAA;IACA;MACA;MACA;QACA;QACA;QACAC;MACA;QACA;QACA;UAAAC;UAAAC;QAAA;MACA;IACA;MACA;QACA;QACA;UAAAD;UAAAC;QAAA;MACA;IACA;IAEA;MACA;QACA;QACA;MACA;IACA;IAEA;IAEA;MACA;MACAC;QACA;UACA;QACA;MACA;IACA;IAEA;MACA;IACA;EACA;EAEAC,yCACA;IAEA;IACAC;MACA;MACA;;MAEA;MACA;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MAEA;QACA;QACA;UACA;QACA;QAEAN;UACAR;UACAe;UACAC;UACAC;YACA;YACA;YACA;UACA;UACAC;YACAC;UACA;QACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MAEA;QACA;QACA;QAEA;QACA;QACA;QAEA;QACAb;UAAAc;UAAAC;QAAA;MAEA;QACA;QACA;QACA;QAEAZ;QACA;QAEA;QACAH;UAAAc;UAAAC;QAAA;MACA;MAEA;IACA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MAAA;MACA;QACAlB;UAAAc;UAAAC;QAAA;QACA;MACA;MACA;MACA;QAAAd;QAAAC;MAAA;MAEA;QACA;UAAA;QAAA;QACA;UACAF;YAAAc;YAAAC;UAAA;QACA;QACA;MACA;MAEA;MACA;MACA;IACA;IACA;IAEAI;MACA;QAAA;MAAA;IACA;IAEAC;MAAA;MACA;MACA;QAAA;MAAA;;MAEA;MACA;QACA;UACA;UACA;UACA;QACA;QACA;MACA;MAEA;QACApB;UACAc;UACAZ;UACAmB;UACAC;UACAC;QACA;QACA;MACA;MAEA,0CACAC;QAAA;MAAA,GACAC;QAAA;MAAA,GACAC;MAEA1B;QACAc;QACAa;QACAC;QACAnB;UACA;YACA;YACA;YAEA;cACAT;gBACAc;gBACAZ;gBACAmB;cACA;cACA;YACA;YAEA;YAEA;YACA;UACA;QACA;MACA;IACA;IAEAQ;MAAA;MACA;QACA7B;UACAc;UAAAZ;UACAO;YACA;cACA;cACA;YACA;UACA;QACA;MACA;IACA;IAEAqB;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MAAA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IAEAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,iCACA;kBACA;kBACAC,4BACAC;oBAAAC;oBAAAC;kBAAA,GACAC;oBACA;sBACAC;sBACA;oBACA;oBACAC;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAC;MACA;MACA;MACAC;MACA;MACA;MACA;IACA;IAEAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBACAC;gBACAC;gBAAA;gBAAA,OACA;cAAA;gBAAAJ;gBAEAK;gBACAC;gBAEAC;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;gBAAA,MACAD;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAE;gBAAA,MACAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;kBACAH;kBACAC;gBACA;kBACAG;gBACA;cAAA;gBATAF;gBAAA;gBAAA;cAAA;gBAAA,kCAWAF;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAK;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAC;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEArD;kBAAAc;kBAAAwC;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;kBACAtD;oBACAR;oBACAe;oBACAE;sBAAA;sBAAA+B;oBAAA;oBACA9B;sBAAA;sBAAA8B;oBAAA;oBACAe;sBAAA;oBAAA;kBACA;gBACA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBACAvD;cAAA;gBAAA,kCACAwD;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAC;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;gBAAA;gBAGAC;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAA,KAGAD;kBAAA;kBAAA;gBAAA;gBACAE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,OAEA,6BACA,uDACA,wEACA;cAAA;gBAHAC;gBAIA;gBACAD;gBACA;gBACA;cAAA;gBAAA;gBAAA,OAGA,6BACA,sDACA;kBACAA;kBACAhE;kBACAkE;kBACAvE;kBACAM;kBACAP;kBACAQ;kBACA/B;gBACA,EACA;cAAA;gBAZAgG;gBAaA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEApD;gBACAX;kBAAAc;kBAAAC;gBAAA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAiD;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,kCACA;kBACA;kBACA9B;oBAAAE;oBAAAC;kBAAA;oBAAA;sBAAA;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA,MACA;gCAAA;gCAAA;8BAAA;8BAAAE;8BAAA;4BAAA;8BACA0B;8BACAvB;8BACAwB;8BACAD;8BAAAA;8BACAvB;8BAAA;8BAAA;8BAAA,OAGA;4BAAA;8BAEAnD;8BACA4E;8BACAzB;8BACAA;8BACAA;8BAEA;gCACAA;gCAAAA;gCAAAA;gCAAAA;8BACA;8BAAA;8BAAA,OAEA;4BAAA;8BAEA1C;gCACAiE;gCACAxD;kCAAA;gCAAA;gCACAC;kCAAA;gCAAA;8BACA;8BAAA;8BAAA;4BAAA;8BAAA;8BAAA;8BACA6B;4BAAA;4BAAA;8BAAA;0BAAA;wBAAA;sBAAA;oBAAA,CACA;oBAAA;sBAAA;oBAAA;kBAAA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA6B;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBACAzB;gBACAC;gBACAyB;gBACAC;gBAAA;gBAAA,OAEA;cAAA;gBAAAC;gBACAC;gBAGA;kBACAC;kBACA,0CACA,wEACAC;gBACA;kBACAA;gBACA;gBAEA5G;gBACA6G;gBACAC;kBAAA;gBAAA;kBAAA;gBAAA;gBACAC;gBACA;kBACA/G;oBACA;oBACA;oBACA;sBACA+G;wBAAAC;wBAAAC;sBAAA;sBACAC;oBACA;kBACA;gBACA;gBAEAC;gBACAV;kBACA;kBACA;kBACAW;oBAAA;kBAAA;kBAEA;kBACA;oBACA;oBACA,sCACA,+DACAC;kBACA;oBACAA;kBACA;kBAEAD;oBACA;sBACA;sBACA;wBAAA,2CACAE;0BAAA;wBAAA;0BAAA;4BAAA;4BACA;4BACA;8BAAA;4BAAA;4BACA;8BACA3C;8BACAA;8BAAAA;8BACA;gCAAA4C;gCAAAC;8BAAA;8BACA7C;8BACAA;4BACA;4BACAA;4BACA0C;4BACAF;0BACA;wBAAA;0BAAA;wBAAA;0BAAA;wBAAA;sBACA;wBACAxC;wBACA0C;wBACAF;sBACA;oBACA;sBACAxC;sBACA0C;oBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAI;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBAAAC;gBAAAC;gBAAA,wCACApI;gBAAA;gBAAA;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;gBAAAqI;gBAAA,MACAA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OACA;cAAA;gBAAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA;cAAA;gBAAA,wCAGArI;gBAAA;kBAAA;oBAAAqI;oBACA;sBAAA,wCACAA;sBAAA;wBAAA;0BAAAC;0BACAC;0BACA;4BACAL;4BAAAC;4BAAAC;0BACA;0BACAI;0BACA,4DACAL;4BAAAzF;4BAAAC;0BAAA;0BACAyF;wBACA;sBAAA;wBAAA;sBAAA;wBAAA;sBAAA;oBACA;sBACA;wBACAF;wBAAAC;wBAAAC;sBACA;sBACAD;wBAAAzF;wBAAA+F;sBAAA;sBACAL;oBACA;kBACA;gBAAA;kBAAA;gBAAA;kBAAA;gBAAA;gBACA;gBAAA,kCACAF;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAQ;MACA;QACA;QACAC;UAAA;QAAA;QAAAA;QAAAA;MACA;IACA;IAEAC;MACA;MAAA;MAAA,4CACAd;QAAA;MAAA;QAAA;UAAA;UACA;YAAAI;YAAAN;YAAA;UAAA;UACA;YAAAM;YAAAN;UAAA,OACAA;QACA;MAAA;QAAA;MAAA;QAAA;MAAA;MACA;MACA;IACA;IAEAiB;MACA;QACA;QACAF;UAAAxD;UAAAF;QAAA;QACA0D;QACAA;MACA;IACA;IAEAG;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACAC;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAGAtG;kBACAc;kBACAwC;gBACA;gBAAA;gBAAA;gBAAA,OAIAtD;kBACAuG;kBACAC;gBACA;cAAA;gBAAA;gBAHAC;gBAAA,MAKAA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAAA;gBAAA,OAIA;kBACAzG;oBACAsG;oBACAI;oBACAjG;sBAAA;oBAAA;oBACAC;sBAAA;oBAAA;kBACA;gBACA;cAAA;gBAPAiG;gBAAA;gBAAA,OAUA;kBACA3G;oBACAL;oBACAiH;oBACAC;sBACA;oBACA;oBACAvJ;oBACAmD;sBACA;wBACA+B;sBACA;wBACAD;sBACA;oBACA;oBACA7B;sBAAA;oBAAA;kBACA;gBACA;cAAA;gBAEAV;;gBAEA;gBAAA,kCACAyG;cAAA;gBAAA;gBAAA;gBAGA9F;gBACAX;;gBAEA;gBACAA;kBACAc;kBACAC;kBACA+F;gBACA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IAEAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAC;gBACAhH;kBACAL;kBACAc;oBACAwG;sBACAC;sBAAAC;sBACAjH;sBAAApC;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBACAkC;kBAAAc;kBAAAC;gBAAA;cAAA;gBAAA;gBACA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAqG;MAAApH;IAAA;EAAA;AAEA;AAAA,2B;;;;;;;;;;;;;ACj6BA;AAAA;AAAA;AAAA;AAAmlC,CAAgB,oiCAAG,EAAC,C;;;;;;;;;;;ACAvmC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"subpkg/text-to-image/text-to-image.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpkg/text-to-image/text-to-image.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./text-to-image.vue?vue&type=template&id=3f3b62ce&scoped=true&\"\nvar renderjs\nimport script from \"./text-to-image.vue?vue&type=script&lang=js&\"\nexport * from \"./text-to-image.vue?vue&type=script&lang=js&\"\nimport style0 from \"./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f3b62ce\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpkg/text-to-image/text-to-image.vue\"\nexport default component.exports","export * from \"-!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=template&id=3f3b62ce&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.tempImagePath && !_vm.isGenerating && _vm.highlightQueries.length > 0\n  var g1 =\n    _vm.tempImagePath && !_vm.isGenerating ? _vm.currentFontList.length : null\n  var l0 = _vm.__map(_vm.backgroundCategories, function (bg, index) {\n    var $orig = _vm.__get_orig(bg)\n    var g2 = _vm.selectedCategoryIndex === index && bg.styles.length > 1\n    return {\n      $orig: $orig,\n      g2: g2,\n    }\n  })\n  var g3 =\n    _vm.tempImagePath && !_vm.isGenerating ? _vm.highlightQueries.length : null\n  var g4 = _vm.showTextEditor ? _vm.editingText.length : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        l0: l0,\n        g3: g3,\n        g4: g4,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"text-to-image-page\">\n\t\t<canvas \n\t\t\tid=\"textCanvas\" \n\t\t\ttype=\"2d\" \n\t\t\tstyle=\"width: 750px; height: 1000px; position: fixed; left: -9999px;\"\n\t\t></canvas>\n\t\t\n\t\t<view class=\"image-preview-container\">\n\t\t\t<view class=\"loading-container\" v-if=\"isGenerating\">\n\t\t\t\t<view class=\"loading-spinner\"></view>\n\t\t\t\t<text class=\"loading-text\">æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"preview-image-wrapper\" \n\t\t\t\tv-else-if=\"tempImagePath\"\n\t\t\t>\n\t\t\t\t<image \n\t\t\t\t  id=\"previewImage\"\n\t\t\t\t  class=\"preview-image\" \n\t\t\t\t  :src=\"tempImagePath\" \n\t\t\t\t  mode=\"widthFix\"\n\t\t\t\t></image>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"empty-preview\" v-else>\n\t\t\t\t<text class=\"empty-icon\">ğŸ¨</text>\n\t\t\t\t<text class=\"empty-text\">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡ç”Ÿæˆé¢„è§ˆ</text>\n\t\t\t\t<text class=\"empty-hint\">å‘ä¸‹æ»‘åŠ¨é€‰æ‹©èƒŒæ™¯é£æ ¼</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"highlight-toolbar-container\" v-if=\"tempImagePath && !isGenerating && highlightQueries.length > 0\">\n\t\t\t<view class=\"button-group\">\n\t\t\t\t<view class=\"highlight-action-btn add-more\" @click=\"showHighlightPrompt\">\n\t\t\t\t\t<text>ç»§ç»­æ·»åŠ </text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"highlight-action-btn clear\" @click=\"clearHighlight\">\n\t\t\t\t\t<text>æ¸…é™¤</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"font-slider-container\" v-if=\"tempImagePath && !isGenerating\">\n\t\t\t<text class=\"slider-label\">å­—å·:</text>\n\t\t\t<slider\n\t\t\t\tclass=\"font-slider\"\n\t\t\t\t:value=\"currentFontSize\"\n\t\t\t\t:min=\"minFontSize\"\n\t\t\t\t:max=\"initialFontSize\"\n\t\t\t\t@changing=\"handleSliderChange\" \n\t\t\t\tblock-size=\"20\"\n\t\t\t\tactiveColor=\"#C00000\"\n\t\t\t\tbackgroundColor=\"#f0f0f0\"\n\t\t\t/>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"font-change-button\" \n\t\t\t\tv-if=\"currentFontList.length > 1\" \n\t\t\t\t@click=\"openSelector('font')\"\n\t\t\t>\n\t\t\t\t<text>æ¢å­—ä½“</text>\n\t\t\t</view>\n\n\t\t\t<view class=\"font-change-button edit-btn\" @click=\"openTextEditor\">\n\t\t\t\t<text>æ”¹æ–‡æ¡ˆ</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"bg-selector-section\">\n\t\t\t<text class=\"selector-title\">é€‰æ‹©èƒŒæ™¯é£æ ¼</text>\n\t\t\t<scroll-view class=\"bg-image-list\" scroll-x show-scrollbar=\"false\">\n\t\t\t\t<view \n\t\t\t\t\tclass=\"bg-image-item\"\n\t\t\t\t\tv-for=\"(bg, index) in backgroundCategories\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"{ \n\t\t\t\t\t\t'active': selectedCategoryIndex === index,\n\t\t\t\t\t\t'disabled': isGenerating\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"handleSelectCategory(index)\"\n\t\t\t\t>\n\t\t\t\t\t<image \n\t\t\t\t\t\tclass=\"bg-thumbnail\" \n\t\t\t\t\t\t:src=\"bg.currentStyle.path\" \n\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t></image>\n\t\t\t\t\t<view class=\"bg-name-wrapper\">\n\t\t\t\t\t\t<text class=\"bg-name\">{{ bg.name }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"selected-badge\" v-if=\"selectedCategoryIndex === index\">\n\t\t\t\t\t\t<text class=\"badge-icon\">âœ“</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"change-style-btn\" \n\t\t\t\t\t\tv-if=\"selectedCategoryIndex === index && bg.styles.length > 1\"\n\t\t\t\t\t\t@click.stop=\"openSelector('style')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<text class=\"change-icon\">â‹®</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<view class=\"bottom-actions\">\n\t\t\t<view class=\"action-btn cancel\" @click=\"goBack\">\n\t\t\t\t<text>å–æ¶ˆ</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"action-btn drawing-toggle\" \n\t\t\t\t@click=\"showHighlightPrompt\"\n\t\t\t\tv-if=\"tempImagePath && !isGenerating\"\n\t\t\t>\n\t\t\t\t<text>{{ highlightQueries.length > 0 ? 'ç»§ç»­æ·»åŠ ' : 'é«˜äº®' }}</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view \n\t\t\t\tclass=\"action-btn confirm\" \n\t\t\t\t:class=\"{ 'disabled': !tempImagePath || isGenerating || isUploading }\"\n\t\t\t\t@click=\"confirmSelection\"\n\t\t\t>\n\t\t\t\t<text>{{ isUploading ? 'ä¸Šä¼ ä¸­...' : isGenerating ? 'ç”Ÿæˆä¸­...' : 'ä¸‹ä¸€æ­¥' }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"text-editor-modal\" v-if=\"showTextEditor\" @click.stop>\n\t\t\t<view class=\"modal-mask\" @click=\"closeTextEditor\"></view>\n\t\t\t<view class=\"modal-content\">\n\t\t\t\t<view class=\"modal-header\">\n\t\t\t\t\t<text class=\"modal-title\">ç¼–è¾‘æ–‡æ¡ˆ</text>\n\t\t\t\t\t<view class=\"close-btn\" @click=\"closeTextEditor\">Ã—</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"textarea-wrapper\">\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tclass=\"editor-textarea\" \n\t\t\t\t\t\tv-model=\"editingText\" \n\t\t\t\t\t\tmaxlength=\"500\"\n\t\t\t\t\t\tplaceholder=\"è¯·è¾“å…¥æ–‡å­—å†…å®¹...\"\n\t\t\t\t\t\t:show-confirm-bar=\"false\"\n\t\t\t\t\t\tfixed=\"true\"\n\t\t\t\t\t\tcursor-spacing=\"100\"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<text class=\"char-count\">{{ editingText.length }}/500</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"modal-footer\">\n\t\t\t\t\t<view class=\"modal-btn cancel\" @click=\"closeTextEditor\">å–æ¶ˆ</view>\n\t\t\t\t\t<view class=\"modal-btn confirm\" @click=\"confirmTextEdit\">ç¡®è®¤ç”Ÿæˆ</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"selector-drawer\" :class=\"{ 'visible': showSelector }\" @click.stop>\n\t\t\t<view class=\"drawer-mask\" @click=\"closeSelector\"></view>\n\t\t\t<view class=\"drawer-content\">\n\t\t\t\t<view class=\"drawer-header\">\n\t\t\t\t\t<text class=\"drawer-title\">\n\t\t\t\t\t\t{{ selectorType === 'font' ? 'é€‰æ‹©å­—ä½“' : 'é€‰æ‹©èƒŒæ™¯æ ·å¼' }}\n\t\t\t\t\t</text>\n\t\t\t\t\t<view class=\"drawer-close\" @click=\"closeSelector\">Ã—</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<scroll-view scroll-y class=\"drawer-scroll\">\n\t\t\t\t\t<view class=\"drawer-grid\">\n\t\t\t\t\t\t<block v-if=\"selectorType === 'font'\">\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tclass=\"drawer-item font-item\"\n\t\t\t\t\t\t\t\tv-for=\"(font, index) in currentFontList\" \n\t\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\t\t:class=\"{ 'active': currentFontIndex === index }\"\n\t\t\t\t\t\t\t\t@click=\"handleOptionSelect(index)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<text class=\"font-name\">{{ font.name }}</text>\n\t\t\t\t\t\t\t\t<text class=\"font-preview\" :style=\"{ fontFamily: font.family || 'sans-serif' }\">\n\t\t\t\t\t\t\t\t\täººç”Ÿæ²¡æœ‰ç™½èµ°çš„è·¯\n\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t\t<view class=\"check-mark\" v-if=\"currentFontIndex === index\">âœ“</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</block>\n\n\t\t\t\t\t\t<block v-if=\"selectorType === 'style'\">\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tclass=\"drawer-item style-item\"\n\t\t\t\t\t\t\t\tv-for=\"(style, index) in currentCategoryStyles\" \n\t\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\t\t:class=\"{ 'active': currentStyleIndex === index }\"\n\t\t\t\t\t\t\t\t@click=\"handleOptionSelect(index)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<image :src=\"style.path\" mode=\"aspectFill\" class=\"style-thumb\"></image>\n\t\t\t\t\t\t\t\t<text class=\"style-name\">{{ style.name || ('æ ·å¼ ' + (index + 1)) }}</text>\n\t\t\t\t\t\t\t\t<view class=\"check-mark\" v-if=\"currentStyleIndex === index\">âœ“</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</block>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t</view>\n\n\t</view>\n</template>\n\n<script>\n\timport { mapState, mapMutations } from 'vuex'\n\timport { backgroundCategories, fontLibrary } from './backgroundConfig.js'; \n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcontentItems: [], \n\t\t\t\tcontentText: '',\n\t\t\t\tselectedCategoryIndex: -1,\n\t\t\t\ttempImagePath: '',\n\t\t\t\tgeneratedImageUrl: '',\n\t\t\t\tisGenerating: false,\n\t\t\t\tisUploading: false,\n\t\t\t\tisTopic: false,\n\t\t\t\t\n\t\t\t\thighlightQueries: [], \n\t\t\t\t\n\t\t\t\tbackgroundCategories: backgroundCategories,\n\t\t\t\tfontLibrary: fontLibrary, \n\t\t\t\tloadedFontFamilies: new Set(), \n\t\t\t\t\n\t\t\t\tinitialFontSize: 100, \n\t\t\t\tcurrentFontSize: 18,\n\t\t\t\tminFontSize: 18,\n\t\t\t\tsliderDebounceTimer: null, \n\t\t\t\t\n\t\t\t\tisFirstLoad: true,\n\t\t\t\texistingImages: [],\n\n\t\t\t\t// ç¼–è¾‘å™¨çŠ¶æ€\n\t\t\t\tshowTextEditor: false,\n\t\t\t\teditingText: '',\n\n\t\t\t\t// é€‰æ‹©å™¨çŠ¶æ€\n\t\t\t\tshowSelector: false,\n\t\t\t\tselectorType: 'font' // 'font' | 'style'\n\t\t\t}\n\t\t},\n\t\t\n\t\tcomputed: {\n\t\t\t...mapState('m_user', ['openid', 'userBase']),\n\t\t\t\n\t\t\tcurrentStyle() {\n\t\t\t\tif (this.selectedCategoryIndex === -1) return null;\n\t\t\t\tconst category = this.backgroundCategories[this.selectedCategoryIndex];\n\t\t\t\treturn category.styles[category.currentStyleIndex];\n\t\t\t},\n\t\t\t\n\t\t\tcurrentFontList() {\n\t\t\t\tif (!this.currentStyle || !this.currentStyle.fonts) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\treturn this.currentStyle.fonts.map(fontKey => {\n\t\t\t\t\tconst fontData = this.fontLibrary[fontKey];\n\t\t\t\t\tif (!fontData) {\n\t\t\t\t\t\treturn { name: 'Default' }; \n\t\t\t\t\t}\n\t\t\t\t\treturn fontData;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tcurrentFontIndex() {\n\t\t\t\treturn this.currentStyle ? this.currentStyle.currentFontIndex : 0;\n\t\t\t},\n\n\t\t\tcurrentCategoryStyles() {\n\t\t\t\tif (this.selectedCategoryIndex === -1) return [];\n\t\t\t\treturn this.backgroundCategories[this.selectedCategoryIndex].styles;\n\t\t\t},\n\n\t\t\tcurrentStyleIndex() {\n\t\t\t\tif (this.selectedCategoryIndex === -1) return 0;\n\t\t\t\treturn this.backgroundCategories[this.selectedCategoryIndex].currentStyleIndex;\n\t\t\t},\n\t\t\t\n\t\t\tcurrentBackground() {\n\t\t\t\tif (!this.currentStyle) return null;\n\t\t\t\t\n\t\t\t\tconst style = this.currentStyle;\n\t\t\t\tconst fontIndex = style.currentFontIndex || 0;\n\t\t\t\t\n\t\t\t\tconst fontKey = style.fonts[fontIndex];\n\t\t\t\tif (!fontKey) return null;\n\t\t\t\t\n\t\t\t\tconst font = this.fontLibrary[fontKey]; \n\t\t\t\tif (!font) return null;\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t  path: style.path,\n\t\t\t\t  name: style.name,\n\t\t\t\t  textBox: style.textBox || null,\n\t\t\t\t  fontConfig: { \n\t\t\t\t\tfamily: font.family,\n\t\t\t\t\tweight: font.weight,\n\t\t\t\t\tstyle: font.style || 'normal',\n\t\t\t\t\turl: font.url || null \n\t\t\t\t  },\n\t\t\t\t  textColor: font.textColor,\n\t\t\t\t  highlightColor: font.highlightColor,\n\t\t\t\t  highlightGeometry: font.highlightGeometry || null\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\tonLoad(options) {\n\t\t    try {\n\t\t      const storedContentItems = uni.getStorageSync('topic_content_items');\n\t\t      if (storedContentItems && storedContentItems.length > 0) {\n\t\t        this.contentItems = storedContentItems;\n\t\t        this.contentText = this.convertContentItemsToText(storedContentItems);\n\t\t        uni.removeStorageSync('topic_content_items');\n\t\t      } else if (options.content) {\n\t\t        this.contentText = decodeURIComponent(options.content);\n\t\t        this.contentItems = [{ type: 'text', content: this.contentText }];\n\t\t      }\n\t\t    } catch (err) {\n\t\t      if (options.content) {\n\t\t        this.contentText = decodeURIComponent(options.content);\n\t\t        this.contentItems = [{ type: 'text', content: this.contentText }];\n\t\t      }\n\t\t    }\n\t\t    \n\t\t    if (options.images) {\n\t\t      try {\n\t\t        const images = JSON.parse(decodeURIComponent(options.images));\n\t\t        if (Array.isArray(images) && images.length > 0) this.existingImages = images;\n\t\t      } catch (error) {}\n\t\t    }\n\t\t    \n\t\t    if (options.isTopic) this.isTopic = options.isTopic === '1';\n\t\t    \n\t\t    this.backgroundCategories.forEach(category => {\n\t\t      this.$set(category, 'currentStyle', category.styles[category.currentStyleIndex]);\n\t\t      category.styles.forEach(style => {\n\t\t        if (style.currentFontIndex === undefined) {\n\t\t          this.$set(style, 'currentFontIndex', 0);\n\t\t        }\n\t\t      });\n\t\t    });\n\t\t    \n\t\t    this.$nextTick(() => {\n\t\t      this.selectCategory(0);\n\t\t    });\n\t\t},\n\t\t\n\t\tmethods: {\n\t\t\t...mapMutations('m_user', ['updateUserBase']),\n\n\t\t\t// --- é€‰æ‹©å™¨æŠ½å±‰é€»è¾‘ ---\n\t\t\topenSelector(type) {\n\t\t\t\tthis.selectorType = type;\n\t\t\t\tthis.showSelector = true;\n\n\t\t\t\t// ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šæ‰“å¼€å­—ä½“åˆ—è¡¨æ—¶ï¼Œè§¦å‘é™é»˜åŠ è½½\n\t\t\t\tif (type === 'font') {\n\t\t\t\t\tthis.preloadFontsForList();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šæ‰¹é‡åŠ è½½åˆ—è¡¨ä¸­çš„å­—ä½“\n\t\t\tpreloadFontsForList() {\n\t\t\t\tif (!this.currentFontList || this.currentFontList.length === 0) return;\n\n\t\t\t\tthis.currentFontList.forEach(font => {\n\t\t\t\t\t// å¦‚æœæ²¡æœ‰ URL æˆ–è€…å·²ç»åŠ è½½è¿‡ï¼Œè·³è¿‡\n\t\t\t\t\tif (!font.url || this.loadedFontFamilies.has(font.family)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tuni.loadFontFace({\n\t\t\t\t\t\tfamily: font.family,\n\t\t\t\t\t\tsource: `url(\"${font.url}\")`,\n\t\t\t\t\t\tglobal: true,\n\t\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\t\tthis.loadedFontFamilies.add(font.family);\n\t\t\t\t\t\t\t// å¼ºåˆ¶åˆ·æ–°ç•Œé¢ï¼Œç¡®ä¿åˆ—è¡¨ä¸­çš„å­—ä½“èƒ½å˜è¿‡æ¥\n\t\t\t\t\t\t\tthis.$forceUpdate();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\tconsole.warn('åˆ—è¡¨å­—ä½“åŠ è½½å¤±è´¥:', font.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tcloseSelector() {\n\t\t\t\tthis.showSelector = false;\n\t\t\t},\n\n\t\t\thandleOptionSelect(index) {\n\t\t\t\tif (this.isGenerating) return;\n\n\t\t\t\tif (this.selectorType === 'font') {\n\t\t\t\t\t// åˆ‡æ¢å­—ä½“\n\t\t\t\t\tif (this.currentStyle.currentFontIndex === index) return;\n\t\t\t\t\t\n\t\t\t\t\tthis.currentStyle.currentFontIndex = index;\n\t\t\t\t\tthis.$forceUpdate();\n\t\t\t\t\tthis.generateImage(null);\n\t\t\t\t\t\n\t\t\t\t\tconst newFont = this.currentFontList[index];\n\t\t\t\t\tuni.showToast({ title: `å·²åˆ‡æ¢: ${newFont.name}`, icon: 'none' });\n\t\t\t\t\t\n\t\t\t\t} else if (this.selectorType === 'style') {\n\t\t\t\t\t// åˆ‡æ¢èƒŒæ™¯æ ·å¼\n\t\t\t\t\tconst category = this.backgroundCategories[this.selectedCategoryIndex];\n\t\t\t\t\tif (category.currentStyleIndex === index) return;\n\n\t\t\t\t\tcategory.currentStyleIndex = index;\n\t\t\t\t\tthis.$set(category, 'currentStyle', category.styles[index]);\n\t\t\t\t\t\n\t\t\t\t\tthis.generateImage(null);\n\t\t\t\t\tuni.showToast({ title: 'èƒŒæ™¯å·²åˆ‡æ¢', icon: 'none' });\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.showSelector = false;\n\t\t\t},\n\t\t\t// --------------------\n\t\t\t\n\t\t\t// --- ç¼–è¾‘å™¨é€»è¾‘ ---\n\t\t\topenTextEditor() {\n\t\t\t\tthis.editingText = this.contentText;\n\t\t\t\tthis.showTextEditor = true;\n\t\t\t},\n\n\t\t\tcloseTextEditor() {\n\t\t\t\tthis.showTextEditor = false;\n\t\t\t},\n\n\t\t\tconfirmTextEdit() {\n\t\t\t\tif (!this.editingText.trim()) {\n\t\t\t\t\tuni.showToast({ title: 'å†…å®¹ä¸èƒ½ä¸ºç©º', icon: 'none' });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.contentText = this.editingText;\n\t\t\t\tthis.contentItems = [{ type: 'text', content: this.contentText }];\n\t\t\t\t\n\t\t\t\tif (this.highlightQueries.length > 0) {\n\t\t\t\t\tconst newQueries = this.highlightQueries.filter(q => this.contentText.includes(q));\n\t\t\t\t\tif (newQueries.length !== this.highlightQueries.length) {\n\t\t\t\t\t\tuni.showToast({ title: 'éƒ¨åˆ†é«˜äº®è¯å·²è‡ªåŠ¨ç§»é™¤', icon: 'none' });\n\t\t\t\t\t}\n\t\t\t\t\tthis.highlightQueries = newQueries;\n\t\t\t\t}\n\n\t\t\t\tthis.showTextEditor = false;\n\t\t\t\tthis.isFirstLoad = true; \n\t\t\t\tthis.generateImage(null);\n\t\t\t},\n\t\t\t// ----------------\n\n\t\t\tconvertContentItemsToText(items) {\n\t\t\t  return items.map(item => (item.type === 'text' ? item.content : 'ã€€')).join('');\n\t\t\t},\n\t\t\t\n\t\t\tshowHighlightPrompt() {\n\t\t\t    // æ£€æŸ¥æ˜¯å¦æœ‰ emoji ç±»å‹çš„å†…å®¹é¡¹\n\t\t\t    const hasEmojiType = this.contentItems.some(item => item.type === 'emoji');\n\t\t\t    \n\t\t\t    // ğŸ”¥ ä¿®æ”¹ï¼šæ›´ç²¾ç¡®çš„ Emoji æ£€æµ‹ï¼Œæ’é™¤æ™®é€šæ•°å­—å’Œå­—æ¯\n\t\t\t    const hasEmojiInText = this.contentItems.some(item => {\n\t\t\t        if (item.type === 'text') {\n\t\t\t            // æ›´ä¸¥æ ¼çš„ Emoji æ­£åˆ™ï¼šæ’é™¤ ASCII å­—ç¬¦ï¼ˆåŒ…æ‹¬æ•°å­—ã€å­—æ¯ã€æ ‡ç‚¹ï¼‰\n\t\t\t            const strictEmojiRegex = /[\\u{1F300}-\\u{1F9FF}\\u{2600}-\\u{26FF}\\u{2700}-\\u{27BF}\\u{1F000}-\\u{1F02F}\\u{1F0A0}-\\u{1F0FF}\\u{1F100}-\\u{1F64F}\\u{1F680}-\\u{1F6FF}\\u{1F910}-\\u{1F96B}\\u{1F980}-\\u{1F9E0}\\u{FE00}-\\u{FE0F}\\u{200D}\\u{20E3}\\u{3030}\\u{303D}\\u{3297}\\u{3299}]/gu;\n\t\t\t            return strictEmojiRegex.test(item.content);\n\t\t\t        }\n\t\t\t        return false;\n\t\t\t    });\n\t\t\t    \n\t\t\t    if (hasEmojiType || hasEmojiInText) {\n\t\t\t        uni.showModal({\n\t\t\t            title: 'æ— æ³•æ·»åŠ é«˜äº®',\n\t\t\t            content: 'æ·»åŠ è¡¨æƒ…åŒ…åæ— æ³•æ·»åŠ é«˜äº®ï¼Œè¯·åœ¨çº¯æ–‡å­—å†…å®¹ä¸­ä½¿ç”¨é«˜äº®åŠŸèƒ½',\n\t\t\t            showCancel: false, \n\t\t\t            confirmText: 'æˆ‘çŸ¥é“äº†', \n\t\t\t            confirmColor: '#C00000'\n\t\t\t        });\n\t\t\t        return;\n\t\t\t    }\n\t\t\t    \n\t\t\t    const textWithoutEmojis = this.contentItems\n\t\t\t        .filter(i => i.type === 'text')\n\t\t\t        .map(i => i.content)\n\t\t\t        .join('');\n\t\t\t    \n\t\t\t    uni.showModal({\n\t\t\t        title: 'æ·»åŠ é«˜äº®å…³é”®è¯',\n\t\t\t        editable: true,\n\t\t\t        placeholderText: 'ä¾‹å¦‚ï¼šé‡ç‚¹',\n\t\t\t        success: (res) => {\n\t\t\t            if (res.confirm && res.content) {\n\t\t\t                const newQuery = res.content.trim();\n\t\t\t                if (!newQuery) return;\n\t\t\t                \n\t\t\t                if (!textWithoutEmojis.includes(newQuery)) {\n\t\t\t                    uni.showModal({ \n\t\t\t                        title: 'æœªæ‰¾åˆ°å…³é”®è¯', \n\t\t\t                        content: `å†…å®¹ä¸­ä¸åŒ…å«\"${newQuery}\"`, \n\t\t\t                        showCancel: false \n\t\t\t                    });\n\t\t\t                    return;\n\t\t\t                }\n\t\t\t                \n\t\t\t                if (this.highlightQueries.includes(newQuery)) return;\n\t\t\t                \n\t\t\t                this.highlightQueries.push(newQuery);\n\t\t\t                this.generateImage(this.currentFontSize);\n\t\t\t            }\n\t\t\t        }\n\t\t\t    });\n\t\t\t},\n\n\t\t\tclearHighlight() {\n\t\t\t\tif (this.highlightQueries.length > 0) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: 'ç¡®è®¤æ¸…é™¤', content: 'è¦æ¸…é™¤æ‰€æœ‰é«˜äº®å…³é”®è¯å—ï¼Ÿ',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\tthis.highlightQueries = [];\n\t\t\t\t\t\t\t\tthis.generateImage(this.currentFontSize);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t  \t\t\t\t\t  \n\t\t\thandleSelectCategory(index) {\n\t\t\t\tif (this.isGenerating) return;\n\t\t\t\tthis.selectCategory(index);\n\t\t\t},\n\t\t\t\n\t\t\tselectCategory(index) {\n\t\t\t\tthis.selectedCategoryIndex = index;\n\t\t\t\tthis.generateImage(null);\n\t\t\t},\n\t\t\t\n\t\t\thandleSliderChange(e) {\n\t\t\t\tconst newSize = e.detail.value;\n\t\t\t\tthis.currentFontSize = newSize; \n\t\t\t\tif (this.sliderDebounceTimer) clearTimeout(this.sliderDebounceTimer);\n\t\t\t\tthis.sliderDebounceTimer = setTimeout(() => {\n\t\t\t\t\tthis.generateImage(newSize); \n\t\t\t\t}, 50);\n\t\t\t},\n\n\t\t\tasync getCanvasContext() {\n\t\t\t\t return new Promise((resolve, reject) => {\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\t\t\tquery.select('#textCanvas')\n\t\t\t\t\t\t.fields({ node: true, size: true })\n\t\t\t\t\t\t.exec((res) => {\n\t\t\t\t\t\t\tif (!res || !res[0] || !res[0].node) {\n\t\t\t\t\t\t\t\treject(new Error('è·å– Canvas å¤±è´¥'));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresolve(res[0].node.getContext('2d'));\n\t\t\t\t\t\t});\n\t\t\t\t });\n\t\t\t},\n\t\t\t\n\t\t\tdoesTextFit(ctx, text, fontSize, maxWidth, maxHeight, fontConfig) {\n\t\t\t\tconst fontWeight = fontConfig.weight || 'normal';\n\t\t\t\tconst fontFamily = fontConfig.family || 'sans-serif';\n\t\t\t\tctx.font = `normal ${fontWeight} ${fontSize}px ${fontFamily}`;\n\t\t\t\tconst lineHeight = fontSize * 1.4;\n\t\t\t\tconst lines = this.wrapText(ctx, text, maxWidth, fontSize); \n\t\t\t\treturn (lines.length * lineHeight) <= maxHeight;\n\t\t\t},\n\t\t\t\n\t\t\tasync calculateMaxFontSize(text, canvasWidth, canvasHeight, textBox, fontConfig) {\n\t\t\t\tconst padding = 60;\n\t\t\t\tconst maxWidth = textBox ? textBox.width : canvasWidth - padding * 2;\n\t\t\t\tconst maxHeight = textBox ? textBox.height : canvasHeight * 0.7;\n\t\t\t\tconst ctx = await this.getCanvasContext();\n\t\t\t\t\n\t\t\t\tlet bestFit = this.minFontSize;\n\t\t\t\tlet low = this.minFontSize, high = 300;\n\t\t\t\t\n\t\t\t\tfor (let i = 0; i < 10; i++) {\n\t\t\t\t\tif (low > high) break;\n\t\t\t\t\tlet mid = Math.floor((low + high) / 2);\n\t\t\t\t\tif (mid === 0) return bestFit; \n\t\t\t\t\tif (this.doesTextFit(ctx, text, mid, maxWidth, maxHeight, fontConfig)) {\n\t\t\t\t\t\tbestFit = mid;\n\t\t\t\t\t\tlow = mid + 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thigh = mid - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn bestFit;\n\t\t\t},\n\n\t\t\tasync loadCustomFont(fontConfig) {\n\t\t\t  if (!fontConfig || !fontConfig.url) return Promise.resolve();\n\t\t\t  const fontFamilyName = fontConfig.family;\n\t\t\t  if (this.loadedFontFamilies.has(fontFamilyName)) return Promise.resolve();\n\t\t\t  \n\t\t\t  uni.showLoading({ title: 'åŠ è½½å­—ä½“...', mask: true });\n\t\t\t  try {\n\t\t\t    await new Promise((resolve) => {\n\t\t\t      uni.loadFontFace({\n\t\t\t        family: fontFamilyName,\n\t\t\t        source: `url(\"${fontConfig.url}\")`,\n\t\t\t        success: () => { this.loadedFontFamilies.add(fontFamilyName); resolve(); },\n\t\t\t        fail: () => { this.loadedFontFamilies.add(fontFamilyName); resolve(); },\n\t\t\t\t\tcomplete: () => uni.hideLoading()\n\t\t\t      });\n\t\t\t    });\n\t\t\t  } catch (e) { uni.hideLoading(); }\n\t\t\t  return Promise.resolve();\n\t\t\t},\n\n\t\t\tasync generateImage(newFontSize = null) {\n\t\t\t\tif (this.isGenerating && newFontSize) return; \n\t\t\t\tthis.isGenerating = true;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t  const canvasWidth = 750, canvasHeight = 1000;\n\t\t\t\t  if (!this.currentBackground) throw new Error('æ— æ³•è·å–å½“å‰èƒŒæ™¯é…ç½®');\n\t\t\t\t  \n\t\t\t\t  await this.loadCustomFont(this.currentBackground.fontConfig);\n\t\t\t\t  \n\t\t\t\t  let fontSize;\n\t\t\t\t  if (newFontSize) {\n\t\t\t\t\tfontSize = newFontSize;\n\t\t\t\t  } else {\n\t\t\t\t\tconst newMaxFontSize = await this.calculateMaxFontSize(\n\t\t\t\t\t\tthis.contentText.trim(), canvasWidth, canvasHeight,\n\t\t\t\t\t\tthis.currentBackground.textBox, this.currentBackground.fontConfig \n\t\t\t\t\t);\n\t\t\t\t\tthis.initialFontSize = newMaxFontSize;  \n\t\t\t\t\tfontSize = this.isFirstLoad ? newMaxFontSize : Math.min(this.currentFontSize, newMaxFontSize);\n\t\t\t\t\tthis.isFirstLoad = false; \n\t\t\t\t\tthis.currentFontSize = fontSize;\n\t\t\t\t  }\n\t\t\t\t  \n\t\t\t\t    const tempFilePath = await this.drawTextOnBackground(\n\t\t\t\t      this.contentItems, this.currentBackground.path,\n\t\t\t\t      {\n\t\t\t\t        fontSize: fontSize,\n\t\t\t\t        textColor: this.currentBackground.textColor,\n\t\t\t\t        enableShadow: true,\n\t\t\t\t        fontConfig: this.currentBackground.fontConfig,\n\t\t\t\t        highlightColor: this.currentBackground.highlightColor,\n\t\t\t\t        textBox: this.currentBackground.textBox,\n\t\t\t\t        highlightGeometry: this.currentBackground.highlightGeometry,\n\t\t\t\t        highlightQueries: this.highlightQueries\n\t\t\t\t      }\n\t\t\t\t    );\n\t\t\t\t  this.tempImagePath = tempFilePath;\n\t\t\t\t} catch (error) {\n\t\t\t\t  console.error(error);\n\t\t\t\t  uni.showToast({ title: 'ç”Ÿæˆå¤±è´¥', icon: 'none' });\n\t\t\t\t} finally {\n\t\t\t\t  this.isGenerating = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tasync drawTextOnBackground(contentItems, bgImagePath, styleConfig) {\n\t\t\t  return new Promise((resolve, reject) => {\n\t\t\t    const query = uni.createSelectorQuery().in(this);\n\t\t\t    query.select('#textCanvas').fields({ node: true, size: true }).exec(async (res) => {\n\t\t\t        if (!res || !res[0]) { reject(new Error('Canvas Error')); return; }\n\t\t\t        const canvas = res[0].node;\n\t\t\t        const ctx = canvas.getContext('2d');\n\t\t\t        const dpr = uni.getSystemInfoSync().pixelRatio;\n\t\t\t        canvas.width = 750 * dpr; canvas.height = 1000 * dpr;\n\t\t\t        ctx.scale(dpr, dpr);\n\t\t\t        \n\t\t\t        try {\n\t\t\t          await this.drawBackgroundImage(ctx, canvas, 750, 1000, bgImagePath);\n\t\t\t          \n\t\t\t          const { fontConfig, fontSize, textColor } = styleConfig;\n\t\t\t          const fontWeight = fontConfig.weight || 'normal';\n\t\t\t          ctx.fillStyle = textColor;\n\t\t\t          ctx.textBaseline = 'middle';\n\t\t\t          ctx.font = `${fontConfig.style || 'normal'} ${fontWeight} ${fontSize}px ${fontConfig.family || 'sans-serif'}`;\n\t\t\t          \n\t\t\t          if (styleConfig.enableShadow) {\n\t\t\t            ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 8; ctx.shadowOffsetX = 2; ctx.shadowOffsetY = 2;\n\t\t\t          }\n\t\t\t          \n\t\t\t          await this.drawMixedContent(ctx, canvas, contentItems, 750, 1000, styleConfig);\n\t\t\t          \n\t\t\t          uni.canvasToTempFilePath({\n\t\t\t              canvas: canvas,\n\t\t\t              success: (r) => resolve(r.tempFilePath),\n\t\t\t              fail: (err) => reject(err)\n\t\t\t          }, this);\n\t\t\t        } catch (error) { reject(error); }\n\t\t\t      });\n\t\t\t  });\n\t\t\t},\n\t\t\t\n\t\t\tasync drawMixedContent(ctx, canvas, contentItems, canvasWidth, canvasHeight, styleConfig) {\n\t\t\t\tconst box = styleConfig.textBox;\n\t\t\t\tconst padding = 60;\n\t\t\t\tconst maxWidth = box ? box.width : canvasWidth - padding * 2;\n\t\t\t\tconst lineHeight = styleConfig.fontSize * 1.4;\n\t\t\t\tconst emojiSize = styleConfig.fontSize * 1.1;\n\t\t\t\t\n\t\t\t\tconst segments = await this.prepareDrawSegments(canvas, contentItems, maxWidth, styleConfig.fontSize, emojiSize, ctx);\n\t\t\t\tconst totalHeight = segments.length * lineHeight;\n\t\t\t\t\n\t\t\t\tlet startY;\n\t\t\t\tif (box) {\n\t\t\t\t    const vAlign = box.vAlign || 'middle';\n\t\t\t\t    if (vAlign === 'top') startY = box.y;\n\t\t\t\t    else if (vAlign === 'bottom') startY = box.y + box.height - totalHeight;\n\t\t\t\t    else startY = box.y + (box.height - totalHeight) / 2;\n\t\t\t\t} else {\n\t\t\t\t    startY = (canvasHeight - totalHeight) / 2;\n\t\t\t\t}\n\n\t\t\t\tconst highlightQueries = styleConfig.highlightQueries;\n\t\t\t\tconst hasHighlight = highlightQueries && highlightQueries.length > 0;\n\t\t\t\tconst textWithoutEmojis = contentItems.filter(i => i.type === 'text').map(i => i.content).join('');\n\t\t\t\tconst highlightRanges = [];\n\t\t\t\tif (hasHighlight) {\n\t\t\t\t\thighlightQueries.forEach(q => {\n\t\t\t\t\t\tif (!q) return;\n\t\t\t\t\t\tlet idx = textWithoutEmojis.indexOf(q);\n\t\t\t\t\t\twhile (idx !== -1) {\n\t\t\t\t\t\t\thighlightRanges.push({ start: idx, end: idx + q.length });\n\t\t\t\t\t\t\tidx = textWithoutEmojis.indexOf(q, idx + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlet textCharIndex = 0;\n\t\t\t\tsegments.forEach((line, lineIndex) => {\n\t\t\t\t\tconst y = startY + lineIndex * lineHeight + lineHeight / 2;\n\t\t\t\t\tlet lineWidth = 0;\n\t\t\t\t\tline.forEach(item => lineWidth += (item.type === 'text' ? ctx.measureText(item.content).width : emojiSize));\n\t\t\t\t\t\n\t\t\t\t\tlet x;\n\t\t\t\t\tif (box) {\n\t\t\t\t\t\tconst hAlign = box.hAlign || 'center';\n\t\t\t\t\t\tif (hAlign === 'left') x = box.x;\n\t\t\t\t\t\telse if (hAlign === 'right') x = box.x + box.width - lineWidth;\n\t\t\t\t\t\telse x = box.x + (box.width - lineWidth) / 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = (canvasWidth - lineWidth) / 2;\n\t\t\t\t\t}\n\n\t\t\t\t\tline.forEach(item => {\n\t\t\t\t\t\tif (item.type === 'text') {\n\t\t\t\t\t\t\tconst text = item.content;\n\t\t\t\t\t\t\tif (hasHighlight) {\n\t\t\t\t\t\t\t\tfor (let char of text) {\n\t\t\t\t\t\t\t\t\tconst charWidth = ctx.measureText(char).width;\n\t\t\t\t\t\t\t\t\tconst isHighlighted = highlightRanges.some(r => textCharIndex >= r.start && textCharIndex < r.end);\n\t\t\t\t\t\t\t\t\tif (isHighlighted) {\n\t\t\t\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\t\t\t\tctx.shadowColor='transparent'; ctx.fillStyle = styleConfig.highlightColor || '#A6ECA6';\n\t\t\t\t\t\t\t\t\t\tconst geo = styleConfig.highlightGeometry || { yOffset: -0.1, height: 0.6 };\n\t\t\t\t\t\t\t\t\t\tctx.fillRect(x, y + styleConfig.fontSize * geo.yOffset, charWidth, styleConfig.fontSize * geo.height);\n\t\t\t\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tctx.fillText(char, x, y);\n\t\t\t\t\t\t\t\t\tx += charWidth;\n\t\t\t\t\t\t\t\t\ttextCharIndex++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tctx.fillText(text, x, y);\n\t\t\t\t\t\t\t\tx += ctx.measureText(text).width;\n\t\t\t\t\t\t\t\ttextCharIndex += text.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (item.type === 'emoji' && item.image) {\n\t\t\t\t\t\t\tctx.drawImage(item.image, x, y - emojiSize/2, emojiSize, emojiSize);\n\t\t\t\t\t\t\tx += emojiSize;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tasync prepareDrawSegments(canvas, contentItems, maxWidth, fontSize, emojiSize, ctx) {\n\t\t\t\tconst lines = []; let currentLine = []; let currentLineWidth = 0;\n\t\t\t\tfor (let item of contentItems) {\n\t\t\t\t\tif (item.type === 'emoji' && item.url) {\n\t\t\t\t\t\ttry { item.image = await this.loadImageToCanvas(canvas, item.url); } catch(e){ item.image = null; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let item of contentItems) {\n\t\t\t\t\tif (item.type === 'text') {\n\t\t\t\t\t\tfor (let char of item.content) {\n\t\t\t\t\t\t\tconst charWidth = ctx.measureText(char).width;\n\t\t\t\t\t\t\tif (currentLineWidth + charWidth > maxWidth && currentLine.length > 0) {\n\t\t\t\t\t\t\t\tlines.push(currentLine); currentLine = []; currentLineWidth = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst last = currentLine[currentLine.length-1];\n\t\t\t\t\t\t\tif (last && last.type === 'text') last.content += char;\n\t\t\t\t\t\t\telse currentLine.push({ type: 'text', content: char });\n\t\t\t\t\t\t\tcurrentLineWidth += charWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (item.type === 'emoji') {\n\t\t\t\t\t\tif (currentLineWidth + emojiSize > maxWidth && currentLine.length > 0) {\n\t\t\t\t\t\t\tlines.push(currentLine); currentLine = []; currentLineWidth = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentLine.push({ type: 'emoji', image: item.image });\n\t\t\t\t\t\tcurrentLineWidth += emojiSize;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (currentLine.length > 0) lines.push(currentLine);\n\t\t\t\treturn lines;\n\t\t\t},\n\t\t\t\n\t\t\tloadImageToCanvas(canvas, url) {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\tconst img = canvas.createImage();\n\t\t\t\t\timg.onload = () => res(img); img.onerror = rej; img.src = url;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\twrapText(ctx, text, maxWidth, fontSize) {\n\t\t\t\tconst lines = []; let line = '';\n\t\t\t\tfor (let char of text) {\n\t\t\t\t\tif (char === '\\n') { lines.push(line); line = ''; continue; }\n\t\t\t\t\tif (ctx.measureText(line + char).width > maxWidth && line !== '') { lines.push(line); line = char; }\n\t\t\t\t\telse line += char;\n\t\t\t\t}\n\t\t\t\tif (line !== '') lines.push(line);\n\t\t\t\treturn lines;\n\t\t\t},\n\t\t\t\n\t\t\tdrawBackgroundImage(ctx, canvas, width, height, path) {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst img = canvas.createImage();\n\t\t\t\t\timg.onload = () => { ctx.drawImage(img, 0, 0, width, height); resolve(); };\n\t\t\t\t\timg.onerror = reject;\n\t\t\t\t\timg.src = path;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tasync uploadToOSS(filePath) {\r\n\t\t\t  if (!filePath) {\r\n\t\t\t    throw new Error('æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º');\r\n\t\t\t  }\r\n\t\t\t\r\n\t\t\t  uni.showLoading({\r\n\t\t\t    title: 'ä¸Šä¼ ä¸­...',\r\n\t\t\t    mask: true\r\n\t\t\t  });\r\n\t\t\t\r\n\t\t\t  try {\r\n\t\t\t    // 1. è·å–ä¸Šä¼ å‡­è¯\r\n\t\t\t    const { data: tokenRes } = await uni.$http.get('/upload/token', {\r\n\t\t\t      openid: this.openid,\r\n\t\t\t      fileType: 'image'\r\n\t\t\t    });\r\n\t\t\t\r\n\t\t\t    if (tokenRes.meta.status !== 200) {\r\n\t\t\t      throw new Error('è·å–ä¸Šä¼ å‡­è¯å¤±è´¥');\r\n\t\t\t    }\r\n\t\t\t\r\n\t\t\t    // 2. è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆè½¬ base64ï¼‰\r\n\t\t\t    const fileContent = await new Promise((resolve, reject) => {\r\n\t\t\t      uni.getFileSystemManager().readFile({\r\n\t\t\t        filePath: filePath,\r\n\t\t\t        encoding: 'base64',\r\n\t\t\t        success: (res) => resolve(res.data),\r\n\t\t\t        fail: (err) => reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'))\r\n\t\t\t      });\r\n\t\t\t    });\r\n\t\t\t\r\n\t\t\t    // 3. ä¸Šä¼ åˆ° OSS\r\n\t\t\t    await new Promise((resolve, reject) => {\r\n\t\t\t      uni.request({\r\n\t\t\t        url: tokenRes.message.publicUrl,\r\n\t\t\t        method: 'PUT',\r\n\t\t\t        header: {\r\n\t\t\t          'Content-Type': 'application/octet-stream'\r\n\t\t\t        },\r\n\t\t\t        data: uni.base64ToArrayBuffer(fileContent),\r\n\t\t\t        success: (res) => {\r\n\t\t\t          if (res.statusCode === 200) {\r\n\t\t\t            resolve(res);\r\n\t\t\t          } else {\r\n\t\t\t            reject(new Error(`ä¸Šä¼ å¤±è´¥: ${res.statusCode}`));\r\n\t\t\t          }\r\n\t\t\t        },\r\n\t\t\t        fail: (err) => reject(new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥'))\r\n\t\t\t      });\r\n\t\t\t    });\r\n\t\t\t\r\n\t\t\t    uni.hideLoading();\r\n\t\t\t    \r\n\t\t\t    // 4. è¿”å› OSS å…¬å¼€è®¿é—® URL\r\n\t\t\t    return tokenRes.message.publicUrl;\r\n\t\t\t\r\n\t\t\t  } catch (error) {\r\n\t\t\t    console.error('OSS ä¸Šä¼ å¤±è´¥:', error);\r\n\t\t\t    uni.hideLoading();\r\n\t\t\t    \r\n\t\t\t    // æ˜¾ç¤ºé”™è¯¯æç¤º\r\n\t\t\t    uni.showToast({\r\n\t\t\t      title: error.message || 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•',\r\n\t\t\t      icon: 'none',\r\n\t\t\t      duration: 3000\r\n\t\t\t    });\r\n\t\t\t    \r\n\t\t\t    throw error; // æŠ›å‡ºé”™è¯¯ï¼Œè®©è°ƒç”¨æ–¹å¤„ç†\r\n\t\t\t  }\r\n\t\t\t},\n\t\t\t\n\t\t\tasync confirmSelection() {\n\t\t\t\tif (!this.tempImagePath || this.isGenerating || this.isUploading) return;\n\t\t\t\tthis.isUploading = true;\n\t\t\t\ttry {\n\t\t\t\t\tconst ossUrl = await this.uploadToOSS(this.tempImagePath);\n\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\turl: '/subpkg/publish-post/publish-post',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tres.eventChannel.emit('topicImageData', {\n\t\t\t\t\t\t\t\timageUrl: ossUrl, images: [ossUrl, ...this.existingImages],\n\t\t\t\t\t\t\t\tcontent: this.contentText, isTopic: this.isTopic\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} catch (e) { uni.showToast({ title: 'ä¸Šä¼ å¤±è´¥', icon: 'none' }); } \n\t\t\t\tfinally { this.isUploading = false; }\n\t\t\t},\n\t\t\t\n\t\t\tgoBack() { uni.navigateBack(); }\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n// ... (åŸæœ‰åŸºç¡€æ ·å¼) ...\n.text-to-image-page { min-height: 100vh; background-color: #fff; display: flex; flex-direction: column; }\n.image-preview-container { flex: 1; background: #f8f8f8; display: flex; align-items: center; justify-content: center; padding: 32rpx; }\n.preview-image-wrapper { width: 686rpx; border-radius: 24rpx; box-shadow: 0 12rpx 48rpx rgba(0,0,0,0.15); overflow: hidden; }\n.preview-image { width: 100%; display: block; }\n.loading-container { display: flex; flex-direction: column; align-items: center; }\n.loading-spinner { width: 60rpx; height: 60rpx; border: 4rpx solid rgba(192,0,0,0.1); border-top-color: #C00000; border-radius: 50%; animation: spin 1s linear infinite; }\n.loading-text { margin-top: 24rpx; font-size: 26rpx; color: #999; }\n.empty-preview { display: flex; flex-direction: column; align-items: center; gap: 16rpx; color: #999; }\n.empty-icon { font-size: 120rpx; opacity: 0.3; }\n\n.highlight-toolbar-container { padding: 20rpx; border-top: 1rpx solid #f0f0f0; display: flex; justify-content: center; }\n.button-group { display: flex; gap: 16rpx; }\n.highlight-action-btn { padding: 10rpx 24rpx; border-radius: 30rpx; font-size: 24rpx; }\n.highlight-action-btn.add-more { background: #f5f5f5; border: 1rpx solid #e0e0e0; }\n.highlight-action-btn.clear { background: #fef0f0; border: 1rpx solid #fde2e2; color: #C00000; }\n\n.font-slider-container { \n\tdisplay: flex; align-items: center; padding: 10rpx 32rpx 20rpx; background: #fff; border-top: 1rpx solid #f0f0f0; gap: 16rpx; \n\t.slider-label { font-size: 26rpx; color: #666; }\n\t.font-slider { flex: 1; margin: 0; }\n\t.font-change-button { \n\t\tpadding: 10rpx 24rpx; background: #f5f5f5; border: 1rpx solid #e0e0e0; border-radius: 30rpx; font-size: 24rpx; color: #333; \n\t\t&.edit-btn { background: #fff0f0; border-color: #ffe0e0; color: #C00000; }\n\t}\n}\n\n.bg-selector-section {\n\tbackground: #fff; padding: 32rpx 0 24rpx; border-top: 1rpx solid #f0f0f0; z-index: 10;\n\t.selector-title { font-size: 28rpx; color: #333; padding: 0 32rpx; margin-bottom: 24rpx; display: block; }\n\t.bg-image-list { white-space: nowrap; padding: 0 32rpx; }\n\t.bg-image-item {\n\t\tdisplay: inline-block; margin-right: 20rpx; position: relative;\n\t\t.bg-thumbnail { width: 160rpx; height: 200rpx; border-radius: 16rpx; border: 3rpx solid transparent; display: block; }\n\t\t.bg-name-wrapper { margin-top: 12rpx; text-align: center; .bg-name { font-size: 22rpx; color: #666; } }\n\t\t&.active .bg-thumbnail { border-color: #C00000; transform: scale(1.05); }\n\t\t&.active .bg-name { color: #C00000; font-weight: 600; }\n\t\t\n\t\t.selected-badge { \n\t\t\tposition: absolute; top: 12rpx; right: 12rpx; width: 40rpx; height: 40rpx; background: linear-gradient(135deg, #C00000, #ff6b6b); \n\t\t\tborder-radius: 50%; color: #fff; font-size: 24rpx; display: flex; align-items: center; justify-content: center; \n\t\t}\n\t\t\n\t\t.change-style-btn {\n\t\t\tposition: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\n\t\t\twidth: 72rpx; height: 72rpx; background: rgba(0,0,0,0.7); backdrop-filter: blur(10rpx);\n\t\t\tborder-radius: 50%; display: flex; align-items: center; justify-content: center;\n\t\t\tborder: 2rpx solid rgba(255,255,255,0.3);\n\t\t\t.change-icon { font-size: 36rpx; color: #fff; font-weight: bold; padding-bottom: 10rpx; } \n\t\t}\n\t}\n}\n\n.bottom-actions {\n\tdisplay: flex; gap: 16rpx; padding: 24rpx 32rpx 48rpx; background: #fff; border-top: 1rpx solid #f0f0f0;\n\t.action-btn { \n\t\tflex: 1; height: 88rpx; border-radius: 44rpx; display: flex; align-items: center; justify-content: center; font-size: 32rpx; font-weight: 500;\n\t\t&.cancel { background: #f5f5ff; color: #666; }\n\t\t&.drawing-toggle { background: linear-gradient(135deg, #FFD700, #FFA500); color: #fff; }\n\t\t&.confirm { background: linear-gradient(135deg, #C00000, #ff6b6b); color: #fff; &.disabled { opacity: 0.5; background: #ccc; } }\n\t}\n}\n\n// æ–‡æœ¬ç¼–è¾‘å¼¹çª—æ ·å¼\n.text-editor-modal {\n\tposition: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 999; display: flex; align-items: center; justify-content: center;\n\t.modal-mask { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }\n\t.modal-content {\n\t\tposition: relative; width: 640rpx; background: #fff; border-radius: 24rpx; overflow: hidden; animation: popIn 0.3s;\n\t\t.modal-header { padding: 32rpx; display: flex; justify-content: space-between; border-bottom: 1rpx solid #f5f5f5; font-weight: bold; }\n\t\t.close-btn { font-size: 40rpx; color: #999; padding: 0 10rpx; }\n\t\t.textarea-wrapper { padding: 32rpx; background: #f9f9f9; position: relative; }\n\t\t.editor-textarea { width: 100%; height: 300rpx; font-size: 30rpx; line-height: 1.6; }\n\t\t.char-count { position: absolute; bottom: 16rpx; right: 32rpx; font-size: 24rpx; color: #ccc; }\n\t\t.modal-footer { display: flex; border-top: 1rpx solid #eee; .modal-btn { flex: 1; height: 100rpx; display: flex; align-items: center; justify-content: center; } .cancel { color: #666; border-right: 1rpx solid #eee; } .confirm { color: #C00000; font-weight: 600; } }\n\t}\n}\n\n// åº•éƒ¨é€‰æ‹©å™¨æ ·å¼\n.selector-drawer {\n\tposition: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; visibility: hidden; transition: visibility 0.3s;\n\t&.visible { visibility: visible; .drawer-mask { opacity: 1; } .drawer-content { transform: translateY(0); } }\n\t.drawer-mask { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s; }\n\t.drawer-content {\n\t\tposition: absolute; bottom: 0; left: 0; width: 100%; height: 60vh; background: #fff; border-radius: 24rpx 24rpx 0 0;\n\t\tdisplay: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.19,1,0.22,1);\n\t\tpadding-bottom: env(safe-area-inset-bottom);\n\t\t\n\t\t.drawer-header { padding: 32rpx; display: flex; justify-content: space-between; align-items: center; border-bottom: 1rpx solid #f0f0f0; \n\t\t\t.drawer-title { font-size: 32rpx; font-weight: 600; } .drawer-close { font-size: 48rpx; color: #999; line-height: 1; padding: 0 16rpx; }\n\t\t}\n\t\t.drawer-scroll { flex: 1; height: 0; }\n\t\t.drawer-grid { padding: 24rpx; display: grid; gap: 24rpx; }\n\t\t\n\t\t.font-item {\n\t\t\tdisplay: flex; flex-direction: column; padding: 24rpx; background: #f9f9f9; border-radius: 16rpx; border: 2rpx solid transparent; position: relative;\n\t\t\t&.active { border-color: #C00000; background: #fff5f5; .font-name { color: #C00000; } }\n\t\t\t.font-name { font-size: 24rpx; font-weight: bold; color: #999; margin-bottom: 12rpx; }\n\t\t\t.font-preview { font-size: 40rpx; color: #333; }\n\t\t\t.check-mark { position: absolute; top: 24rpx; right: 24rpx; color: #C00000; font-weight: bold; }\n\t\t}\n\t\t\n\t\t.style-item {\n\t\t\tdisplay: flex; align-items: center; padding: 16rpx; background: #fff; border-radius: 16rpx; position: relative; border-bottom: 1rpx solid #f5f5f5;\n\t\t\t&.active { background: #fff5f5; .style-name { color: #C00000; font-weight: bold; } }\n\t\t\t.style-thumb { width: 100rpx; height: 100rpx; border-radius: 12rpx; margin-right: 24rpx; background: #eee; }\n\t\t\t.style-name { font-size: 28rpx; color: #333; flex: 1; }\n\t\t\t.check-mark { color: #C00000; font-weight: bold; margin-right: 16rpx; }\n\t\t}\n\t}\n}\n\n@keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }\n@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n</style>","import mod from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./text-to-image.vue?vue&type=style&index=0&id=3f3b62ce&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1763801061841\n      var cssReload = require(\"D:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}