<view class="post-detail-page"><scroll-view class="post-content-area" scroll-y="{{true}}"><block wx:if="{{post}}"><view class="post-detail"><view class="post-header"><view class="user-info"><image class="avatar" src="{{post.avatar||'/static/default-avatar.png'}}" mode="aspectFill"></image><view class="user-detail"><text class="nickname">{{post.nickname}}</text><view class="post-meta"><text class="post-time">{{post.created_at}}</text><text class="post-views">{{post.viewCount+"人浏览"}}</text></view></view></view><text data-event-opts="{{[['tap',[['showPostMenu',['$event']]]]]}}" class="iconfont more-btn" bindtap="__e">⋮</text></view><view class="text-content"><text class="content-text">{{''+post.content+''}}<block wx:for="{{$root.l0}}" wx:for-item="tag" wx:for-index="index" wx:key="index"><text class="tag-item">{{'#'+tag+''}}</text></block></text></view><block wx:if="{{$root.g0}}"><view class="post-images"><block wx:for="{{post.images}}" wx:for-item="img" wx:for-index="index" wx:key="index"><image class="post-image" src="{{img}}" mode="aspectFill" data-event-opts="{{[['tap',[['previewImage',['$0',index],['post.images']]]]]}}" bindtap="__e"></image></block></view></block><view class="divider"></view><view class="comments-title"><text>{{"评论 ("+post.commentCount+")"}}</text></view></view></block><view class="comments-list"><block wx:for="{{$root.l2}}" wx:for-item="comment" wx:for-index="__i0__" wx:key="id"><view class="comment-item"><view data-event-opts="{{[['tap',[['handleReplyClick',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="comment-main" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="comment-header" catchtap="__e"><image class="comment-avatar" src="{{comment.$orig.avatar||'/static/default-avatar.png'}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['handleReplyClick',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="comment-info" bindtap="__e"><view data-event-opts="{{[['tap',[['handleReplyClick',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="nickname-row" bindtap="__e"><text data-event-opts="{{[['tap',[['handleReplyClick',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="comment-nickname" bindtap="__e">{{comment.$orig.nickname}}</text><block wx:if="{{comment.$orig.is_author}}"><text class="author-badge">作者</text></block></view><text class="comment-time">{{comment.m0}}</text></view><view class="comment-actions"><view data-event-opts="{{[['tap',[['toggleCommentLike',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="like-btn" catchtap="__e"><image class="{{['like-icon-img',(comment.$orig.is_liked)?'liked-animation':'']}}" src="{{comment.$orig.is_liked?'https://wait00.oss-cn-shanghai.aliyuncs.com/label/liked.png':'https://wait00.oss-cn-shanghai.aliyuncs.com/label/like.png'}}" mode="aspectFit"></image><block wx:if="{{comment.$orig.like_count>0}}"><text class="like-count">{{comment.$orig.like_count}}</text></block></view><block wx:if="{{comment.$orig.user_openid===openid}}"><image class="delete-btn-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/shanchu.png" mode="aspectFit" data-event-opts="{{[['tap',[['deleteComment',['$0'],[[['commentList','id',comment.$orig.id,'id']]]]]]]}}" catchtap="__e"></image></block></view></view><view class="comment-content"><rich-text nodes="{{comment.m1}}"></rich-text></view></view><block wx:if="{{comment.g1}}"><view class="replies-section"><block wx:for="{{comment.l1}}" wx:for-item="reply" wx:for-index="__i1__" wx:key="id"><view data-event-opts="{{[['tap',[['handleReplyClick',['$0','$1'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]],[['commentList','id',comment.$orig.id]]]]]]]}}" class="reply-item" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="reply-header" catchtap="__e"><image class="reply-avatar" src="{{reply.$orig.avatar||'/static/default-avatar.png'}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['handleReplyClick',['$0','$1'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]],[['commentList','id',comment.$orig.id]]]]]]]}}" class="reply-info" bindtap="__e"><view data-event-opts="{{[['tap',[['handleReplyClick',['$0','$1'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]],[['commentList','id',comment.$orig.id]]]]]]]}}" class="reply-nickname-row" bindtap="__e"><text data-event-opts="{{[['tap',[['handleReplyClick',['$0','$1'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]],[['commentList','id',comment.$orig.id]]]]]]]}}" class="reply-nickname" bindtap="__e">{{reply.$orig.nickname}}</text><block wx:if="{{reply.$orig.is_author}}"><text class="author-badge">作者</text></block><block wx:if="{{reply.$orig.reply_to_nickname}}"><text class="reply-arrow">→</text></block><block wx:if="{{reply.$orig.reply_to_nickname}}"><text class="reply-target">{{reply.$orig.reply_to_nickname}}</text></block></view><text class="reply-time">{{reply.m2}}</text></view><view class="reply-actions"><view data-event-opts="{{[['tap',[['toggleCommentLike',['$0'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]]]]]]]}}" class="like-btn" catchtap="__e"><image class="{{['like-icon-img',(reply.$orig.is_liked)?'liked-animation':'']}}" src="{{reply.$orig.is_liked?'https://wait00.oss-cn-shanghai.aliyuncs.com/label/liked.png':'https://wait00.oss-cn-shanghai.aliyuncs.com/label/like.png'}}" mode="aspectFit"></image><block wx:if="{{reply.$orig.like_count>0}}"><text class="like-count">{{reply.$orig.like_count}}</text></block></view><block wx:if="{{reply.$orig.user_openid===openid}}"><image class="delete-btn-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/shanchu.png" mode="aspectFit" data-event-opts="{{[['tap',[['deleteComment',['$0'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id,'id']]]]]]]}}" catchtap="__e"></image></block></view></view><view class="reply-content"><rich-text nodes="{{reply.m3}}"></rich-text></view></view></block><block wx:if="{{comment.$orig.has_more_replies}}"><view data-event-opts="{{[['tap',[['loadMoreReplies',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="more-replies-btn" catchtap="__e"><text>{{"查看更多回复 ("+(comment.$orig.reply_count-comment.g2)+")"}}</text></view></block></view></block></view></block></view><block wx:if="{{commentHasMore}}"><view class="comment-load-more"><text class="load-text">加载更多评论</text></view></block><block wx:if="{{$root.g3}}"><view class="no-comments"><text>还没有评论，快来抢沙发吧！</text></view></block></scroll-view><view class="bottom-action-bar"><view data-event-opts="{{[['tap',[['showQuickReply',['$event']]]]]}}" class="input-trigger" bindtap="__e"><text class="input-placeholder">说说你的想法...</text></view><view class="action-group"><view data-event-opts="{{[['tap',[['togglePostLike',['$event']]]]]}}" class="action-item" bindtap="__e"><image class="action-icon-img" src="{{post&&post.isLiked?iconLikedUrl:iconLikeUrl}}" mode="aspectFit"></image><text class="action-text">{{post?post.likeCount:0}}</text></view><view data-event-opts="{{[['tap',[['showQuickReply',['$event']]]]]}}" class="action-item" bindtap="__e"><image class="action-icon-img" src="{{iconCommentUrl}}" mode="aspectFit"></image><text class="action-text">{{post?post.commentCount:0}}</text></view></view></view><block wx:if="{{showReplyModal}}"><view data-event-opts="{{[['tap',[['hideReplyInput',['$event']]]]]}}" class="reply-modal" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="reply-modal-content" catchtap="__e"><view class="reply-header"><text class="reply-title">{{''+(replyTarget?'回复 @'+replyTarget.nickname:'写评论')+''}}</text><text data-event-opts="{{[['tap',[['hideReplyInput',['$event']]]]]}}" class="close-btn" bindtap="__e">×</text></view><view class="input-wrapper"><textarea class="reply-textarea" placeholder="{{replyTarget?'回复 @'+replyTarget.nickname:'写个评论...'}}" focus="{{showReplyModal&&!showEmojiPicker}}" auto-height="{{true}}" maxlength="500" data-event-opts="{{[['input',[['__set_model',['','commentContent','$event',[]]],['onInputChange',['$event']]]]]}}" value="{{commentContent}}" bindinput="__e"></textarea><view data-event-opts="{{[['tap',[['toggleEmojiPicker',['$event']]]]]}}" class="emoji-btn" catchtap="__e"><block wx:if="{{!showEmojiPicker}}"><image class="emoji-icon-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/biaoqing.png" mode="aspectFit"></image></block><block wx:if="{{showEmojiPicker}}"><image class="emoji-icon-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/jianpan.png" mode="aspectFit"></image></block></view></view><block wx:if="{{showEmojiPicker}}"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="emoji-picker" catchtap="__e"><view class="emoji-tabs"><view data-event-opts="{{[['tap',[['switchEmojiSet',['mini']]]]]}}" class="{{['tab-item',(currentEmojiSet==='mini')?'active':'']}}" bindtap="__e">小表情</view><view data-event-opts="{{[['tap',[['switchEmojiSet',['large']]]]]}}" class="{{['tab-item',(currentEmojiSet==='large')?'active':'']}}" bindtap="__e">大表情</view></view><view class="emoji-list"><block wx:for="{{displayEmojiList}}" wx:for-item="emoji" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['insertEmoji',['$0'],[[['displayEmojiList','',index]]]]]]]}}" class="emoji-item" bindtap="__e"><image class="emoji-image" src="{{emoji.url}}" mode="aspectFit"></image></view></block></view></view></block><view class="reply-actions"><view class="char-count">{{$root.g4+"/500"}}</view><view data-event-opts="{{[['tap',[['submitComment',['$event']]]]]}}" class="{{['submit-btn',(!$root.g5)?'disabled':'']}}" bindtap="__e"><text>发送</text></view></view></view></view></block></view>