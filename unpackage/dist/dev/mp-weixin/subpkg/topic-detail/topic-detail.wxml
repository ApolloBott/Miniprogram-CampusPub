<view class="topic-detail-page"><block wx:if="{{post}}"><view class="topic-header"><view class="user-section"><image class="user-avatar" src="{{post.avatar||'/static/default-avatar.png'}}" mode="aspectFill" data-event-opts="{{[['tap',[['gotoUserProfile',['$0'],['post']]]]]}}" bindtap="__e"></image><view class="user-info"><text class="user-nickname">{{post.nickname}}</text><view class="post-meta"><text class="post-time">{{post.created_at}}</text><text class="post-views">{{post.viewCount+"äººæµè§ˆ"}}</text></view></view></view><view class="header-actions"><block wx:if="{{openid}}"><button class="share-btn" open-type="share" data-event-opts="{{[['tap',[['',['$event']]]]]}}" catchtap="__e"><uni-icons vue-id="2115296c-1" type="redo" size="24" color="#333" bind:__l="__l"></uni-icons></button></block><text data-event-opts="{{[['tap',[['showPostMenu',['$event']]]]]}}" class="more-btn" bindtap="__e">â‹®</text></view></view></block><scroll-view class="content-scroll-area" scroll-y="{{true}}" data-event-opts="{{[['scrolltolower',[['loadMoreComments',['$event']]]]]}}" bindscrolltolower="__e"><block wx:if="{{post}}"><view class="post-body"><block wx:if="{{$root.g0}}"><view class="image-section"><block wx:if="{{$root.g1===1}}"><image class="single-image" src="{{post.images[0]}}" mode="widthFix" data-event-opts="{{[['tap',[['previewImage',['$0',0],['post.images']]]]]}}" bindtap="__e"></image></block><block wx:else><swiper class="image-swiper" style="{{'height:'+(swiperHeight+'rpx')+';'}}" indicator-dots="{{true}}" indicator-color="rgba(255, 255, 255, 0.5)" indicator-active-color="#fff" autoplay="{{false}}" circular="{{false}}" data-event-opts="{{[['change',[['onSwiperChange',['$event']]]]]}}" bindchange="__e"><block wx:for="{{post.images}}" wx:for-item="img" wx:for-index="index" wx:key="index"><swiper-item><image class="swiper-image" src="{{img}}" mode="aspectFit" data-event-opts="{{[['load',[['onImageLoad',['$event',index]]]],['tap',[['previewImage',['$0',index],['post.images']]]]]}}" bindload="__e" bindtap="__e"></image></swiper-item></block></swiper></block></view></block><view class="text-content"><text class="content-text">{{''+post.content+''}}<block wx:for="{{$root.l0}}" wx:for-item="tag" wx:for-index="index" wx:key="index"><text class="tag-item">{{'#'+tag+''}}</text></block></text></view></view></block><view class="comments-section"><block wx:for="{{$root.l2}}" wx:for-item="comment" wx:for-index="__i0__" wx:key="id"><view class="comment-item"><view class="comment-main"><image class="comment-avatar" src="{{comment.$orig.avatar||'/static/default-avatar.png'}}" mode="aspectFill" data-event-opts="{{[['tap',[['gotoUserProfile',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" catchtap="__e"></image><view data-event-opts="{{[['tap',[['handleReplyClick',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="comment-body" bindtap="__e"><view class="comment-header"><view class="comment-user"><text class="comment-nickname">{{comment.$orig.nickname}}</text><block wx:if="{{comment.$orig.is_author}}"><text class="author-badge">ä½œè€…</text></block></view><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="comment-actions" catchtap="__e"><view data-event-opts="{{[['tap',[['toggleCommentLike',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="like-btn" catchtap="__e"><image class="{{['like-icon-img',(comment.$orig.is_liked)?'liked-animation':'']}}" src="{{comment.$orig.is_liked?iconLikedUrl:iconLikeUrl}}" mode="aspectFit"></image><block wx:if="{{comment.$orig.like_count>0}}"><text class="like-count">{{comment.$orig.like_count}}</text></block></view><block wx:if="{{comment.$orig.user_openid===openid}}"><image class="delete-btn-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/shanchu.png" mode="aspectFit" data-event-opts="{{[['tap',[['deleteComment',['$0'],[[['commentList','id',comment.$orig.id,'id']]]]]]]}}" catchtap="__e"></image></block></view></view><view class="comment-content"><rich-text nodes="{{comment.m0}}"></rich-text></view><view class="comment-footer"><text class="comment-time">{{comment.m1}}</text></view></view></view><block wx:if="{{comment.g2}}"><view class="replies-list"><block wx:for="{{comment.l1}}" wx:for-item="reply" wx:for-index="__i1__" wx:key="id"><view class="reply-item"><image class="reply-avatar" src="{{reply.$orig.avatar||'/static/default-avatar.png'}}" mode="aspectFill" data-event-opts="{{[['tap',[['gotoUserProfile',['$0'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]]]]]]]}}" catchtap="__e"></image><view data-event-opts="{{[['tap',[['handleReplyClick',['$0','$1'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]],[['commentList','id',comment.$orig.id]]]]]]]}}" class="reply-body" bindtap="__e"><view class="reply-header"><view class="reply-user"><text class="reply-nickname">{{reply.$orig.nickname}}</text><block wx:if="{{reply.$orig.is_author}}"><text class="author-badge">ä½œè€…</text></block><block wx:if="{{reply.$orig.reply_to_nickname}}"><text class="reply-arrow">â†’</text></block><block wx:if="{{reply.$orig.reply_to_nickname}}"><text class="reply-target">{{reply.$orig.reply_to_nickname}}</text></block></view><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="reply-actions" catchtap="__e"><view data-event-opts="{{[['tap',[['toggleCommentLike',['$0'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id]]]]]]]}}" class="like-btn" catchtap="__e"><image class="{{['like-icon-img',(reply.$orig.is_liked)?'liked-animation':'']}}" src="{{reply.$orig.is_liked?iconLikedUrl:iconLikeUrl}}" mode="aspectFit"></image><block wx:if="{{reply.$orig.like_count>0}}"><text class="like-count">{{reply.$orig.like_count}}</text></block></view><block wx:if="{{reply.$orig.user_openid===openid}}"><image class="delete-btn-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/shanchu.png" mode="aspectFit" data-event-opts="{{[['tap',[['deleteComment',['$0'],[[['commentList','id',comment.$orig.id],['replies','id',reply.$orig.id,'id']]]]]]]}}" catchtap="__e"></image></block></view></view><view class="reply-content"><rich-text nodes="{{reply.m2}}"></rich-text></view><text class="reply-time">{{reply.m3}}</text></view></view></block><block wx:if="{{comment.$orig.has_more_replies}}"><view data-event-opts="{{[['tap',[['loadMoreReplies',['$0'],[[['commentList','id',comment.$orig.id]]]]]]]}}" class="load-more-replies" catchtap="__e"><text>{{"æŸ¥çœ‹æ›´å¤šå›å¤ ("+(comment.$orig.reply_count-comment.g3)+")"}}</text></view></block></view></block></view></block><block wx:if="{{$root.g4>0}}"><view class="load-status"><block wx:if="{{commentHasMore&&!isLoadingComments}}"><text>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text></block><block wx:else><block wx:if="{{isLoadingComments}}"><text>åŠ è½½ä¸­...</text></block><block wx:else><text class="no-more">æ²¡æœ‰æ›´å¤šè¯„è®ºäº†</text></block></block></view></block><block wx:if="{{$root.g5}}"><view class="empty-comments"><text class="empty-icon">ğŸ’­</text><text class="empty-text">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ä½ çš„çœ‹æ³•å§</text></view></block></view></scroll-view><view class="bottom-action-bar"><view data-event-opts="{{[['tap',[['showQuickReply',['$event']]]]]}}" class="input-trigger" bindtap="__e"><text class="input-placeholder">è¯´è¯´ä½ çš„æƒ³æ³•...</text></view><view class="action-group"><view data-event-opts="{{[['tap',[['togglePostLike',['$event']]]]]}}" class="action-item" bindtap="__e"><image class="{{['action-icon-img','like',(post&&post.isLiked)?'liked':'']}}" src="{{post&&post.isLiked?iconLikedUrl:iconLikeUrl}}" mode="aspectFit"></image><text class="action-text">{{post?post.likeCount:0}}</text></view><view data-event-opts="{{[['tap',[['showQuickReply',['$event']]]]]}}" class="action-item" bindtap="__e"><image class="action-icon-img" src="{{iconCommentUrl}}" mode="aspectFit"></image><text class="action-text">{{post?post.commentCount:0}}</text></view></view></view><block wx:if="{{showReplyModal}}"><view data-event-opts="{{[['tap',[['hideReplyInput',['$event']]]]]}}" class="reply-modal" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="reply-modal-content" catchtap="__e"><view class="reply-header"><text class="reply-title">{{''+(replyTarget?'å›å¤ @'+replyTarget.nickname:'å†™è¯„è®º')+''}}</text><text data-event-opts="{{[['tap',[['hideReplyInput',['$event']]]]]}}" class="close-btn" bindtap="__e">Ã—</text></view><view class="input-wrapper"><textarea class="reply-textarea" placeholder="{{replyTarget?'å›å¤ @'+replyTarget.nickname:'å†™ä¸ªè¯„è®º...'}}" focus="{{showReplyModal&&!showEmojiPicker}}" auto-height="{{true}}" maxlength="500" data-event-opts="{{[['input',[['__set_model',['','commentContent','$event',[]]],['onInputChange',['$event']]]]]}}" value="{{commentContent}}" bindinput="__e"></textarea><view data-event-opts="{{[['tap',[['toggleEmojiPicker',['$event']]]]]}}" class="emoji-btn" catchtap="__e"><block wx:if="{{!showEmojiPicker}}"><image class="emoji-icon-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/biaoqing.png" mode="aspectFit"></image></block><block wx:if="{{showEmojiPicker}}"><image class="emoji-icon-img" src="https://wait00.oss-cn-shanghai.aliyuncs.com/label/jianpan.png" mode="aspectFit"></image></block></view></view><block wx:if="{{showEmojiPicker}}"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="emoji-picker" catchtap="__e"><view class="emoji-tabs"><view data-event-opts="{{[['tap',[['switchEmojiSet',['mini']]]]]}}" class="{{['tab-item',(currentEmojiSet==='mini')?'active':'']}}" bindtap="__e">å°è¡¨æƒ…</view><view data-event-opts="{{[['tap',[['switchEmojiSet',['large']]]]]}}" class="{{['tab-item',(currentEmojiSet==='large')?'active':'']}}" bindtap="__e">å¤§è¡¨æƒ…</view></view><view class="emoji-list"><block wx:for="{{displayEmojiList}}" wx:for-item="emoji" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['insertEmoji',['$0'],[[['displayEmojiList','',index]]]]]]]}}" class="emoji-item" bindtap="__e"><image class="emoji-image" src="{{emoji.url}}" mode="aspectFit"></image></view></block></view></view></block><view class="reply-actions"><view class="char-count">{{$root.g6+"/500"}}</view><view data-event-opts="{{[['tap',[['submitComment',['$event']]]]]}}" class="{{['submit-btn',(!$root.g7)?'disabled':'']}}" bindtap="__e"><text>å‘é€</text></view></view></view></view></block></view>